"use strict";(self.webpackChunk_twitter_responsive_web=self.webpackChunk_twitter_responsive_web||[]).push([["modules.audio-e019dbda"],{117093:(e,t,n)=>{n.d(t,{MS:()=>y});var r=n(202784),o=n(325686),a=n(682474),c=n(392237),i=n(731708),s=n(154003),l=n(111677),u=n.n(l),d=n(982790),p=n(89609),f=n(868634),m=n(668260),h=n(279046),S=n(819329);function v(e){const{space:t,utils:n}=(0,d.$)(e.audioSpaceId),a=n.is.Running,c=n.is.replayable,s=n.is.NotStarted;let l=null;if(a)l=r.createElement(f.ZP,{background:"purple500",bold:!0},r.createElement(o.Z,{style:g.liveLabelContainer},r.createElement(m.default.LiveSpeakingIndicator,{withoutMargin:!0}),r.createElement(i.ZP,{style:g.labelText},b.liveSpace)));else{let e;if(c)e=b.recordedSpace;else if(s&&t?.scheduled_start){e=m.default.formatScheduledStartMs(t.scheduled_start).node}e&&(l=r.createElement(f.ZP,{bold:!0},e))}let u=null;if(a){const e=t?.participants.total||0,n=h.Z.formatCountShort(e),o=b.listeners({count:n});u=r.createElement(f.ZP,null,o)}else if(c){const e=h.Z.formatCountShort(n.getTunedInCount()),t=b.tunedIn({count:e});u=r.createElement(f.ZP,null,t)}return l||u?r.createElement(S.Z,{align:"left"},l,u):null}const g=c.default.create((e=>({liveLabelContainer:{alignItems:"center",flexFlow:"row nowrap",justifyContent:"space-between",height:"100%"},labelText:{marginStart:e.spaces.space4},capitalize:{textTransform:"capitalize"}}))),b={liveSpace:u().db4620aa,recordedSpace:u().c958e692,tunedIn:u().e111f531,listeners:u().i2c2bfb7};var w=n(864442);function y(e){return r.createElement(a.Z,{ratio:c.default.theme.aspectRatios.landscape},r.createElement(o.Z,{style:k.container},r.createElement(Z,{audioSpaceId:e.audioSpaceId}),r.createElement(o.Z,{style:k.overlay}),r.createElement(E,{audioSpaceId:e.audioSpaceId}),r.createElement(v,{audioSpaceId:e.audioSpaceId})))}function Z(e){const{space:t}=(0,d.$)(e.audioSpaceId),n=t?.host?.avatar_url,o=t?.hostPalette;return n&&o?r.createElement(w.Z,{avatar_url:n,palette:o}):null}function E(e){const{utils:t}=(0,d.$)(e.audioSpaceId);return r.createElement(o.Z,{style:k.spaceOverlay},r.createElement(i.ZP,{color:"whiteOnColor",numberOfLines:2,weight:"bold"},t.title()),r.createElement(I,{audioSpaceId:e.audioSpaceId}))}function I(e){const{handlers:t,utils:n}=(0,d.$)(e.audioSpaceId),o=(0,p.Z)(e.audioSpaceId),a=n.is.NotStarted&&o.props.scheduledStart,c=n.is.joined,i=n.is.replayable;let l=T.startListening,u=()=>{t.join()};return c&&(l=T.joined),i&&(l=c?T.listening:T.playRecording),a&&(u=o.props.onClick,l=o.props.hasReminderSet?T.reminderSet:T.setReminder),r.createElement(s.ZP,{onClick:u,style:k.spaceOverlayButton,type:"onMediaWhiteFilled"},l)}const k=c.default.create((e=>({container:{width:"100%",height:"100%"},hostDetails:{alignItems:"center",justifyContent:"center",width:"100%",height:"100%"},overlay:{backgroundColor:e.colors.translucentBlack30,position:"absolute",paddingHorizontal:"8.5%",start:0,top:0,width:"100%",height:"100%"},spaceOverlay:{position:"absolute",start:0,top:0,width:"100%",height:"100%",alignItems:"center",justifyContent:"center"},spaceOverlayButton:{marginTop:e.spaces.space12}}))),T={setReminder:u().d18909d4,reminderSet:u().j1d352d8,startListening:u().jcdc32f0,playRecording:u().if420852,joined:u().aa7ae3f6,listening:u().cfadb00e}},864442:(e,t,n)=>{n.d(t,{Z:()=>l});var r=n(202784),o=n(325686),a=n(392237),c=n(483677),i=n(757483),s=n(823161);function l(e){const[t,n]=r.useState(0);let l=a.default.theme.colors.purple500;const p=c.Z.get(e.palette);return p&&(l=i.Z.rgbaToCss({...p.rgb,alpha:1})),r.createElement(o.Z,{onLayout:function({nativeEvent:e}){const{width:t}=e.layout;n(t*d)},style:[{backgroundColor:l},u.container]},r.createElement(s.default,{size:"custom",style:{width:t,height:t},uri:e.avatar_url}))}const u=a.default.create((e=>({container:{alignItems:"center",justifyContent:"center",width:"100%",height:"100%"}}))),d=.39},581264:(e,t,n)=>{n.d(t,{F:()=>u});var r=n(202784),o=n(325686),a=n(731708),c=n(392237),i=n(111677),s=n.n(i),l=n(404971);function u(e){const{is_space_available_for_replay:t,state:n}=e||{},c="RUNNING"===n,i="NOT_STARTED"===n,s=("ENDED"===n||"TIMED_OUT"===n)&&t;let u;return(c||s||i)&&(u={bold:!0,background:void 0,children:void 0},c?(u.background="purple500",u.children=p.joinSpace):s?u.children=r.createElement(o.Z,{style:d.replayLabel},r.createElement(l.default,null),r.createElement(a.ZP,{style:d.replayLabelText},p.replaySpace)):i&&(u.children=p.comingUp)),u}const d=c.default.create((e=>({replayLabel:{alignItems:"center",display:"flex",flexFlow:"row nowrap"},replayLabelText:{marginStart:e.spaces.space4}}))),p=Object.freeze({joinSpace:s().h400d7c2,replaySpace:s().g66c8348,comingUp:s().be6ef5b4})},139613:(e,t,n)=>{n.d(t,{AE:()=>S,Ny:()=>h,dF:()=>v,hz:()=>I});var r=n(565058),o=n(516951),a=n(420182),c=n(42134),i=n(526250),s=n(254810),l=n(251836),u=n(122411),d=n(625555),p=n(790997),f=n(42778),m=n(895229);const h=(0,r.cn)((e=>{if((0,u.w8)()){const t=e(E)?.stream.getAudioTracks()[0];if(t)return t}return e(s.dB)}));function S(){(0,i.N)(b),(0,i.N)(w),(0,i.N)(Z)}function v(){(0,i.N)(k)}function g(e,t){return(0,i.v)(((n,r)=>{const a=n(e);return a?r(y,a,t):o.Z}))}const b=g(s.dB,!0),w=g(l.Mr,!1),y=(0,r.cn)(null,((e,t,n,r)=>{const c=(0,u.kq)();if(!(0,u.w8)()||!c)return o.Z;const i=new MediaStream;i.addTrack(n);const s=c.createMediaStreamSource(i),l=e(E);if(l){return e(a.f0).isTrue("rweb_conf_rnnoise_enabled")&&r?t(f.JK,{channelCount:1,audioContext:c,source:s,destination:l}):(s.connect(l),()=>{s.disconnect()})}return o.Z})),Z=(0,i.v)(((e,t)=>{if(e(s.dB))return o.Z;const n=(0,u.kq)();if(!(0,u.w8)()||!n)return o.Z;const r=e(E);if(!r)return o.Z;const a=n.createOscillator();return a.connect(r),()=>{a.disconnect()}})),E=(0,r.cn)((e=>(0,u.kq)()?.createMediaStreamDestination())),I=(0,r.cn)((e=>{const t=e(l.Qh);return e(s.lc)&&t})),k=(0,i.v)(((e,t)=>{const n=e(c.rm);if(!n)return o.Z;if(e(m.p_))return o.Z;const r=e(I);return e(d.re.isInit)&&e(p.YX.isInit)&&e(c.lR)&&t(r?d.FX:d.oZ,n),o.Z}))},103978:(e,t,n)=>{n.d(t,{CS:()=>b,n9:()=>E,wk:()=>v});var r=n(400752),o=n(565058),a=n(987809),c=n(516951),i=n(2138),s=n(420182),l=n(670687),u=n(663859),d=n(526250),p=n(811322),f=n(254810),m=n(122411),h=n(139613),S=n(790997);function v(e){const t=g(e);return(0,d.N)(y(t).listenerAtom(e)),(0,r.Dv)(y(t).audioLevelAtom(e))}const g=(0,a.xu)((e=>(0,o.cn)())),b=(0,a.xu)((e=>(0,o.cn)((t=>t(y(g(e)).audioLevelAtom(e)))))),w=(0,a.xu)((e=>(0,o.cn)((t=>e&&e!==t(S.kw)?t((0,S.xQ)(e)):t(m.zw)?t(h.Ny):t(f.dB))))),y=(0,p.X)((e=>{const t=(0,o.cn)(null),n=(0,a.xu)((e=>(0,o.cn)((r=>{if(e&&r((0,S.f)(e))){const e=r(S.Dg);return e&&!r((0,S.f)(e))?r(n(e)):null}if(e&&e!==r(S.kw)){if(r(w(e)))return r(t);const n=r((0,S.yA)(e));return n||(r((0,l.j9)(e))?null:0)}return r(w(e))?r(t):null})))),r=(0,a.xu)((e=>(0,d.v)(((n,o)=>{if(e&&n((0,S.f)(e))){const e=n(S.Dg);return e&&!n((0,S.f)(e))?o(r(e)):c.Z}const a=(0,i.Z)((e=>o(t,e)),250),d=n(w(e));if(!d)return c.Z;const p=!e||e===n(S.kw),f=n(s.zE);return(0,u.h)(d,(t=>{p&&0===t&&f.get(h.hz)||!p&&0===t&&f.get((0,l.j9)(e))?a(null):a(t)}))}))));return{listenerAtom:r,audioLevelAtom:n}})),Z=(0,a.xu)((e=>{const t=(0,o.cn)(null),n=(0,d.v)(((n,r)=>{const o=(0,i.Z)((e=>r(t,e)),250);return(0,u.h)(e,(t=>{e.muted?o(null):o(t)}))}));return{audioLevelAtom:t,listenerAtom:n}}));function E(e){return(0,d.N)(Z(e).listenerAtom),(0,r.Dv)(Z(e).audioLevelAtom)}},835515:(e,t,n)=>{n.d(t,{S$:()=>v,Z4:()=>w,lV:()=>h,sq:()=>d,zb:()=>y});var r=n(565058),o=n(987809),a=n(516951),c=n(420182),i=n(241862),s=n(526250),l=n(477635),u=n(122411);const d=(0,r.cn)(null,((e,t,{mid:n,track:r})=>{const o=(0,u.kq)();if(!(0,u.Jg)()||!o)return void i.q.addTrack(r);const a=o.createStereoPanner(),c=new MediaStream;c.addTrack(r);const s=o.createMediaStreamSource(c),l=f(o);s.connect(a).connect(l).connect(o.destination),(new Audio).srcObject=c,t(Z(n).source,s),t(Z(n).panner,a),m&&(m=!1,t(S))}));let p;function f(e){if(p)return p;const t=e.createGain();return p=t,t}let m=!0;const h=(0,r.cn)(1),S=(0,s.v)(((e,t)=>{const n=(0,u.kq)();if(!n)return a.Z;const r=e(h);return f(n).gain.setValueAtTime(r,n.currentTime),a.Z})),v=(0,r.cn)(null,((e,t,n,r)=>{const o=e(Z(n).panner),a=(0,u.kq)();if(o&&a){const t=e(w)?function(e){switch(e){case 0:return-.5;case 2:return.5;default:return 0}}(r):0;o.pan.value!==t&&o.pan.setValueAtTime(t,a.currentTime)}})),g=(0,r.cn)((e=>e(c.f0).isTrue("rweb_conf_dev_enabled"))),b=(0,l.t)((()=>g)),w=(0,r.cn)((e=>e(b)),((e,t)=>{t(b,(e=>!e))}));const y=(0,r.cn)(null,((e,t,n)=>{const r=e(Z(n).source);r?.disconnect();const o=e(Z(n).panner);o?.disconnect()})),Z=(0,o.xu)((e=>({source:(0,r.cn)(),panner:(0,r.cn)()})))},663859:(e,t,n)=>{n.d(t,{h:()=>o,y:()=>a});n(694898),n(38857),n(540171),n(157093),n(265688),n(270315),n(592529),n(86943),n(691157);var r=n(122411);function o(e,t){const n=(0,r.kq)();if(!n)return()=>{};const o=new MediaStream;o.addTrack(e);const a=n.createMediaStreamSource(o),c=n.createAnalyser();a.connect(c);const i=new Uint8Array(c.fftSize),s=()=>{c.getByteFrequencyData(i);const e=Math.max.apply(null,i);t(e/255),l=requestAnimationFrame(s)};let l=requestAnimationFrame(s);return()=>{cancelAnimationFrame(l)}}function a(e,t){const{getVolumeFloor:n,recordVolume:r}=function(){let e=!1,t=.5,n=0;const r=Array(60);function o(){return t}function a(o){e||(t=o,e=!0),n<r.length?(r[n]=o,n+=1):(t=Math.min(...r),n=0)}return{getVolumeFloor:o,recordVolume:a}}();return o(e,(e=>{r(e);const o=n(),a=Math.max(0,(e-o)/(1-o));t({level:e,normLevel:a})}))}},110138:(e,t,n)=>{n.d(t,{Z:()=>s});n(571372);var r=n(176340),o=n(741810),a=n(919022);let c;const i=new Error("[AudioModule] config not initialized");const s=new class{constructor(){this.proxsee=o.E}init(e){c=e,o.E.init(c)}initialized(){return!!c}viewerUser(){if(this.initialized()){const e=c.store.getState();return a.ZP.selectViewerUser(e)}}audioSpace(e,t){return c?c.api.withEndpoint(r.Z).byId(e,{skipListeners:t}):Promise.reject(i)}fetchTopics(){return c?c.api.withEndpoint(r.Z).fetchTopics():Promise.reject(i)}subscribeToScheduledSpace(e){return c?c.api.withEndpoint(r.Z).subscribeToScheduledSpaceById(e):Promise.reject(i)}unsubscribeFromScheduledSpace(e){return c?c.api.withEndpoint(r.Z).unsubscribeFromScheduledSpaceById(e):Promise.reject(i)}searchAudioSpace(e,t){return c?c.api.withEndpoint(r.Z).search(e,t):Promise.reject(i)}addSharing(e,t){return c?c.api.withEndpoint(r.Z).addSharing(e,t):Promise.reject(i)}deleteSharing(e,t){return c?c.api.withEndpoint(r.Z).deleteSharing(e,t):Promise.reject(i)}spacebar(){return c?c.api.withEndpoint(r.Z).spacebar():Promise.reject(i)}}},58255:(e,t,n)=>{n.d(t,{w:()=>r.Z});var r=n(110138)},863749:(e,t,n)=>{n.d(t,{ge:()=>v,M5:()=>h,Ft:()=>m,Be:()=>S});n(136728);var r=n(586035),o=n(827922),a=n(499627),c=n(312771),i=n(836255);const s="audio",l=`rweb/${s}`;const u=n(360142).ZP,d={conversationLookup:{}},p={UPDATE_CONVERSATION_LOOKUP:`${l}/UPDATE_CONVERSATION_LOOKUP`},f=e=>({type:p.UPDATE_CONVERSATION_LOOKUP,payload:e});a.Z.register({[s]:function(e=d,t){if(!t)return e;switch(t.type){case p.UPDATE_CONVERSATION_LOOKUP:{const n=t.payload;if(n){const t={...e};return t.conversationLookup={...e.conversationLookup},Object.keys(n).forEach((e=>{const r=n[e];if(!Array.isArray(r))return;const o=t.conversationLookup[e];(!o||o.length<r.length)&&(t.conversationLookup[e]=r)})),t}break}default:return e}return e}});const m=e=>e[s];function h(e){return(t,n,o)=>{const a=n(),s=a.audio.conversationLookup[e],l=u({focalTweetId:e});l.fetchInitial({})(t,n,o).then((e=>{if(e.performed){S(l.selectEntries(n()))(t,n,o)}}));const d=s||[e],p=[],f=d.map((e=>{const t=i.Z.selectFetchStatus(a,e);return t===c.ZP.NONE&&p.push(e),t}));p.length&&setTimeout((()=>{t(i.Z.fetchManyIfNeeded(p))}));const m=i.Z.createHydratedSelector(a),h=d.reduce(((e,t)=>{const n=m(t);return n&&r.B(n)&&e.push(n),e}),[]).sort(((e,t)=>e.voiceInfo&&t.voiceInfo?e.voiceInfo.clipIndex-t.voiceInfo.clipIndex:0));return{tweetIds:d,tweets:h,tweetIdsFetchStatus:f}}}function S(e){return(t,n)=>{const r=n(),a=(0,o.jp)(e,r);a.conversationLookup&&Object.keys(a.conversationLookup).length&&t(f(a.conversationLookup))}}const v=e=>e.conversation_id_str||e.self_thread?.id_str||e.id_str}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/modules.audio-e019dbda.4d02d79a.js.map