"use strict";(self.webpackChunk_twitter_responsive_web=self.webpackChunk_twitter_responsive_web||[]).push([["shared~loader.DMDrawer~bundle.DirectMessages~bundle.DMRichTextCompose"],{318823:(e,t,i)=>{i.d(t,{Z:()=>a});var n=i(706758);const a=()=>(0,n.ZP)().then((({inputDetect:e})=>e))},225351:(e,t,i)=>{i.d(t,{RU:()=>C,T5:()=>E,eN:()=>x});var n=i(111677),a=i.n(n),s=i(516951),r=i(615656);const o=a().c3752568,l=a().f78aa3ea,c=a().f9690dc0,d=a().i859a9d4,p=a().b1d35408,u=a().g539cca6,h=a().bbac001a,m=a().a1d2a68e,g=a().ec2bb9d4,_=a().hf383be4,b=a().b25c5b2a,y=a().c4fdbd16,f=a().hf3e7e38,C={[r.ZP.DirectMessageConversationNotFound]:{customAction:()=>!1}},x=e=>({defaultToast:{text:l},[r.ZP.DirectMessageSenderIsNotVerifiedRateLimited]:{customAction:e??s.Z},showToast:!0}),E=e=>({defaultToast:{text:o},[r.ZP.CurrentUserSuspended]:{toast:{text:u,action:{label:d,link:"https://support.twitter.com/articles/15790"}}},[r.ZP.DirectMessageCannotDmOtherUser]:{toast:{text:c}},[r.ZP.DirectMessageDuplicate]:{toast:{text:b}},[r.ZP.DirectMessageOtherUserNotFollowing]:{toast:{text:m,action:{label:d,link:"https://support.twitter.com/articles/14606"}}},[r.ZP.DirectMessagesSenderBlocksRecipient]:{toast:{text:y}},[r.ZP.DirectMessageTooLongError]:{toast:{text:h}},[r.ZP.DirectMessageTweetNotFound]:{toast:{text:g}},[r.ZP.GenericBadRequest]:{customAction:s.Z},[r.ZP.MessageSendError]:{toast:{text:f}},[r.ZP.OverStatusUpdateLimit]:{toast:{action:{label:d,link:"https://support.twitter.com/articles/15364"},text:p}},[r.ZP.TargetUserNotFound]:{toast:{text:_}},[r.ZP.DirectMessageSenderIsNotVerifiedRateLimited]:{customAction:e??s.Z},showToast:!0})},111311:(e,t,i)=>{i.d(t,{Z:()=>a});var n=i(801501);class a{constructor(e,t=Object.freeze({})){const{interval:i=6e4,burstInterval:a=3e3,burstDuration:s=3e5}=t;this.pollTimer=new n.Z(i).interval(e),this.burstTimer=new n.z(this.pollTimer,a,s)}start(e){return this.pollTimer.start(),e&&this.burstTimer.requestBurst(),this}stop(){return this.burstTimer.stopBurst(),this.pollTimer.stop(),this}restart(){return this.stop(),this.start(),this}}},575522:(e,t,i)=>{i.d(t,{F:()=>a,T:()=>n});const n=e=>e?"medium":"normal",a=(e,t)=>e||t?"text":"gray700"},26339:(e,t,i)=>{i.d(t,{QD:()=>p,Tt:()=>c,c:()=>a,ik:()=>s,js:()=>r,lf:()=>o});var n=i(275365);const a=e=>e&&e.type===n.Cr.MESSAGE,s=e=>e&&e.type===n.Cr.WELCOME_MESSAGE,r=e=>e&&e.type===n.Cr.TRUST_CONVERSATION,o=e=>e&&e.type===n.Cr.REACTION_CREATE,l=[n.Cr.CONVERSATION_AVATAR_UPDATE,n.Cr.CONVERSATION_NAME_UPDATE,n.Cr.JOIN_CONVERSATION,n.Cr.PARTICIPANTS_JOIN,n.Cr.PARTICIPANTS_LEAVE],c=e=>e&&l.indexOf(e.type)>-1,d=[n.Cr.END_AV_BROADCAST],p=e=>e&&d.indexOf(e.type)>-1},187891:(e,t,i)=>{i.d(t,{ZP:()=>v});var n=i(202784),a=i(325686),s=i(143670),r=i(154003),o=i(392237),l=i(111677),c=i.n(l),d=i(607127),p=i(616894),u=i(415506);const h=c().fcd4d489,m=c().gbed8594,g=c().g9074da4,_=c().ad63377e,b=c().h09b49f8,y=c().i6b19b08,f=c().j7bb1a43,C=c().cdb1a05a,x=c().cfd2f35e,E=o.default.create((e=>({roundCorners:{borderRadius:e.borderRadii.xLarge},flatCorners:{borderRadius:e.borderRadii.none},cancelButton:{marginHorizontal:e.spaces.space16,marginVertical:e.spaces.space16}}))),v=({dismiss:e,flatBorders:t=!1,isGroup:i=!1,onBlockClick:o,onDeleteClick:l,onReportClick:c,requestorScreenName:v,showBlock:T=!1,showCancel:S=!1,showDelete:I=!1})=>{const P=n.useCallback((()=>{c&&c(),e()}),[e,c]),A=n.useCallback((()=>{o&&o(),e()}),[e,o]),k=n.useCallback((()=>{l&&l(),e()}),[e,l]);return n.createElement(a.Z,{role:"dialog",style:t?E.flatCorners:E.roundCorners},I?n.createElement(s.Z,{Icon:d.default,actionSubText:b,actionText:i?g:_,onClick:k,textColor:"red500"}):null,T?n.createElement(s.Z,{Icon:p.default,actionSubText:m,actionText:h({screenName:v}),onClick:A}):null,n.createElement(s.Z,{Icon:u.default,actionSubText:C,actionText:i?y:f({screenName:v}),onClick:P}),S?n.createElement(r.ZP,{onPress:e,style:E.cancelButton,type:"primaryOutlined"},x):null)}},716354:(e,t,i)=>{i.d(t,{Z:()=>h});var n=i(202784),a=i(688715),s=i(439592),r=i(530732),o=i(111677),l=i.n(o),c=i(449950),d=i(965728);const p=l().b327c12a,u=e=>{e.stopPropagation()},h=({hideAltLabel:e,media:t,mediaUrl:i})=>{const o=t.ext_alt_text||p,l=(0,a.ib)(t.media_url_https),{height:h,width:m}=t.original_info||{},g=(0,d.Rb)(t).rgb,_=n.createElement(c.Z,{"aria-label":o,aspectMode:s.Z.withinRange(9/16,10),backgroundColor:g,image:{url:l,width:m,height:h},shouldShowAltLabel:!e&&!!t.ext_alt_text});return i?n.createElement(r.Z,{interactiveStyles:null,link:i,onPress:u},_):_}},754310:(e,t,i)=>{i.d(t,{H2:()=>d,Ip:()=>r,Is:()=>c,LJ:()=>p,Rw:()=>o,fw:()=>l,qn:()=>u});var n=i(849938),a=i(392237);const s=(e,t)=>{if(null==e)return!1;const[i,n]=t||[0,0];return!((0===i||1===i)&&e.length===n)},r=e=>{if(!e)return!1;const{attachment:t}=e;if(!t)return!0;if(t.sticker)return!1;const i=t.tweet||t.photo||t.animated_gif||t.video||void 0;if(i)return s(e.text,i.indices);if(t.card){const i=(e.entities?.urls||[]).find((e=>e.url===t.card));return s(e.text,i&&i.indices)}return!0},o=e=>{const t=e?.message_data?.attachment;return!(!t||!(t.card||t.tweet||t.photo||t.animated_gif||t.video))},l=e=>{const t=e?.message_data?.attachment;return!(!t||!t.fleet)},c=e=>!r(e.message_data)&&o(e),d=(e,t,i)=>{const n=1.25*a.default.theme.fontSizesPx.body;return{compositeRendered:e?void 0!==t&&void 0!==i:void 0!==t,isTextSquared:void 0!==t&&void 0!==i&&i===t,isAttachmentSquared:void 0!==i&&void 0!==t&&(t===i||t<=i-n)}},p=e=>{const{message_data:t}=e;if(!t)return!1;if(o(e)&&!l(e))return!1;if(!t.text)return!1;const i=(0,n.Qc)(t.text);if(!i||0===i.length)return!1;const a=i.sort(((e,t)=>t.indices[1]-e.indices[1])).reduce(((e,t)=>`${e.slice(0,t.indices[0])}${e.slice(t.indices[1])}`),t.text).trim();return i.length<=10&&0===a.length},u=(e,t)=>{if(!e?.urls||!t)return e;const i=e.urls.filter((e=>e.display_url!==t.display_url));return{...e,urls:i,media:[t]}}},699897:(e,t,i)=>{i.d(t,{Z:()=>h});var n=i(202784),a=i(325686),s=i(392237),r=i(731708),o=i(111677),l=i.n(o),c=i(575522);const d=s.default.create((e=>({root:{paddingBottom:e.spaces.space20}}))),p=l().d84b485e,u=l().be0c83d8,h=({entry:e,isCompact:t,isSelected:i=!1,unread:s=!1})=>{const o="follow"===e.reason?p:u,l=(0,c.T)(s),h=(0,c.F)(s,i);return t?n.createElement(r.ZP,{color:h,weight:l},o):n.createElement(a.Z,{style:d.root},n.createElement(r.ZP,{align:"center",color:h,size:"subtext2",weight:l},o))}},213386:(e,t,i)=>{i.d(t,{X:()=>c});var n=i(202784),a=i(868634),s=i(731708),r=i(392237),o=i(111677);const l=i.n(o)().bcc13060,c=e=>n.createElement(a.ZP,{background:"gray50",style:d.label},n.createElement(s.ZP,{color:"gray700",numberOfLines:1,size:"subtext3",style:d.content,weight:"medium"},l)),d=r.default.create((e=>({label:{alignSelf:"center",borderRadius:e.borderRadii.infinite,borderBottomWidth:e.borderWidths.small,borderBottomStyle:"solid",borderBottomColor:e.colors.gray200},content:{marginHorizontal:e.spaces.space4,marginVertical:e.spaces.space8,textTransform:"uppercase"}})))},228245:(e,t,i)=>{i.d(t,{FC:()=>m,Mk:()=>g});var n=i(202784),a=i(124964),s=i(111677),r=i.n(s),o=i(275365);const l=r().e2cd3b7c,c=r().f42f365a,d=r().a7570f2c,p=r().jd9831b2,u=r().f0985268,h=r().ca397a48,m=(e,t,i)=>{const n=i===e.by_user_id;switch(e.end_reason){case o.td.HUNG_UP:case o.td.TIMED_OUT:return e.call_type===o.v1.AUDIO_ONLY?l:c;case o.td.MISSED:case o.td.CANCELED:case o.td.DECLINED:return n?e.call_type===o.v1.AUDIO_ONLY?u:h:e.call_type===o.v1.AUDIO_ONLY?d:p;default:return""}},g=e=>{switch(e.end_reason){case o.td.HUNG_UP:case o.td.TIMED_OUT:return n.createElement(n.Fragment,null,_(e)," ",n.createElement(a.Z,null)," ",b(e));case o.td.MISSED:case o.td.CANCELED:case o.td.DECLINED:return _(e);default:return""}},_=e=>{const t=parseInt(e.time,10);return(0,r().b6ca7bcb)(new Date(t))},b=e=>{const t=(parseInt(e.ended_at_ms,10)-parseInt(e.started_at_ms,10))/1e3,i={seconds:Math.floor(t%60),minutes:Math.floor(t/60)%60,hours:Math.floor(t/3600)};return t<60?n.createElement(r().I18NFormatMessage,{$i18n:"ie5066ff",seconds:i.seconds}):t<3600?n.createElement(r().I18NFormatMessage,{$i18n:"idcd199b",minutes:i.minutes,seconds:i.seconds}):n.createElement(r().I18NFormatMessage,{$i18n:"ee530bbf",hours:i.hours,minutes:i.minutes})}},778787:(e,t,i)=>{i.d(t,{Z:()=>He});var n=i(807896),a=(i(136728),i(202784)),s=i(928316),r=i(325686),o=i(392237),l=i(682474),c=i(154003),d=i(157130),p=i(111677),u=i.n(p),h=i(826363),m=i(19197),g=i(58399),_=i(912021),b=i(323265),y=i(913670),f=i(113392),C=i(373554),x=i(304059),E=i(822399);const v=[{waitMs:1e3,progress:.1},{waitMs:1400,progress:.3},{waitMs:1800,progress:.5},{waitMs:2400,progress:.6},{waitMs:3e3,progress:.9}];class T extends a.Component{constructor(...e){super(...e),this.state={currentStepIndex:-1}}componentDidMount(){this._scheduleNextStep(0)}componentWillUnmount(){this._currentTimeoutId&&clearTimeout(this._currentTimeoutId)}render(){const{currentStepIndex:e}=this.state,t=e>=0&&e<v.length?v[e].progress:0;return a.createElement(E.Z,{progress:t})}_scheduleNextStep(e){e<v.length&&(this._currentTimeoutId=setTimeout((()=>{this._currentTimeoutId=void 0,this.setState({currentStepIndex:e}),this._scheduleNextStep(e+1)}),v[e].waitMs))}}function S({isSending:e,isUploading:t,progress:i}){return e&&!t?a.createElement(T,null):a.createElement(E.Z,{progress:e?Math.max(i,.02):0})}const I=a.memo(S);var P=i(90511),A=i(490834),k=i(318823),M=i(655352),w=i(96206),R=i(47743),Z=i(511985),D=i(716233),O=i(339110),N=i(292627),B=i(365023),F=i(358493);const U=function(e){const{"aria-label":t,children:i,onLayout:s,role:o,sideNavPresent:l,style:c}=e,d=a.useContext(F.hr);return l?a.createElement(a.Fragment,null,a.createElement(r.Z,{"aria-label":t,onLayout:s,role:o,style:c},i)):a.createElement(N.Z.BottomComposer,null,a.createElement(B.Z,{id:"DMComposerWrapper"},((e,l)=>a.createElement(r.Z,(0,n.Z)({ref:e()},l({"aria-label":t,role:o,onLayout:s,style:c})),i,a.createElement(r.Z,{style:!1===d.keyboardVisible&&L.offsetBottom})))))},L=o.default.create((()=>({offsetBottom:{paddingBottom:o.default.iPhoneOffsetBottom}})));var V=i(385438),W=i(928965),Q=i(125363),q=i(919022),G=i(754310),z=i(731708),H=i(451051),$=i(837020),j=i(716354);const K=({author:e,entities:t,icon:i,media:n,onCancel:s,text:o})=>{const l=n&&!n.possibly_sensitive?{id_str:n.id_str,media_url_https:n.media_url_https,display_url:n.display_url,type:"photo",ext_alt_text:n.ext_alt_text,original_info:n.original_info}:null;return a.createElement(r.Z,{style:J.root},a.createElement(r.Z,{style:J.container},a.createElement(z.ZP,{size:"subtext2",weight:"medium"},e),a.createElement(r.Z,{style:J.textContainer},i,a.createElement(H.Z,{displayTextRange:[0,o?.length||0],entities:t,numberOfLines:3,size:"subtext2",text:o||"",withMediaLinks:!1}))),a.createElement(r.Z,{style:J.mediaContainer},l?a.createElement(r.Z,{style:J.image},a.createElement(j.Z,{hideAltLabel:!0,media:l,mediaUrl:null})):null,a.createElement(c.ZP,{icon:a.createElement($.default,{style:J.closeIcon}),onClick:s,type:"primaryText"})))},J=o.default.create((e=>({root:{display:"flex",flexDirection:"row",backgroundColor:e.colors.gray0,width:"100%",gap:"4px",alignItems:"center",justifyContent:"space-between",paddingVertical:e.spaces.space8,paddingHorizontal:e.spaces.space12,borderStartColor:e.colors.gray1000,borderStartWidth:e.spaces.space4,borderTopStyle:"solid"},container:{flexDirection:"column",flexShrink:1},textContainer:{flexDirection:"row",alignItems:"center",gap:"4px"},image:{width:e.spaces.space32,maxHeight:e.spaces.space32},mediaContainer:{flexDirection:"row",alignItems:"center",height:"100%"},closeIcon:{color:e.colors.gray700}}))),Y=u().af71ef68,X=u().b327c12a,ee=u().fc64990e,te=u().i0db46e6,ie=({messageData:e,onCancel:t})=>{const i=(0,Q.v9)((t=>q.ZP.select(t,e.sender_id)));let n=e.text;const s=e.attachment?.photo||e.attachment?.video||e.attachment?.animated_gif;let r,o=(0,G.qn)(e.entities,s);return!(0,G.Ip)(e)&&e.attachment&&(e.attachment.video?.audio_only?(n=Y,o=void 0,r=a.createElement(V.default,null)):e.attachment.photo?(n=X,o=void 0,r=a.createElement(W.default,null)):e.attachment.video?(n=ee,o=void 0,r=a.createElement(W.default,null)):e.attachment.animated_gif&&(n=te,o=void 0,r=a.createElement(W.default,null))),a.createElement(K,{author:i?.name||"",entities:o,icon:r,media:s,onCancel:t,text:n})};var ne=i(537392),ae=i(108362),se=i(10656),re=i(952428);function oe({closeQuickReplyPicker:e,conversationId:t,description:i,id:n,isWide:s,label:r,onClick:o,perspective:l,quickReplyId:c}){const d=a.useCallback((()=>{o({id:n,label:r})}),[n,r,o]);return a.createElement(re.Z,{onClick:d,role:"button",style:[le.root,s?le.isWide:le.isNarrow]},a.createElement(z.ZP,{weight:"bold"},r),a.createElement(z.ZP,{color:"gray700",size:"subtext2"},i))}const le=o.default.create((e=>({root:{backgroundColor:e.colors.cellBackground,borderColor:e.colors.borderColor,borderStyle:"solid",paddingStart:"1rem",paddingVertical:"1rem"},isWide:{borderRadius:e.borderRadii.xLarge,paddingVertical:"0.5rem",borderWidth:e.borderWidths.small},isNarrow:{borderTopWidth:e.borderWidths.small}})));class ce extends a.Component{constructor(...e){super(...e),this._handleOptionChoose=e=>{const{onOptionChoose:t,quickReplyOptions:{id:i}}=this.props;return t(i,e)}}render(){const{quickReplyOptions:{options:e}}=this.props,t=1===e.length;return a.createElement(ne.ZP,null,(({containerWidth:i})=>{const n=se.Z.isTwoColumnLayout(i),s=[n&&de.isWide,n&&t&&de.oneButtonOnly,!n&&de.isNarrow];return a.createElement(ae.Z,{style:s,withGutter:n},e.map((e=>this.renderOption(e,n))))}))}renderOption(e,t){const{closeQuickReplyPicker:i,conversationId:n,perspective:s,quickReplyOptions:r}=this.props;return a.createElement(oe,{closeQuickReplyPicker:i,conversationId:n,description:e.description,id:e.id,isWide:t,key:e.id,label:e.label,onClick:this._handleOptionChoose,perspective:s,quickReplyId:r.id})}}const de=o.default.create((e=>({oneButtonOnly:{gridTemplateColumns:"1fr"},isWide:{backgroundColor:e.colors.gray0,display:"grid",gridColumnGap:e.spaces.space12,gridRowGap:e.spaces.space12,gridTemplateColumns:"1fr 1fr",paddingVertical:e.spaces.space12},isNarrow:{maxHeight:"168px",overflow:"auto"}}))),pe=ce,ue="dmComposerAttachments",he="iconDrawer",me="iconDrawerOn",ge="dmComposerTextInputComponent",_e="dmComposerTextInput",be="dmComposerSendButton",ye=o.default.create((e=>({actionButton:{marginStart:e.spaces.space4}})));var fe=i(109491);const Ce=u().e3275464,xe=a.createElement(fe.default,null);function Ee(e){const{onDidSend:t,onSend:i,onWillSend:n,showIconInsteadOfLabel:s}=e,r=e.disabledFunc();return a.createElement(c.ZP,{"aria-label":Ce,disabled:r,hoverLabel:{label:Ce},icon:s?xe:void 0,onPress:e=>{r||(n&&n(),i(e).then((({conversationId:e,text:i})=>{t&&t(e,i)})))},size:"medium",style:ye.actionButton,testID:be,type:s?"brandText":"brandFilled"},s?null:Ce)}var ve=i(593953),Te=i(668214),Se=i(704279),Ie=i(723819),Pe=i(497294),Ae=i(390387),ke=i(38562),Me=i(601576);const we=(0,Te.Z)().propsFromState((()=>({dataSaverMode:ke.IX,perspective:Ae._h,showGraduatedAccess:Ie.nQ}))).propsFromActions((()=>({addMedia:Pe.rA,addToast:Me.fz,processMultipleMedia:Pe.G$,removeMediaUpload:Pe.WU,scribeAction:Se.n,preUploadMedia:Pe.oZ})));var Re=i(371344);const Ze=o.default.create((e=>({composeInput:{backgroundColor:"transparent",width:"100%"}}))),De=u().ca0ce0e4,Oe=(e,t)=>{const{disabled:i,editorState:n,isSendDisabledFunc:s,keyboardOrMouseDetectedFunc:r,mediaButtonsCollapsible:o,onBlur:l,onDidHandleReturn:c,onFilesAdded:d,onFocus:p,onReturn:u,onRichTextChange:h,onWillHandleReturn:m,placeholderText:g,renderAttachmentsFunc:_,richTextInputContext:b,value:y}=e,f=g||De,C=!!b,x=b?{editorState:n,element:b.element}:void 0,E=e=>{const{nativeEvent:{ctrlKey:t,key:i,metaKey:n,shiftKey:a}}=e;if(!("Enter"===i&&r()&&!(a||n||t)))return"not-handled";const s=m(e);return u(e).then((({conversationId:e,text:t})=>{c(e,t)})),s};return a.createElement(Re.Z,{contentAbove:_(),editable:!i,handleReturn:C?E:void 0,isCompact:!0,leftAligned:!0,maxNumberOfLines:C?8:4,multiline:!0,numberOfLines:1,onBlur:l,onChange:h,onFilesAdded:d,onFocus:p,onKeyPress:C?void 0:e=>{E(e)},placeholder:f,ref:t,richTextInputContext:i?void 0:x,style:Ze.composeInput,styleType:"selection",testID:_e,useCacheForDOMMeasurements:!s()&&!o,value:y})},Ne=a.forwardRef(Oe);function Be({attachment:e,enabled:t,handleSecondaryAction:i,messageText:n,newConversationParticipants:s,perspective:r,secondaryActionLabel:o}){const l=a.useCallback((e=>{i(e)}),[i]);return a.createElement(c.ZP,{"aria-label":o,disabled:!t,onPress:l,style:Fe.root,type:"primaryOutlined"},o)}const Fe=o.default.create((e=>({root:{marginStart:e.spaces.space4}}))),Ue=u().ee230734,Le=u().ic8c615e,Ve=u().a04077c4,We=u().c07367d8,Qe=e=>!(!e||!e.media),qe=(0,R.yN)({maxNumberOfMedia:1});class Ge extends a.Component{constructor(e){super(e),this._isSecretConversation=()=>{const{conversationId:e}=this.props;return(0,ve.NL)(e)},this._handleLayout=e=>{const{onHeightChange:t}=this.props,{mediaButtonsCollapsible:i}=this.state,n=e.nativeEvent.layout;n&&((0,M.ZP)()||t&&t(n.height),n.width<=o.default.theme.breakpoints.small&&!i?this.setState({mediaButtonsCollapsible:!0}):n.width>o.default.theme.breakpoints.small&&i&&this.setState({mediaButtonsCollapsible:!1}))},this._renderMainContent=()=>{const{richTextInputContext:e,typeaheadWrapper:t}=this.props,{value:i}=this.state,n=t;return n?a.createElement(n,{contextText:i,isInline:!0,onTextUpdated:e?this._handleRichTextChange:this._handlePlainTextChange,onTypeaheadStateChange:this._handleTypeaheadStateChange,source:O._4.ComposeMessage},this._renderFieldTextInput):this._renderFieldTextInput()},this._renderFieldTextInput=e=>{const{disabled:t,placeholderText:i,richTextInputContext:n}=this.props,{editorState:s,mediaButtonsCollapsible:r,value:o}=this.state,l={disabled:t||!1,editorState:s,isSendDisabledFunc:this._isSendDisabled,keyboardOrMouseDetectedFunc:()=>this._keyboardOrMouseDetected,mediaButtonsCollapsible:r,onBlur:this._handleOnBlur,onDidHandleReturn:this._didPerformPrimaryAction,onFilesAdded:this._handleAddMediaFiles,onFocus:this._handleTextInputFocus,onInputChange:e||(()=>{}),onPlainTextChange:this._handlePlainTextChange,onReturn:this._handleReturn,onRichTextChange:this._getHandleRichTextChange(e),onWillHandleReturn:this._willPerformPrimaryAction,placeholderText:i||"",ref:this._setTextInputRef,renderAttachmentsFunc:this._renderAttachments,richTextInputContext:n,testID:ge,value:o};return a.createElement(Ne,l)},this._getHandleRichTextChange=(0,_.Z)((e=>t=>{e?.(t),this._handleRichTextChange(t)})),this._handleTypeaheadStateChange=e=>{this.setState({isTypeaheadActive:e})},this._renderAttachments=()=>{const{attachment:e,conversationId:t,isCardPreviewTombstoned:i,isShareViaDM:n,isUploading:s}=this.props,{value:o}=this.state,{height:c,width:d}=e&&(e.media&&e.media.mediaFile||e.provider&&e.media&&e.media.externalMediaDetails)||{},p=e?.media,u=p?.mediaMetadata,h=u?.altText,m=u?.defaultAltText,g=(0,P.dm)(o);return a.createElement(a.Fragment,null,p?a.createElement(r.Z,{style:ze.attachmentContainer,testID:ue},a.createElement(l.Z,{ratio:d/c,style:ze.aspectContainer},a.createElement(r.Z,{style:ze.mediaPreviewContainer},a.createElement(x.Z,{"aria-label":h||m,mediaItem:p,onClick:this._canEditImage?this._handleClickMediaDetail:void 0,onEdit:this._canEditGif||this._canEditImage||this._canEditVideo?this._handleClickMediaDetail:void 0,onRemove:this._handleRemoveMedia(p.id),resizeIfNeeded:"width",style:ze.mediaPreview,withAltTextLabel:!!h,withCloseButton:!s,withEditButton:(this._canEditGif||this._canEditImage||this._canEditVideo)&&!s,withEditIcon:!0}))),e&&e.provider&&e.gifUrl&&a.createElement(r.Z,{style:ze.gifAttribution},a.createElement(A.Z,{gifUrl:e.gifUrl,provider:e.provider}))):g&&!n?a.createElement(P.ZP,{conversationId:t,isCardPreviewTombstoned:i,style:ze.cardPreviewContainer,urls:g}):null)},this._renderPrimaryActionButton=e=>{const{onDidPerformPrimaryAction:t,quickReplyOptions:i}=this.props,s=this._hasMessageText();if(!i||s||e){const i={disabledFunc:this._isSendDisabled,showIconInsteadOfLabel:!0,messageText:this._getMessageText(),onWillSend:()=>{this._willPerformPrimaryAction()},onDidSend:(e,i)=>{t&&t(e,{type:"richText"},i)}};return a.createElement(Ee,(0,n.Z)({},i,{hasAttachment:e,onSend:this._performPrimaryAction}))}return a.createElement(c.ZP,{"aria-label":Le,icon:this.state.isQuickReplyOpen?a.createElement(h.default,{testID:me}):a.createElement(m.default,{testID:he}),onPress:this._handleQuickReplyPickerToggle,size:"medium",style:ze.actionButton,type:"brandText"})},this._renderSecondaryActionButton=()=>{const{attachment:e,newConversationParticipants:t,perspective:i,secondaryActionDisabledPopoverRenderer:n,secondaryActionLabel:s,shouldEnableSecondaryActionFunc:r,shouldShowSecondaryActionFunc:o}=this.props;if(o&&!o()||!s)return null;const l=!r||r(),c=a.createElement(Be,{attachment:e,enabled:l,handleSecondaryAction:this._handleSecondaryAction,messageText:this._getMessageText(),newConversationParticipants:t,perspective:i,secondaryActionLabel:s});return l||!n?c:a.createElement(d.Z,{enableHover:!0,preferredVerticalOrientation:"up",renderContent:n,withArrow:!0},c)},this._renderComposer=()=>{const{attachment:e}=this.props,t=Qe(e);return a.createElement(r.Z,{style:[ze.composer,t&&ze.composerWithAttachment]},t?null:this._renderMediaButtons(),a.createElement(r.Z,{style:ze.composeBoxContainer},this._renderMainContent()),this._renderSecondaryActionButton(),this._renderPrimaryActionButton(t))},this._renderMediaButtons=()=>{const{conversationId:e,history:t}=this.props,i=!this._isSecretConversation()&&this.props.withMediaPicker,n=!this._isSecretConversation()&&this.props.withGifPicker,s=b.ZP.isDesktopOS()&&this.props.withEmojiPicker,o=[i,n,s].filter((e=>e)).length,{mediaButtonsCollapsed:l,mediaButtonsCollapsible:d}=this.state,p=d&&l&&o>1;return a.createElement(r.Z,{style:ze.uploadButtons},p?a.createElement(c.ZP,{"aria-label":Ue,icon:a.createElement(g.default,null),onMouseDown:this._handleShowMediaControlsMouseDown,type:"brandText"}):null,i&&!p?a.createElement(C.Z,{onChange:this._handleAddMediaFiles,style:ze.mediaPicker,type:"brandText"}):null,n&&!p?a.createElement(f.Z,{dmConversationId:e,enabled:!0,gifSearchKeySource:Z.AD.DMComposition,history:t}):null,s&&!p?a.createElement(y.Z,{disabled:this.props.disabled,onEmojiSelect:this._handleEmojiSelect,size:"medium",textInputRef:this._textInput||void 0}):null)},this._handleShowMediaControlsMouseDown=()=>{const{scribeAction:e,scribeNamespace:t}=this.props;this.setState({mediaButtonsCollapsed:!1}),e({...t,component:"dm_composer",element:"toggle",action:"expand"})},this._handleReturn=e=>{const{isTypeaheadActive:t}=this.state;return!t&&!this._isSendDisabled()?(e.preventDefault(),this._performPrimaryAction(e)):Promise.resolve({conversationId:"",text:""})},this._handleClickMediaDetail=()=>{const{attachment:e,conversationId:t,history:i}=this.props;if(this._canEditGif||this._canEditImage||this._canEditVideo){const n=e&&e.media?e.media.id:0,a=this._canEditGif?"alt_text":this._canEditVideo?"trimmer":"crop";i.push("/messages/compose/media",{mediaId:n,conversationId:t,tab:a})}},this._handleAddMediaFiles=e=>{const{addMedia:t,addToast:i,dataSaverMode:n,onAddMedia:a,preUploadMedia:s,processMultipleMedia:r,removeMedia:o,removeMediaUpload:l}=this.props;this._isSecretConversation()?i({text:We}):t(e,{location:D.vC.Dm}).then((e=>{const t=e.map((e=>e.id));this._validateMedia(e)?(a&&a(t),r(e,{onFailure:o}).then((e=>{n||s(e.filter((e=>!!e&&!!e.id)).map((e=>e.id)))}))):(i({text:Ve}),l(t))}))},this._handleEmojiSelect=e=>{const{editorState:t}=this.state,{richTextInputContext:i}=this.props;if(!i||!t)return;const n=i.insertTextAtCursor(t,e.text);this._handleRichTextChange(n)},this._handleRemoveMedia=e=>()=>{this.props.removeMedia&&this.props.removeMedia(e)},this._willPerformPrimaryAction=()=>{const{history:e,onWillPerformPrimaryAction:t,showGraduatedAccess:i}=this.props,{isTypeaheadActive:n}=this.state;return!this._isSendDisabled()&&!n&&this._textInput?.applyFinalValue((e=>{t&&t({type:"richText"},e)})),i&&e.push({pathname:"/i/graduated-access",query:{graduatedAccessScribeSrc:"messages"}}),"handled"},this._performPrimaryAction=e=>this.props.onPrimaryAction({type:"richText"},this._textInput?.getValue()||""),this._didPerformPrimaryAction=(e,t)=>{const{onDidPerformPrimaryAction:i}=this.props;this._closeQuickReplyPicker(),i&&i(e,{type:"richText"},t)},this._handleSecondaryAction=e=>{const{onSecondaryAction:t}=this.props;this._textInput&&this._textInput.applyFinalValue((e=>{t&&t({type:"richText"},e)}))},this._handleRichTextChange=e=>{const{onTyping:t,richTextInputContext:i}=this.props,{value:n}=this.state,a=i?e.getCurrentContent().getPlainText():e.target.value,s=i?i.convertEmojiToEntities(e):null;this.setState({editorState:s,value:a}),n!==a&&t?.()},this._handlePlainTextChange=e=>{const{onTyping:t}=this.props,{value:i}=this.state,n=e.target.value;this.setState({value:n}),i!==n&&t?.()},this._handleOnBlur=()=>{const{onBlur:e}=this.props,{mediaButtonsCollapsible:t}=this.state;e&&e(),t&&this.setState({mediaButtonsCollapsed:!1})},this._handleTextInputFocus=()=>{const{quickReplyOptions:e}=this.props,{isQuickReplyOpen:t,mediaButtonsCollapsible:i}=this.state;e&&t&&this._closeQuickReplyPicker(),i&&this.setState({mediaButtonsCollapsed:!0})},this._handleQROptionSelection=(e,t)=>{const{disabled:i,onPrimaryAction:n}=this.props;i||(n({quickReply:{id:e,selected_id:t.id}},t.label),this._closeQuickReplyPicker())},this._handleQuickReplyPickerToggle=()=>{this.setState({isQuickReplyOpen:!this.state.isQuickReplyOpen})},this._validateMedia=e=>!Qe(this.props.attachment)&&qe(e),this._detectKeyboardOrMouse=e=>{const{KEYBOARD:t,MOUSE:i,registerSome:n}=e;n((()=>{this._keyboardOrMouseDetected=!0}),[t,i])},this._isSendDisabled=()=>{const{attachment:e,canSendEmptyMessage:t,disabled:i,isUploading:n}=this.props,a=Qe(e),s=this._hasMessageText()||t,r=!(!e||!e.media)&&(e.media.needsProcessing||n);return i||!s&&!a||r||n},this._getMessageText=()=>(this.state.value||"").trim(),this._hasMessageText=()=>!!this._getMessageText(),this._closeQuickReplyPicker=()=>{this.setState({isQuickReplyOpen:!1})},this.handleAddMediaFiles=e=>this._handleAddMediaFiles(e),this._setTextInputRef=e=>{this._textInput=e};const{prefillText:t,richTextInputContext:i}=e;this.state={isQuickReplyOpen:!0,value:t,editorState:i?.initEditorState?.(t)??null,isTypeaheadActive:!1,mediaButtonsCollapsed:!1,mediaButtonsCollapsible:!1}}componentDidMount(){(0,k.Z)().then(this._detectKeyboardOrMouse),this._unlockReload=w.Z.acquire()}componentWillUnmount(){this._unlockReload&&this._unlockReload()}componentDidUpdate(){this.props.quickReplyOptions&&this.state.isQuickReplyOpen&&this._textInput&&this._textInput.blur()}UNSAFE_componentWillReceiveProps(e){const t=this.props.quickReplyOptions,i=e.quickReplyOptions;if(t&&!i?this.setState({isQuickReplyOpen:!1}):(!t&&i||t&&i&&t.id!==i.id)&&this.setState({isQuickReplyOpen:!0}),this.props.conversationId!==e.conversationId&&this.clear(),this.props.editDm?.id!==e.editDm?.id&&e.editDm?.message_data?.text){const t=e.editDm?.message_data?.text;this.setState({value:t}),this.setState({editorState:e.richTextInputContext?.initEditorState?.(t)??null})}}render(){const{conversationId:e,dtabBarInfo:t,editDm:i,isSending:n,isUploading:s,mediaUploadProgress:r,onCancelEdit:o,onCancelReply:l,perspective:c,placeholderText:d,quickReplyOptions:p,replyTo:u,style:h}=this.props,{isQuickReplyOpen:m}=this.state,g=d||De,_=(0,M.ZP)(),b=_&&t&&(t.dtabAll||t.ttsToken)&&!t.hide;return a.createElement(U,{"aria-label":g,onLayout:this._handleLayout,role:"complementary",sideNavPresent:_,style:[ze.root,b&&ze.dtabOffset,h]},u?.message_data?a.createElement(ie,{messageData:u.message_data,onCancel:l}):null,i?.message_data?a.createElement(ie,{messageData:i.message_data,onCancel:o}):null,a.createElement(I,{isSending:n,isUploading:s,progress:n?Math.max(r,.02):0}),this._renderComposer(),p&&m?a.createElement(pe,{closeQuickReplyPicker:this._closeQuickReplyPicker,conversationId:e,onOptionChoose:this._handleQROptionSelection,perspective:c,quickReplyOptions:p}):null)}get _canEditGif(){return!!this.props.attachment?.gifUrl||!!this.props.attachment?.media?.mediaFile?.isGif}get _canEditImage(){return!!this.props.attachment?.media?.mediaFile?.isImage}get _canEditVideo(){const{attachment:e}=this.props;let t=e?.media?.mediaFile?.isVideo;return t&&(t=this.props.withVideoTrimmer),!!t}clear(){const{richTextInputContext:e}=this.props;if(e){const{initEditorState:t}=e||{};(0,s.flushSync)((()=>{this.setState({value:"",editorState:t&&t("")})}))}else(0,s.flushSync)((()=>{this.setState({value:""})}))}focus(){this._textInput&&this._textInput.focus()}value(){return this.state.value}}Ge.defaultProps={prefillText:"",withEmojiPicker:!0,withGifPicker:!0,withMediaPicker:!0,withVideoTrimmer:!1};const ze=o.default.create((e=>({root:{backgroundColor:e.colors.navigationBackground,borderTopColor:e.colors.borderColor,borderTopWidth:e.borderWidths.small},attachmentContainer:{maxHeight:"10rem",margin:e.spaces.space12},aspectContainer:{flexShrink:1},cardPreviewContainer:{margin:e.spaces.space12},dtabOffset:{marginBottom:e.spaces.space40},gifAttribution:{flexDirection:"row",marginVertical:e.spaces.space4,marginHorizontal:0},mediaPicker:{margin:0},icon:{color:e.colors.primary,fontSize:"1.5em"},composeBoxContainer:{flexGrow:1,flexShrink:1,alignSelf:"center"},mediaPreviewContainer:{flexDirection:"row",height:"100%"},mediaPreview:{borderRadius:e.borderRadii.xLarge,overflow:"hidden",minWidth:"10em"},composer:{alignItems:"center",backgroundColor:e.colors.gray50,borderRadius:e.borderRadii.xLarge,flexDirection:"row",padding:e.spaces.space4,marginHorizontal:e.spaces.space12,marginVertical:e.spaces.space4,width:"calc(100% - 2 * ${theme.spaces.space12})"},composerWithAttachment:{paddingStart:e.spaces.space12},actionButton:{marginStart:e.spaces.space4},uploadButtons:{flexDirection:"row",marginEnd:e.spaces.space4}}))),He=we.forwardRef(Ge)},342478:(e,t,i)=>{i.d(t,{Z:()=>d,f:()=>c});var n=i(24949),a=i(166852);const s=e=>{const{sender_id:t,by_user_id:i,participants:n=[]}=e;return(0,a.Z)(n.map((({user_id:e})=>e)).concat([t,i]).filter(Boolean))};var r=i(668214),o=i(919022);const l=(e,t)=>t.entry,c=(e,t)=>s(t).reduce(((t,i)=>(t[i]=e[i],t)),{}),d=(0,r.Z)().propsFromState((()=>({users:(0,n.P1)(o.ZP.selectAll,l,c)})))},513805:(e,t,i)=>{i.d(t,{FC:()=>m,Fn:()=>u});var n=i(202784),a=i(731708),s=i(111677),r=i.n(s),o=i(275365);const l=r().c1d4ac84,c=r().abc7b032,d=r().i263b294,p=({children:e,conversationId:t})=>n.createElement(a.ZP,{link:`/messages/${t}/participants`},e),u=(e,t)=>e>=2?n.createElement(r().I18NFormatMessage,{$i18n:"e3534477"},n.createElement(p,{conversationId:t},r().i8d5e62b({count:e}))):n.createElement(r().I18NFormatMessage,{$i18n:"b6656851",count:e}),h=({entry:e,users:t})=>e.participants?n.createElement("span",null,e.participants.map((({user_id:e},i)=>{const s=t[e];return s?n.createElement("span",{key:i},i>0?", ":null,n.createElement(a.ZP,null,s.name)):null}))):null,m=(e,t,i,s)=>{const p=i===e.by_user_id;let u;switch(t){case o.Cr.CONVERSATION_AVATAR_UPDATE:return u=e.by_user_id&&s[e.by_user_id]&&s[e.by_user_id].name,u?p?l:(e=>n.createElement(r().I18NFormatMessage,{$i18n:"bff29c95"},n.createElement(a.ZP,null,e)))(u):c;case o.Cr.CONVERSATION_NAME_UPDATE:{const t=n.createElement(a.ZP,null,e.conversation_name);return u=e.by_user_id&&s[e.by_user_id]&&s[e.by_user_id].name,u?p?(e=>n.createElement(r().I18NFormatMessage,{$i18n:"b16e4d45"},e))(t):((e,t)=>n.createElement(r().I18NFormatMessage,{$i18n:"c5760699"},n.createElement(a.ZP,null,e),t))(u,t):(e=>n.createElement(r().I18NFormatMessage,{$i18n:"a72730a1"},e))(t)}case o.Cr.JOIN_CONVERSATION:return u=e.sender_id&&s[e.sender_id]&&s[e.sender_id].name,u?(e=>n.createElement(r().I18NFormatMessage,{$i18n:"fa95b019"},n.createElement(a.ZP,null,e)))(u):d;case o.Cr.PARTICIPANTS_LEAVE:return(e=>n.createElement(r().I18NFormatMessage,{$i18n:"fc10875f"},e))(n.createElement(h,{entry:e,users:s}));case o.Cr.PARTICIPANTS_JOIN:u=e.sender_id&&s[e.sender_id]&&s[e.sender_id].name;return((e,t)=>e?n.createElement(r().I18NFormatMessage,{$i18n:"a4bc88c3"},n.createElement(a.ZP,null,e),t):n.createElement(r().I18NFormatMessage,{$i18n:"bfdff0c3"},t))(u,n.createElement(h,{entry:e,users:s}));default:return""}}}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/shared~loader.DMDrawer~bundle.DirectMessages~bundle.DMRichTextCompose.3dd3d93a.js.map