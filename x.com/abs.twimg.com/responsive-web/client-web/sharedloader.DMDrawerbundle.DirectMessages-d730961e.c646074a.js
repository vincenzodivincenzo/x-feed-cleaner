"use strict";(self.webpackChunk_twitter_responsive_web=self.webpackChunk_twitter_responsive_web||[]).push([["shared~loader.DMDrawer~bundle.DirectMessages-d730961e"],{677226:(e,t,n)=>{n.d(t,{Z:()=>H});var r=n(202784),a=n(309854),s=n(443781),l=n(593953),o=n(668214),c=n(276001),i=n(919022);const d=(e,t)=>t.isMessageItem&&t.entry?.message_data?.attachment?.card,h=(e,t)=>i.ZP.select(e,t.senderId),m=(e,t)=>t.recipientId?i.ZP.select(e,t.recipientId):void 0,u=(0,o.Z)().propsFromState((()=>({card:c.Z.createSingleHydratedSelector(d),user:h,recipient:m})));var p=n(325686),g=n(530525),E=n(439592),b=n(392237),_=n(731708),I=n(111677),f=n.n(I),C=n(301758),v=n(247979),Z=n(575522);const S=f().ga086a54,y=({"aria-label":e,image:t})=>r.createElement(p.Z,{style:M.thumbnail},r.createElement(g.Z,{"aria-label":e,aspectMode:E.Z.SQUARE,backgroundColor:b.default.theme.colors.gray300,image:t})),P=({card:e,tweetUserId:t})=>r.createElement(v.Z,{card:{name:e.name,url:e.url,binding_values:e.binding_values,users:e.users},cardContext:{tweetUserId:t}});function x({"aria-label":e,card:t,content:n,isMessageSearchItem:a=!1,isSelected:s=!1,searchImage:l,tweetId:o,tweetUserId:c,unread:i=!1}){const d=(0,Z.F)(i,s),h=(0,Z.T)(i);return a&&(l||t||o)?r.createElement(p.Z,{style:l?M.mediaContainer:void 0},r.createElement(p.Z,{style:t||o?M.cardMessageText:M.messageText},r.createElement(_.ZP,{color:d,numberOfLines:2,weight:h},n)),t&&c?r.createElement(P,{card:t,tweetUserId:c}):null,o?r.createElement(C.Z,{tweetId:o}):null,l?r.createElement(y,{"aria-label":e||S,image:l}):null):r.createElement(_.ZP,{color:d,numberOfLines:a?2:1,style:a?M.messageText:void 0,weight:h},n)}const M=b.default.create((e=>({thumbnail:{height:e.spacesPx.space40,width:e.spacesPx.space40,borderRadius:e.borderRadii.large,marginStart:`calc(${e.spaces.space8} + ${e.spaces.space2})`,overflow:"hidden"},cardMessageText:{paddingVertical:`calc(${e.spaces.space8} + ${e.spaces.space2})`},messageText:{maxWidth:`calc(100% - (${e.spaces.space48} + ${e.spaces.space2}))`,paddingVertical:e.spaces.space2},mediaContainer:{flexDirection:"row",justifyContent:"space-between"}})));var N=n(451051);const R=f().a9cc8cfe,T=f().e5bfe07e,F=f().bf584cd2,w=f().e20b65b0,D=f().a876e58c,k=f().dedfd266,$=f().i34ec422,A=(e,t)=>t?r.createElement(_.ZP,{key:"senderName"},r.createElement(f().I18NFormatMessage,{$i18n:"b3a2b11d"},r.createElement(_.ZP,null,e))):null,H=u((({card:e,entry:t,perspective:n,isGroupDM:o,highlightingTokens:c,isMessageItem:i,unread:d=!1,user:h={},recipient:m={},isSelected:u=!1})=>{const{featureSwitches:p}=r.useContext(s.rC),g=t&&t.message_data;if(!g)return null;const{attachment:E}=g,b=E&&!!(E.video||E.photo||E.animated_gif||E.tweet||E.fleet||E.sticker||E.card);let I;const C=n===h.id_str,v=!(!b||!C)||!(!o||C),Z=h.name,S=m.name;let y;if(c&&c?.length&&g?.text){const e=(0,l.KC)(c);y=e?.length?e?.map((e=>(0,l.FW)(e,g.text))):void 0}let P,M=((e,t,n,a,s)=>r.createElement(r.Fragment,null,A(e,t)," ",n&&r.createElement(N.Z,{displayTextRange:[0,n.length],entities:a,highlightType:"background",hitHighlights:s,key:"message",text:n,withMediaLinks:!0})))(Z,v,g?.text,g.entities,y);const H=M;E&&(E.tweet?(P=E.tweet.status,M=((e,t,n)=>n?e?r.createElement(_.ZP,null,f().a4939874):r.createElement(f().I18NFormatMessage,{$i18n:"e802e257"},r.createElement(_.ZP,null,t)):$)(C,Z,v)):E.fleet?M=((e,t,n)=>e?r.createElement(f().I18NFormatMessage,{$i18n:"i005f1fd"},r.createElement(_.ZP,null,t),r.createElement(_.ZP,null,n||"")):r.createElement(f().I18NFormatMessage,{$i18n:"b35cee41"},r.createElement(_.ZP,null,n||"")))(C,S,g.text):E.video?(0,l.dI)(E,p)?(M=((e,t,n)=>n?e?r.createElement(_.ZP,null,f().h7033cac):r.createElement(f().I18NFormatMessage,{$i18n:"be5a9617"},r.createElement(_.ZP,null,t)):k)(C,Z,v),I=E.video):(M=((e,t,n)=>n?e?r.createElement(_.ZP,null,f().j7d8101a):r.createElement(f().I18NFormatMessage,{$i18n:"eee2f121"},r.createElement(_.ZP,null,t)):D)(C,Z,v),I=E.video):E.photo?(M=((e,t,n)=>n?e?r.createElement(_.ZP,null,f().f80629ba):r.createElement(f().I18NFormatMessage,{$i18n:"c1e1f849"},r.createElement(_.ZP,null,t)):F)(C,Z,v),I=E.photo):E.animated_gif?(M=((e,t,n)=>n?e?r.createElement(_.ZP,null,f().eb3d722e):r.createElement(f().I18NFormatMessage,{$i18n:"dc4b75a1"},r.createElement(_.ZP,null,t)):R)(C,Z,v),I=E.animated_gif):E.sticker?M=((e,t,n)=>n?e?r.createElement(_.ZP,null,f().d30c2d40):r.createElement(f().I18NFormatMessage,{$i18n:"c7e2464f"},r.createElement(_.ZP,null,t)):w)(C,Z,v):E.card&&(M=((e,t,n)=>n?e?r.createElement(_.ZP,null,f().db53c018):r.createElement(f().I18NFormatMessage,{$i18n:"hcbbbb35"},r.createElement(_.ZP,null,t)):T)(C,Z,v)));const L=I&&i?a.Z.getOriginalImage(I):null,O=I?.ext_alt_text;return r.createElement(x,{"aria-label":O,card:e,content:i?H:M,isMessageSearchItem:i,isSelected:u,searchImage:L,tweetId:P,tweetUserId:g.sender_id,unread:d})}))},25089:(e,t,n)=>{n.d(t,{ZP:()=>W});var r=n(605508),a=n(95539),s=n(131271),l=n(202784),o=n(506899),c=n(325686),i=n(351743),d=n.n(i),h=n(437429),m=n.n(h),u=(n(585488),n(10622)),p=n.n(u),g=n(111677),E=n.n(g),b=n(771613),_=n(965245),I=n(443781),f=n(144256),C=n(736063),v=n(246851),Z=n(883331),S=n(125363),y=n(296196),P=n(674420),x=n(147143),M=n(601576),N=n(700797),R=n(127218),T=n(11582),F=n(340130),w=n(886559),D=n(501774),k=n(795036),$=n(71620),A=n(668214);const H=(0,A.Z)().propsFromState((()=>({pinnedConversationIds:y.selectPinnedConversationIds}))).propsFromActions((()=>({createLocalApiErrorHandler:(0,$.zr)("DM_PINNED_INBOX_CONTEXT")}))).withAnalytics({page:"messages",section:"inbox"}),L=E().e4b3f520,O=E().ae4d666a,q=E().d98e066c,Q=E().j302dba8,U=e=>e,z=s.Z,B={context:"DM_PINNED_INBOX"},G=e=>{const t=(0,S.I0)(),{accessibilityTitle:n,analytics:s,cacheKey:c,conversationIds:i,createLocalApiErrorHandler:h,footer:u,header:g,onNearEnd:E,pinnedConversationIds:C,renderEmptyDMInbox:T,renderInboxItem:$,showSearchView:A,withKeyboardShortcuts:H}=e,B=m()(),{data:G}=(0,R.C)(z,{label:x.w1.PINNED}),K=l.useMemo((()=>G?.labeled_conversation_slice?.items||[]),[G]),{entities:W}=(0,o.Fv)(K,[b.ZP]),{featureSwitches:j}=l.useContext(I.rC),X=j.getNumberValue("dm_conversation_labels_max_pinned_count"),[J,Y]=l.useState(!1),[ee,te]=l.useState(!1),ne=(0,v.Z)(G);l.useEffect((()=>{const e=ne?.labeled_conversation_slice?.items||[],n=e?.filter((e=>-1===K.indexOf(e.rest_id)));n.length&&n.forEach((e=>{const n=e.labels?.filter((e=>e.label_type!==x.w1.PINNED));t((0,P.f)({conversations:{[e.rest_id]:{...e,labels:n}}}))})),t((0,P.f)(W,!1))}),[G]);const re=l.useCallback((()=>{Y(!0);const e=p()(B,z,{label:x.w1.PINNED}).toPromise();Promise.all([e,()=>t(y.fetchInbox())]).then((()=>Y(!1))).catch((e=>{h()(e),Y(!1)}))}),[h,t,B]),[ae]=d()(a.Z),[se]=d()(r.Z),le=l.useCallback(((e,n)=>{ae({variables:{conversation_id:e,label:x.w1.PINNED},onCompleted(r){switch(r.add_dm_conversation_label_v3?.__typename){case"DMConversationLabelInfo":{const{label_type:a,timestamp:s}=r.add_dm_conversation_label_v3;t((0,P.f)({conversations:{[e]:{...n,labels:[{label_type:a,timestamp:s}]}}})),t((0,M.fz)({ariaOnly:!0,text:q}));break}case"DMConversationLabelUnavailable":{const{failure_reason:e}=r.add_dm_conversation_label_v3;s.scribe({element:"thread",action:"error_shown",data:{error_type:F.Yu.MAX_PINS_REACHED}}),"ExceededMaxPinnedConversations"===e&&te(!0);break}}},onError(e){h(Z.n)(e)}})}),[t,h,ae,s]),oe=l.useCallback(((e,n)=>{se({variables:{conversation_id:e,label_type:x.w1.PINNED},onCompleted(r){const a=n?n?.labels?.filter((e=>e.label_type!==x.w1.PINNED)):[];t((0,P.f)({conversations:{[e]:{...n,labels:a}}})),t((0,M.fz)({ariaOnly:!0,text:Q}))},updater(t){const n=K.find((t=>t.rest_id===e))?.id,r=G?.labeled_conversation_slice?.__id;if(!n||!r)return;const a=t.get(n),s=t.get(r);s&&a&&((0,N.wz)(s,n),t.delete(n))},onError(e){h(Z._)(e)}})}),[h,K,G?.labeled_conversation_slice?.__id,t,se]),ce=i?.filter((e=>-1===C.indexOf(e))),ie=C.length&&ce.length,de=l.createElement(l.Fragment,null,g,C?.length?l.createElement(l.Fragment,null,V(L),C.map(((e,t)=>$({conversationIds:C,pinConversation:le,unpinConversation:oe})(e)))):null,ie?V(O):null);return i?.length?l.createElement(l.Fragment,null,ee?l.createElement(D.Z,{count:X,setShowPinError:te}):null,A?l.createElement(k.Z,{accessibilityTitle:n,analytics:s,conversationIds:i,hideRecentSearches:e.hideRecentSearches,onQueryChange:e.onQueryChange,pinConversation:le,query:e.query,unpinConversation:oe}):l.createElement(f.Z,{isRefreshing:J,onRefresh:re},c&&ce?.length?l.createElement(_.Z,{accessibilityTitle:n,anchoring:w.Z,assumedItemHeight:100,cacheKey:c,footer:u,header:de,identityFunction:U,items:ce,onNearEnd:E,renderer:$({conversationIds:ce,pinConversation:le,unpinConversation:oe}),role:"tablist",withKeyboardShortcuts:H,withoutHeadroom:!0}):de)):T()},V=e=>l.createElement(c.Z,null,l.createElement(T.ZP,{headerText:e,isInboxLabelHeader:!0}));function K(e){return l.createElement(C.H,{errorConfig:B},l.createElement(G,e))}const W=H(l.memo(K))},138214:(e,t,n)=>{n.d(t,{Z:()=>I});var r=n(202784),a=n(443781),s=n(340130),l=n(593953),o=n(668214),c=n(627279),i=n(919022);const d=(e,t)=>t.senderId?i.ZP.select(e,t.senderId):void 0,h=(e,t)=>(0,c.WK)(e,t.reactionEntry.message_id),m=(e,t)=>{const n=h(e,t);return n&&n.message_data&&i.ZP.select(e,n.message_data.sender_id)},u=(0,o.Z)().propsFromState((()=>({reactingUser:d,reactedMessageEntry:h,messageUser:m})));var p=n(731708),g=n(111677),E=n.n(g),b=n(575522);function _({emojiReaction:e,isGroupDM:t,isSelected:n,messageScreenName:a,messageText:l,perspective:o,reacterId:c,reacterName:i,type:d,unread:h}){const m=o===c,u=(0,b.T)(h),g=(0,b.F)(h,n);let _;return _=d===s.C7.TWEET?t?((e,t,n,a)=>e?r.createElement(E().I18NFormatMessage,{$i18n:"hc1bd66d"},r.createElement(p.ZP,null,n),r.createElement(p.ZP,null,a)):r.createElement(E().I18NFormatMessage,{$i18n:"bd3edf13"},r.createElement(p.ZP,null,t),r.createElement(p.ZP,null,n),r.createElement(p.ZP,null,a)))(m,i,a,e):((e,t,n)=>e?r.createElement(E().I18NFormatMessage,{$i18n:"df2dc76f"},r.createElement(p.ZP,null,n)):r.createElement(E().I18NFormatMessage,{$i18n:"aba18aef"},r.createElement(p.ZP,null,t),r.createElement(p.ZP,null,n)))(m,i,e):d===s.C7.VIDEO?t?((e,t,n,a)=>e?r.createElement(E().I18NFormatMessage,{$i18n:"d1f8bdd9"},r.createElement(p.ZP,null,n),r.createElement(p.ZP,null,a)):r.createElement(E().I18NFormatMessage,{$i18n:"d764af97"},r.createElement(p.ZP,null,t),r.createElement(p.ZP,null,n),r.createElement(p.ZP,null,a)))(m,i,a,e):((e,t,n)=>e?r.createElement(E().I18NFormatMessage,{$i18n:"ab1cdfe3"},r.createElement(p.ZP,null,n)):r.createElement(E().I18NFormatMessage,{$i18n:"f0cf1699"},r.createElement(p.ZP,null,t),r.createElement(p.ZP,null,n)))(m,i,e):d===s.C7.PHOTO?t?((e,t,n,a)=>e?r.createElement(E().I18NFormatMessage,{$i18n:"hec0fd4d"},r.createElement(p.ZP,null,n),r.createElement(p.ZP,null,a)):r.createElement(E().I18NFormatMessage,{$i18n:"j55320df"},r.createElement(p.ZP,null,t),r.createElement(p.ZP,null,n),r.createElement(p.ZP,null,a)))(m,i,a,e):((e,t,n)=>e?r.createElement(E().I18NFormatMessage,{$i18n:"jf27606b"},r.createElement(p.ZP,null,n)):r.createElement(E().I18NFormatMessage,{$i18n:"cd110359"},r.createElement(p.ZP,null,t),r.createElement(p.ZP,null,n)))(m,i,e):d===s.C7.GIF?t?((e,t,n,a)=>e?r.createElement(E().I18NFormatMessage,{$i18n:"e70dcc35"},r.createElement(p.ZP,null,n),r.createElement(p.ZP,null,a)):r.createElement(E().I18NFormatMessage,{$i18n:"g1bf440b"},r.createElement(p.ZP,null,t),r.createElement(p.ZP,null,n),r.createElement(p.ZP,null,a)))(m,i,a,e):((e,t,n)=>e?r.createElement(E().I18NFormatMessage,{$i18n:"b2da1bf9"},r.createElement(p.ZP,null,n)):r.createElement(E().I18NFormatMessage,{$i18n:"g84c0421"},r.createElement(p.ZP,null,t),r.createElement(p.ZP,null,n)))(m,i,e):d===s.C7.CARD?t?((e,t,n,a)=>e?r.createElement(E().I18NFormatMessage,{$i18n:"cd2e7c19"},r.createElement(p.ZP,null,n),r.createElement(p.ZP,null,a)):r.createElement(E().I18NFormatMessage,{$i18n:"aee9e7fb"},r.createElement(p.ZP,null,t),r.createElement(p.ZP,null,n),r.createElement(p.ZP,null,a)))(m,i,a,e):((e,t,n)=>e?r.createElement(E().I18NFormatMessage,{$i18n:"f9fb1cf7"},r.createElement(p.ZP,null,n)):r.createElement(E().I18NFormatMessage,{$i18n:"f2bf910f"},r.createElement(p.ZP,null,t),r.createElement(p.ZP,null,n)))(m,i,e):d===s.C7.TEXT?t?((e,t,n,a,s)=>e?r.createElement(E().I18NFormatMessage,{$i18n:"i6cec545"},r.createElement(p.ZP,null,a),r.createElement(p.ZP,null,n),r.createElement(p.ZP,null,s)):r.createElement(E().I18NFormatMessage,{$i18n:"d6998bab"},r.createElement(p.ZP,null,t),r.createElement(p.ZP,null,a),r.createElement(p.ZP,null,n),r.createElement(p.ZP,null,s)))(m,i,e,a,l):((e,t,n,a)=>e?r.createElement(E().I18NFormatMessage,{$i18n:"cec676f3"},r.createElement(p.ZP,null,n),r.createElement(p.ZP,null,a)):r.createElement(E().I18NFormatMessage,{$i18n:"a2706f9b"},r.createElement(p.ZP,null,t),r.createElement(p.ZP,null,n),r.createElement(p.ZP,null,a)))(m,i,e,l):d===s.C7.VOICE?t?((e,t,n,a)=>e?r.createElement(E().I18NFormatMessage,{$i18n:"ff973a65"},r.createElement(p.ZP,null,n),r.createElement(p.ZP,null,a)):r.createElement(E().I18NFormatMessage,{$i18n:"ec2cede5"},r.createElement(p.ZP,null,t),r.createElement(p.ZP,null,n),r.createElement(p.ZP,null,a)))(m,i,a,e):((e,t,n)=>e?r.createElement(E().I18NFormatMessage,{$i18n:"i1d08199"},r.createElement(p.ZP,null,n)):r.createElement(E().I18NFormatMessage,{$i18n:"d424b45f"},r.createElement(p.ZP,null,t),r.createElement(p.ZP,null,n)))(m,i,e):((e,t,n)=>e?r.createElement(E().I18NFormatMessage,{$i18n:"d6b15bbf"},r.createElement(p.ZP,null,n)):r.createElement(E().I18NFormatMessage,{$i18n:"ac0d4bc7"},r.createElement(p.ZP,null,t),r.createElement(p.ZP,null,n)))(m,i,e),r.createElement(p.ZP,{color:g,numberOfLines:1,weight:u},_)}const I=u((({isGroupDM:e,isSelected:t=!1,messageUser:n,perspective:o,reactedMessageEntry:c,reactingUser:i,reactionEntry:d,unread:h=!1})=>{const{featureSwitches:m}=r.useContext(a.rC),u=c&&c.message_data,p=u&&u.attachment,g=u&&u.text,E=n&&n.screen_name,b=i&&i.id_str,I=i&&i.name,f=d.emoji_reaction||"";let C=s.C7.UNKNOWN;return p?p.tweet?C=s.C7.TWEET:p.video?C=(0,l.dI)(p,m)?s.C7.VOICE:s.C7.VIDEO:p.photo?C=s.C7.PHOTO:p.animated_gif?C=s.C7.GIF:p.card&&(C=s.C7.CARD):g&&(C=s.C7.TEXT),r.createElement(_,{emojiReaction:f,isGroupDM:e,isSelected:t,messageScreenName:E,messageText:g,perspective:o,reacterId:b,reacterName:I,type:C,unread:h})}))},795036:(e,t,n)=>{n.d(t,{Z:()=>Xe});var r=n(202784),a=n(614983),s=n.n(a),l=n(325686),o=n(457311),c=n(731708),i=n(530732),d=n(154003),h=n(371344),m=n(392237),u=n(111677),p=n.n(u),g=n(894966),E=n(956272),b=n(827515),_=n(666536),I=n(290402),f=n(822228),C=n(965245),v=n(507651),Z=n(443781),S=n(144256),y=n(500002),P=n(275365),x=n(147143),M=n(622333),N=n(11582),R=n(511495),T=n(340130),F=n(886559),w=n(572925),D=n(420412),k=n(430895),$=n(125966),A=n(25001),H=n(246851),L=n(87063),O=n(71620),q=n(668214);const Q=(e,{module:t})=>t.selectItems(e),U=(e,{module:t})=>t.selectFetchStatus(e),z=(0,q.Z)().propsFromState((()=>({fetchStatus:U,sliceItems:Q}))).adjustStateProps((({fetchStatus:e,sliceItems:t})=>{const n=(e=>e.find((e=>e.groupData))?.groupData?.result||[])(t),r=(e=>e.find((e=>e.peopleData))?.peopleData?.result||[])(t),a=(e=>e.find((e=>e.messageData))?.messageData?.conversationIds||[])(t),s=(e=>e.find((e=>e.messageData))?.messageData?.entryIds||[])(t),l=(e=>e.find((e=>e.groupData))?.groupData?.highlightingTokens)(t),o=(e=>e.find((e=>e.messageData))?.messageData?.highlightingTokens)(t),c=(e=>e.find((e=>e.peopleData))?.peopleData?.highlightingTokens)(t);return{entryIds:s,fetchStatus:e,groupConversationIds:n,groupHighlightingTokens:l,messageConversationIds:a,messageHighlightingTokens:o,peopleHighlightingTokens:c,peopleSearchConversationIds:r,sliceItems:t}})).propsFromActions((({module:e})=>({createLocalApiErrorHandler:(0,O.zr)("DM_SEARCH_ALL_CONTEXT"),fetchSearchIfNeeded:e.fetchIfNeeded}))),B=p().ffd9cfe6;function G(e){const{location:t,tabLabel:n}=e;return r.createElement(l.Z,{style:V.footer},r.createElement(c.ZP,{link:{pathname:t.pathname,state:{tab:n}}},B))}const V=m.default.create((e=>({footer:{backgroundColor:e.colors.cellBackground,paddingStart:e.spaces.space16,paddingVertical:e.spaces.space12,alignItems:"center",flexDirection:"row",justifyContent:"space-between",borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small,borderBottomColor:e.colors.borderColor,borderTopStyle:"solid",borderTopWidth:e.borderWidths.small,borderTopColor:e.colors.borderColor}}))),K=p().c94ac69e,W=p().a2f81050,j=p().g2fd3206;const X=z((function(e){const t=r.useContext(Z.rC),{fetchStatus:n,loadingLabel:a,module:s}=e,l=(0,H.Z)(s),o=t.featureSwitches.getNumberValue("dm_inbox_search_groups_bucket_size"),c=t.featureSwitches.getNumberValue("dm_inbox_search_messages_bucket_size"),i=t.featureSwitches.getNumberValue("dm_inbox_search_people_bucket_size"),d=r.useCallback((()=>{const{createLocalApiErrorHandler:t,fetchSearchIfNeeded:n}=e;n().catch(t())}),[e]);r.useEffect((()=>{l!==s&&n!==L.Z.FAILED&&d()}),[n,d,s,l]);const h=({headerText:e,icon:t})=>r.createElement(N.ZP,{headerText:e,icon:t}),m=()=>{const{entryIds:t,messageConversationIds:n,messageHighlightingTokens:a,pinConversation:s,renderInboxItem:l,unpinConversation:o}=e;return r.createElement(r.Fragment,null,h({icon:$.default,headerText:W}),t.map(((e,r)=>e?(e=>l({conversationIds:n,isMessageItem:!0,messageIds:t,pinConversation:s,unpinConversation:o,highlightingTokens:a})(e))(e):null)).slice(0,c))};return r.createElement(I.Z,{"aria-label":a,fetchStatus:n,onRequestRetry:d,render:()=>{const{groupConversationIds:t,location:n,messageConversationIds:a,peopleSearchConversationIds:s,renderEmptyState:l}=e,d=s.length&&t.length,u=o<t.length,p=c<a.length,g=i<s.length;return t?.length||s.length||a.length?r.createElement(r.Fragment,null,s.length?(()=>{const{peopleHighlightingTokens:t,peopleSearchConversationIds:n,pinConversation:a,renderInboxItem:s,unpinConversation:l}=e;return r.createElement(r.Fragment,null,h({icon:A.default,headerText:j}),n.map(((e,r)=>e?s({conversationIds:n,pinConversation:a,unpinConversation:l,highlightingTokens:t})(e):null)).slice(0,i))})():null,d&&!g?r.createElement(D.Z,null):null,g?r.createElement(G,{location:n,tabLabel:j}):null,t.length?(()=>{const{groupConversationIds:t,groupHighlightingTokens:n,pinConversation:a,renderInboxItem:s,unpinConversation:l}=e;return r.createElement(r.Fragment,null,h({icon:k.default,headerText:K}),t.map(((e,r)=>e?s({conversationIds:t,pinConversation:a,unpinConversation:l,highlightingTokens:n})(e):null)).slice(0,o))})():null,u?r.createElement(G,{location:n,tabLabel:K}):null,a.length?m():null,p?r.createElement(G,{location:n,tabLabel:W}):null):l()}})})),J=X;var Y=n(24949),ee=n(599138);const te=(e,t)=>t.query,ne=(0,q.Z)().propsFromState((()=>({sliceModule:(0,Y.P1)(te,(e=>e?(0,ee.Z)(e):void 0))})))((e=>{const{loadingLabel:t,location:n,pinConversation:a,query:s,renderEmptyState:l,renderInboxItem:o,sliceModule:c,unpinConversation:i}=e;return c?r.createElement(J,{loadingLabel:t,location:n,module:c,pinConversation:a,query:s,renderEmptyState:l,renderInboxItem:o,unpinConversation:i}):l()})),re=ne;var ae=n(296196),se=n(312771);const le=ae.selectRecentSearches,oe=(e,t)=>t.query?ae.selectSearchConversations(e,t.query):[],ce=(e,t)=>t.query?ae.selectSearchFetchStatus(e,t.query):se.ZP.LOADED,ie=(e,t)=>t.conversationIds||[],de=(e,t)=>e?.length?t.filter((t=>e.indexOf(t)>-1)):e,he=(0,q.Z)().propsFromState((()=>({conversationIds:ie,recentSearches:le,searchFetchStatus:ce,searchConversationIds:oe}))).adjustStateProps((({conversationIds:e,recentSearches:t,searchConversationIds:n,searchFetchStatus:r})=>({conversationIds:e,recentSearches:t,searchFetchStatus:r,searchConversationIds:de(n,e)}))).propsFromActions((()=>({addRecentSearch:ae.addRecentSearches,createLocalApiErrorHandler:(0,O.zr)("DIRECT_MESSAGES_SEARCH"),search:ae.searchConversations,clearRecentSearch:ae.clearRecentSearch,clearRecentSearches:ae.clearRecentSearches})));var me=n(618012),ue=n(705414),pe=n(506899),ge=(n(585488),n(908478)),Ee=n(771613),be=n(736063),_e=n(125363),Ie=n(674420),fe=n(127218);const Ce=ue.Z,ve=me.Z,Ze="DM_CONVERSATION_SEARCH",Se={context:Ze},ye=e=>e,Pe=e=>{const{footer:t,noItemsRenderer:n,onScrollEnd:a,pinConversation:s,renderInboxItem:l,searchTerm:o,tabType:c,unpinConversation:i}=e,d=(0,_e.I0)(),h=!0,m=c===T.TG.GROUPS?Ce:ve,{data:u,fetchNext:p,hasNext:g}=(0,fe.C)(m,{query:o,withConversationQueryHighlights:h});let E;u?.dm_group_convo_slice_result?E=u?.dm_group_convo_slice_result?.items:u?.dm_people_convo_slice_result&&(E=u?.dm_people_convo_slice_result?.items);const{entities:b,highlightingTokens:_,normalizedConversations:I}=r.useMemo((()=>{const e=E?.map((e=>e?.dm_convo_search))||{},t=E?.map((e=>e?.highlighting?.query_tokens)),n=(0,pe.Fv)(e,[Ee.ZP]);return{normalizedConversations:n,entities:{...n?.entities},highlightingTokens:t}}),[E,h]),f=(0,H.Z)(u);return r.useEffect((()=>{(0,ge.Z)(u,f)||d((0,Ie.f)(b,!0))}),[b,u,f,d]),r.createElement(C.Z,{cacheKey:Ze,footer:g?null:t,identityFunction:ye,items:I?.result,noItemsRenderer:n,onNearEnd:p,onScrollEnd:a,renderer:l({conversationIds:I?.result,isMessageItem:!1,pinConversation:s,unpinConversation:i,highlightingTokens:_}),withoutHeadroom:!0})};function xe(e){return r.createElement(be.H,{errorConfig:Se},r.createElement(Pe,e))}const Me=n(463450).Z,Ne="DM_MESSAGE_SEARCH",Re={context:Ne},Te=e=>e,Fe=e=>{const{footer:t,noItemsRenderer:n,onScrollEnd:a,pinConversation:s,renderInboxItem:l,searchTerm:o,unpinConversation:c}=e,i=(0,_e.I0)(),d=!0,{data:h,fetchNext:m,hasNext:u}=(0,fe.C)(Me,{query:o,withAttachments:!0,withMessageQueryHighlights:d}),{entities:p,highlightingTokens:g,normalizedConversations:E,normalizedMessages:b}=r.useMemo((()=>{const e=h?.dm_message_slice_result?.items?.map((e=>e?.dm_event?.legacy?.conversation)),t=h?.dm_message_slice_result?.items,n=t?.map((e=>e?.highlighting?.query_tokens)),r=(0,pe.Fv)(e,[Ee.ZP]),a=(0,pe.Fv)(t,[Ee.JJ]);return{normalizedConversations:r,normalizedMessages:a,entities:{...r?.entities,...a?.entities},highlightingTokens:n}}),[h?.dm_message_slice_result?.items,d]),_=(0,H.Z)(h);return r.useEffect((()=>{(0,ge.Z)(h,_)||i((0,Ie.f)(p,!0))}),[p,h,_,i]),r.createElement(C.Z,{cacheKey:Ne,footer:u?null:t,identityFunction:Te,items:b?.result,noItemsRenderer:n,onNearEnd:m,onScrollEnd:a,renderer:l({conversationIds:E?.result,isMessageItem:!0,messageIds:b?.result,pinConversation:s,unpinConversation:c,highlightingTokens:g}),withoutHeadroom:!0})};function we(e){return r.createElement(be.H,{errorConfig:Re},r.createElement(Fe,e))}const De=e=>e,ke=p().b08821f4,$e=p().a66ac766,Ae=p().a846382a,He=p().b9dae4f4,Le=p().e7fb2028,Oe=p().ae111c99,qe=p().e8581cce,Qe=p().f08940ac,Ue=p().i5d7593a,ze=p().f8321d82,Be=p().c94ac69e,Ge=p().a2f81050,Ve=p().g2fd3206,Ke=p().fb3c8e74;class We extends r.Component{constructor(...e){super(...e),this.state={debouncedQuery:"",isLoadingMore:!1,isRefreshing:!1},this._setInputRef=e=>{this._textInputRef=e},this._handleConversationClick=(e,t,n,r)=>{const{analytics:a}=this.props,s=n?.participants.length||0,l=n?.type===P.eD.GROUP;a.scribe({element:"thread",action:"click",data:{event_value:this.props.query.length,conversation_id:t,conversation_participant_count:s,conversation_type:l?T.NK.GROUP:T.NK.ONE_TO_ONE,position:r}})},this._renderEmptyDMSearchInbox=()=>{const{analytics:e,query:t}=this.props,{debouncedQuery:n}=this.state;return n&&t?(e.scribe({component:"search",element:"results",action:"empty"}),r.createElement(o.Z,{buttonLink:"/messages/compose",buttonText:Qe,header:Oe({query:n}),message:qe,onButtonPress:this._handleComposeButtonPress})):r.createElement(l.Z,{style:je.emptyState},r.createElement(c.ZP,{align:"center",color:"gray700"},Ue))},this._renderRecentSearches=()=>{const{analytics:e,query:t,recentSearches:n}=this.props;return n.length&&!t?r.createElement(r.Fragment,null,r.createElement(N.ZP,{analytics:e,clearRecentSearches:this._clearRecentSearches,headerText:Ke,withClearButton:!0}),n.map((e=>r.createElement(R.Z,{clearRecentSearch:t=>this._handleClearRecentSearch(t,e),handleRecentSearchClick:()=>this._handleRecentSearchClick(e),key:e,recentSearch:e})))):this._renderEmptyDMSearchInbox()},this._renderAllDMSearchResultsTab=()=>{const{debouncedQuery:e}=this.state;return e?this._renderAllDMSearchResults():this._renderEmptyDMSearchInbox()},this._renderAllDMSearchResults=()=>{const{location:e,pinConversation:t,unpinConversation:n}=this.props,{debouncedQuery:a}=this.state;return r.createElement(re,{loadingLabel:$e,location:e,pinConversation:t,query:a,renderEmptyState:this._renderEmptyDMSearchInbox,renderInboxItem:this._renderSearchInboxItem,unpinConversation:n})},this._renderConversationsTab=e=>{const{pinConversation:t,unpinConversation:n}=this.props,{debouncedQuery:a}=this.state;return r.createElement(xe,{footer:this._renderFooter(),noItemsRenderer:this._renderEmptyDMSearchInbox,onScrollEnd:this._handleScrollEnd,pinConversation:t,renderInboxItem:this._renderSearchInboxItem,searchTerm:a,tabType:e?T.TG.GROUPS:T.TG.PEOPLE,unpinConversation:n})},this._renderMessagesTab=()=>{const{pinConversation:e,unpinConversation:t}=this.props,{debouncedQuery:n}=this.state;return n?r.createElement(we,{footer:this._renderFooter(),noItemsRenderer:this._renderEmptyDMSearchInbox,onScrollEnd:this._handleScrollEnd,pinConversation:e,renderInboxItem:this._renderSearchInboxItem,searchTerm:n,unpinConversation:t}):this._renderEmptyDMSearchInbox()},this._renderTabContent=()=>{const{location:e}=this.props,{tab:t}=e?.state||{};switch(t){case Ve:return this._renderConversationsTab(!1);case Be:return this._renderConversationsTab(!0);case Ge:return this._renderMessagesTab();default:return this._renderAllDMSearchResultsTab()}},this._renderSearchInboxItem=({conversationIds:e,highlightingTokens:t,isMessageItem:n=!1,messageIds:a,pinConversation:l,unpinConversation:o})=>(c,i)=>{const{viewerUserId:d}=this.context,{location:h}=this.props,{query:m}=this.props,u=n?(a||[]).indexOf(c):-1,p=-1!==u&&e?.length?e[u]:null,g=p?c:"",E=p||c,_={pathname:`/messages/${E}`,state:{...h?.state,entryPoint:null,searchQuery:m}},I=E&&e?.length?e.indexOf(E):null,C=I?I+1:0;s()(!!d,"viewerUserId must be defined"),i&&i(!0);const v=t?.length&&(0,b.Z)(I)&&I>=0?t[I]:void 0,Z=e=>r.createElement(w.Z,{conversationId:E,highlightingTokens:v,inboxType:x._2.PRIMARY,isActive:e,isMessageItem:n,key:E,link:_,messageId:g,onClick:this._handleConversationClick,perspective:d,pinConversation:l,position:C,searchQuery:m,unpinConversation:o});return r.createElement(f.Z,{exact:!1,path:_.pathname},Z)},this._renderSearchResults=()=>{const{accessibilityTitle:e,pinConversation:t,searchConversationIds:n,unpinConversation:a}=this.props,{isRefreshing:s}=this.state;return r.createElement(l.Z,null,r.createElement(S.Z,{isRefreshing:s,onRefresh:this._handlePullToRefresh},r.createElement(C.Z,{accessibilityTitle:e,anchoring:F.Z,assumedItemHeight:100,cacheKey:"dmSearchInbox",footer:this._renderFooter(),identityFunction:De,items:n,noItemsRenderer:this._renderRecentSearches,onNearEnd:this._handleNearEnd,onScrollEnd:this._handleScrollEnd,renderer:this._renderSearchInboxItem({conversationIds:n,pinConversation:t,unpinConversation:a}),role:"tablist",withoutHeadroom:!0})))},this._renderFooter=()=>this.state.isLoadingMore?r.createElement(M.Z,null):r.createElement(l.Z,{style:je.footerContainer},r.createElement(c.ZP,{align:"center",size:"body",weight:"bold"},Le),r.createElement(i.Z,{interactiveStyles:null},r.createElement(c.ZP,{align:"center",color:"primary",onPress:this._handleFooterClick,size:"subtext2",withInteractiveStyling:!0},He))),this._clearRecentSearches=()=>{const{analytics:e,clearRecentSearches:t}=this.props;e.scribe({component:"recent_search",action:"clear"}),t()},this._handleComposeButtonPress=()=>{const{analytics:e}=this.props;e.scribe({component:"search",element:"empty_results",action:"compose"})},this._handleFooterClick=()=>{this._textInputRef?.clear(),this._textInputRef?.focus()},this._handleRefetchSearch=()=>{const{analytics:e,createLocalApiErrorHandler:t,search:n}=this.props,{debouncedQuery:r}=this.state;n&&r&&(e.scribe({component:"search",element:"retry",action:"click"}),n({query:r.toLowerCase(),preserveResults:!1,fetchNextPage:!1}).catch(t()))},this._handlePullToRefresh=()=>{const{createLocalApiErrorHandler:e,search:t}=this.props,{debouncedQuery:n}=this.state;this.setState({isRefreshing:!0}),t&&n&&t({query:n.toLowerCase(),preserveResults:!0,fetchNextPage:!1}).then((()=>this.setState({isRefreshing:!1}))).catch((t=>(this.setState({isRefreshing:!1}),e()(t))))},this._handleSearchChangeInner=e=>{const{onQueryChange:t}=this.props;t(e),this.setState({debouncedQuery:e})},this._handleSearchChangeDebounced=(0,_.Z)(this._handleSearchChangeInner,200),this._handleSearchChange=({currentTarget:{value:e}})=>{const{onQueryChange:t}=this.props;(e&&e.trim()||!e)&&(t(e),this._handleSearchChangeDebounced(e))},this._handleNearEnd=()=>{const{analytics:e,search:t}=this.props,{debouncedQuery:n}=this.state;this.setState({isLoadingMore:!0}),n&&(e.scribe({component:"search",element:"results",action:"get_older"}),t({query:n,preserveResults:!1,fetchNextPage:!0}).finally((()=>this.setState({isLoadingMore:!1}))))},this._handleScrollEnd=()=>{const{addRecentSearch:e,analytics:t,query:n}=this.props,{debouncedQuery:r}=this.state;r&&n&&(e(n),t.scribe({component:"recent_search",action:"add"}))},this._handleSearchClear=()=>this._handleSearchChangeInner(""),this._handleHideRecentSearches=()=>{const{hideRecentSearches:e}=this.props;e()},this._handleAddRecentSearch=({currentTarget:{value:e}})=>{const{addRecentSearch:t,analytics:n}=this.props;e&&(t(e),n.scribe({component:"recent_search",action:"add"}),this._textInputRef&&this._textInputRef.blur())},this._handleRecentSearchClick=e=>{const{analytics:t,onQueryChange:n}=this.props;n(e),t.scribe({component:"recent_search",action:"click"}),this._handleSearchChangeInner(e)},this._handleClearRecentSearch=(e,t)=>{const{analytics:n,clearRecentSearch:r}=this.props;e.stopPropagation(),e.preventDefault(),n.scribe({component:"recent_search",action:"clear"}),r(t)}}componentDidMount(){const{location:e}=this.props;e?.state?.searchQuery&&this._handleSearchChangeInner(e?.state?.searchQuery),this._textInputRef&&this._textInputRef.focus()}componentDidUpdate(e){const{analytics:t,query:n,recentSearches:r}=this.props;e.query||!n||r.includes(n)||t.scribe({component:"search",action:"began_typing"})}render(){const{location:e,query:t,searchFetchStatus:n}=this.props,{tab:a}=e?.state||{},s=[ze,Ve,Be,Ge].map((t=>({key:t,label:t,"aria-label":t,isActive:()=>a===t||!a&&t===ze,to:{...e,state:{...e.state,tab:t}}})));return r.createElement(r.Fragment,null,r.createElement(l.Z,{style:je.searchInput},r.createElement(d.ZP,{"aria-label":ke,icon:r.createElement(g.default,null),onPress:this._handleHideRecentSearches,pullLeft:!0,type:"primaryText"}),r.createElement(h.Z,{Icon:E.default,autoComplete:"off",onChange:this._handleSearchChange,onClear:this._handleSearchClear,onSubmitEditing:this._handleAddRecentSearch,placeholder:Ae,ref:this._setInputRef,value:t,withClearButton:!0})),t||a===Ve||a===Be||a===Ge?r.createElement(r.Fragment,null,r.createElement(v.Z,{links:s}),this._renderTabContent()):r.createElement(I.Z,{"aria-label":$e,fetchStatus:n,onRequestRetry:this._handleRefetchSearch,render:this._renderSearchResults}))}}We.contextType=Z.rC,We.defaultProps={recentSearches:[],searchConversationIds:[],query:""};const je=m.default.create((e=>({emptyState:{marginTop:e.spaces.space32},searchInput:{backgroundColor:e.colors.cellBackground,padding:e.spaces.space12,flexDirection:"row",alignItems:"center",zIndex:1},searchInputBorder:{borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small},footerContainer:{marginVertical:e.spaces.space32}}))),Xe=(0,y.ZP)(he(We))}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/shared~loader.DMDrawer~bundle.DirectMessages-d730961e.c646074a.js.map