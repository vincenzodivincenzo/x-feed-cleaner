"use strict";(self.webpackChunk_twitter_responsive_web=self.webpackChunk_twitter_responsive_web||[]).push([["shared~loader.SideNav~loader.SideNavRedesign-6107ac1a"],{326439:(e,t,s)=>{s.d(t,{Z:()=>d});var i,a,l,n,r,o={fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SensitiveMediaSettingsQuery",selections:[{alias:"viewer",args:i=[{kind:"Literal",name:"s",value:"cd25"}],concreteType:"Viewer",kind:"LinkedField",name:"viewer_v2",plural:!1,selections:[{alias:null,args:null,concreteType:"UserResults",kind:"LinkedField",name:"user_results",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"result",plural:!1,selections:[a={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},{kind:"InlineFragment",selections:[l={alias:null,args:null,kind:"ScalarField",name:"rest_id",storageKey:null},{alias:null,args:null,concreteType:"UserSensitiveMediaSettingsInfo",kind:"LinkedField",name:"sensitive_media_settings",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"SensitiveMediaOptions_userSensitiveMediaSettingsInfo"},n={alias:null,args:null,kind:"ScalarField",name:"can_user_allow_sensitive_content",storageKey:null}],storageKey:null}],type:"User",abstractKey:null}],storageKey:null}],storageKey:null}],storageKey:'viewer_v2(s:"cd25")'}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"SensitiveMediaSettingsQuery",selections:[{alias:"viewer",args:i,concreteType:"Viewer",kind:"LinkedField",name:"viewer_v2",plural:!1,selections:[{alias:null,args:null,concreteType:"UserResults",kind:"LinkedField",name:"user_results",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"result",plural:!1,selections:[a,{kind:"InlineFragment",selections:[l,{alias:null,args:null,concreteType:"UserSensitiveMediaSettingsInfo",kind:"LinkedField",name:"sensitive_media_settings",plural:!1,selections:[{alias:null,args:null,concreteType:"SensitiveMediaSettings",kind:"LinkedField",name:"sensitive_media_settings",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"view_adult_content",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"view_violent_content",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"view_other_content",storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"__id",storageKey:null}]}],storageKey:null},n],storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],type:"User",abstractKey:null}],storageKey:null},r],storageKey:null}],storageKey:'viewer_v2(s:"cd25")'}]},params:{id:"ft92vAsha0RhDxwgq_ojWQ",metadata:{},name:"SensitiveMediaSettingsQuery",operationKind:"query",text:null}};o.hash="47444c8ec7640b723fc59a35b0544d70";const d=o},929446:(e,t,s)=>{s.d(t,{Z:()=>a});var i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"UserCell_user",selections:[{alias:null,args:null,kind:"ScalarField",name:"is_blue_verified",storageKey:null},{alias:null,args:null,concreteType:"UserAvatar",kind:"LinkedField",name:"avatar",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"image_url",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"UserCore",kind:"LinkedField",name:"core",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{kind:"RequiredField",field:{alias:null,args:null,kind:"ScalarField",name:"screen_name",storageKey:null},action:"THROW"}],storageKey:null},{alias:null,args:null,concreteType:"ApiUser",kind:"LinkedField",name:"legacy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id_str",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"UserPrivacy",kind:"LinkedField",name:"privacy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"protected",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"HighlightedUserLabelResponse",kind:"LinkedField",name:"identity_profile_labels_highlighted_label",plural:!1,selections:[{alias:null,args:null,concreteType:"HighlightedUserLabel",kind:"LinkedField",name:"label",plural:!1,selections:[{alias:null,args:null,concreteType:"TimelineUrl",kind:"LinkedField",name:"url",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"TimelineUrl"}],storageKey:null},{alias:null,args:null,concreteType:"BadgeInfo",kind:"LinkedField",name:"badge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:"userLabelType",args:null,kind:"ScalarField",name:"user_label_type",storageKey:null},{alias:"userLabelDisplayType",args:null,kind:"ScalarField",name:"user_label_display_type",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"UserRelationshipPerspectives",kind:"LinkedField",name:"relationship_perspectives",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"followed_by",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"UserVerification",kind:"LinkedField",name:"verification",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"verified",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"verified_type",storageKey:null}],storageKey:null}],type:"User",abstractKey:null,hash:"ab0af0b13c7da685f6b351a941a47db3"};const a=i},498510:(e,t,s)=>{s.d(t,{Z:()=>d});var i,a,l,n,r,o={fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"fetchDownloadSettingAllowedQuery",selections:[{kind:"RequiredField",field:i={alias:null,args:null,concreteType:"UserPreferences",kind:"LinkedField",name:"user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"allow_video_downloads",storageKey:null}],storageKey:null},action:"THROW"},{alias:"viewer",args:a=[{kind:"Literal",name:"s",value:"4721"}],concreteType:"Viewer",kind:"LinkedField",name:"viewer_v2",plural:!1,selections:[{alias:null,args:null,concreteType:"UserResults",kind:"LinkedField",name:"user_results",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"result",plural:!1,selections:[l={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},{kind:"InlineFragment",selections:[n={alias:null,args:null,concreteType:"LegacyExtendedUserProfile",kind:"LinkedField",name:"legacy_extended_profile",plural:!1,selections:[{alias:null,args:null,concreteType:"LegacyExtendedBirthDate",kind:"LinkedField",name:"birthdate",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"month",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"day",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"year",storageKey:null}],storageKey:null}],storageKey:null}],type:"User",abstractKey:null}],storageKey:null}],storageKey:null}],storageKey:'viewer_v2(s:"4721")'}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"fetchDownloadSettingAllowedQuery",selections:[i,{alias:"viewer",args:a,concreteType:"Viewer",kind:"LinkedField",name:"viewer_v2",plural:!1,selections:[{alias:null,args:null,concreteType:"UserResults",kind:"LinkedField",name:"user_results",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"result",plural:!1,selections:[l,{kind:"InlineFragment",selections:[n,r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],type:"User",abstractKey:null}],storageKey:null},r],storageKey:null}],storageKey:'viewer_v2(s:"4721")'}]},params:{id:"P4Y9VY-Vn1cJuBnjOVZ4xA",metadata:{},name:"fetchDownloadSettingAllowedQuery",operationKind:"query",text:null}};o.hash="8a9c6728758bc2d477246d6d2dbf9e46";const d=o},882127:(e,t,s)=>{s.d(t,{Z:()=>a});var i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"fetchDownloadSettingAllowed_viewer",selections:[{alias:null,args:null,concreteType:"UserResults",kind:"LinkedField",name:"user_results",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"result",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"LegacyExtendedUserProfile",kind:"LinkedField",name:"legacy_extended_profile",plural:!1,selections:[{alias:null,args:null,concreteType:"LegacyExtendedBirthDate",kind:"LinkedField",name:"birthdate",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"month",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"day",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"year",storageKey:null}],storageKey:null}],storageKey:null}],type:"User",abstractKey:null}],storageKey:null}],storageKey:null}],type:"Viewer",abstractKey:null,hash:"7c8218ed97677fa6b6cff281b5c2fef5"};const a=i},417144:(e,t,s)=>{function i(e,t=1){let s=t;const i=new Map;let a=0,l=0,n=0,r=null;function o(){i.clear(),a=0,l=0,n=0}return{uploadStart:function(e,t){i.set(e,{time:Date.now(),bytes:t}),l||(l=Date.now())},uploadFinish:function(d,u){const c=i.get(d);c&&(a+=u-c.bytes,i.delete(d),++n===s&&function(){if(!l)return;const i=Date.now()-l;if(i<=0)return;if(1!==t)return;const n=a/i;if(n<5e3&&1===s)return;!r||r.byterate<n?(s+=1,e(),r={byterate:n,poolSize:s}):(s-=2,s=Math.max(s,1),r=null);o()}())},reset:o,getPoolSize:()=>s,start:function(){for(let t=0;t<s;++t)e()}}}s.d(t,{Z:()=>u,d:()=>S});s(543673),s(240753),s(128399);function a(e){const t=new URLSearchParams;for(const s of Object.keys(e)){const i=e[s];i&&t.set(s,i)}return`&${String(t)}`}function l(e,t=r,s=n){const i=Math.max(e,t);return Math.min(i,s)}const n=5242880,r=65536,o=2e3,d=1e4;class u{constructor(e,t=F){var s;this.timeoutIdMap={},this.mediaId="",this.mediaKey="",this.fileHandle=e,this.inflightSegments=new Map,this.totalBytes=e?e.size:0,this.mediaType=e?e.type:void 0,this.initStartTime=new Date,this.sruHeaders=t.sruHeaders||{},this.uploadUrl=t.uploadUrl||h,this.retainMediaForever=!!t.retainMediaForever,this.sruParameterOverrides=t.sruParameterOverrides,this.minSegmentBytes=this.sruParameterOverrides?.minSegmentBytes||(s=this.totalBytes,l(Math.ceil(s/d))),this._clearState()}upload(e){(this.hasAttemptedFinalize&&(this.uploadOptions.trimRanges!==e.trimRanges||this.uploadOptions.extraFinalizeParams!==e.extraFinalizeParams)||this.uploadOptions.extraInitParams!==e.extraInitParams)&&this._clearState(),this.uploadOptions=e,this.state!==k.SUCCEEDED&&this.state!==k.PENDING&&(this.state=k.PENDING,this.hasAttemptedFinalize?this._postFinalize():this.mediaId?this._startNextAppendSegment():this._postInit()),this._bitrateMonitor=e.withMultiRequests?i((()=>{this._startNextAppendSegment()}),e.withMultiRequestsDefaultPoolSize):void 0,this._notifyResult(),this._notifyProgress(this._uploadProgress())}cancel(){"function"==typeof this.uploadOptions.error&&this.uploadOptions.error({code:S.CANCELED}),this._clearState()}pollStatusOfExistingMediaId(e,t){this.mediaId=e,this.uploadOptions=t||F,this.state=k.PENDING,this._getStatus()}_clearState(){for(const e of Object.keys(this.timeoutIdMap))clearTimeout(this.timeoutIdMap[e]),delete this.timeoutIdMap[e];this.state=k.RESET,this.mediaId="",this.mediaKey="",this.uploadOptions=F,this.nextSegmentBytes=this.sruParameterOverrides?.minSegmentBytes||function(){const e=window.navigator.connection;if(e){const t=e.type||e.effectiveType;if(e.downlink)return l(1e3*e.downlink/8/2*o);if("wifi"===t)return l(5*r)}return l(2*r)}(),this.segmentIndex=0,this.totalUploadDuration=0,this.uploadedBytes=0,this.hasAttemptedFinalize=!1,this.inflightSegments.forEach((({request:e})=>e.abort())),this.inflightSegments=new Map,this._bitrateMonitor?.reset()}uploadExternalMedia(e,t,s,i=F){this.uploadOptions=i,this.state=k.PENDING,this.progressMode="uploading";let l=a({source_url:e,media_type:t,media_category:s});l+=this.uploadOptions.extraInitParams||"",l+=this.uploadOptions.extraFinalizeParams||"";this._sendXhr("POST","INIT",l,(e=>{this.mediaId=e.media_id_string,this._getStatus()}),((...e)=>this._uploadError(...e)),p)}_postInit(){if(this.totalBytes){this.progressMode="uploading";const e={total_bytes:String(this.totalBytes),media_type:this.mediaType||""};this.uploadOptions.enable_1080p_variant&&(e.enable_1080p_variant=String(!0));const{mediaItem:t}=this.uploadOptions;if(t?.mediaFile?.duration){const s=1e3*t.mediaFile.duration;e.video_duration_ms=String(s)}let s=a(e);this.uploadOptions.extraInitParams&&(s+=this.uploadOptions.extraInitParams),this._sendXhr("POST","INIT",s,((...e)=>this._initSuccess(...e)),((...e)=>this._uploadError(...e)),p)}else this._uploadError({code:S.ZERO_FILE_LENGTH})}_initSuccess(e){this.state===k.PENDING&&(this.mediaId=e.media_id_string,this.mediaKey=e.media_key,this._setSessionTimeout(e.expires_after_secs),this._bitrateMonitor?this._bitrateMonitor.start():this._startNextAppendSegment())}_setSessionTimeout(e){if(this.timeoutIdMap.session&&(clearTimeout(this.timeoutIdMap.session),delete this.timeoutIdMap.session),e){const t=Math.min(c,1e3*e);this.timeoutIdMap.session=setTimeout((()=>{this._uploadError({code:S.TIMEOUT}),this._stats("NONE","timeout"),this._clearState()}),t)}}_startNextAppendSegment(){if(this.hasAttemptedFinalize||this.inflightSegments.size>=(this._bitrateMonitor?.getPoolSize()??g))return;if(this.uploadedBytes===this.totalBytes)return this._postFinalize();if(!this.fileHandle)return;let e=0;this.inflightSegments.forEach((({bytes:t})=>e+=t));const t=e+this.uploadedBytes,s=Math.min(this.nextSegmentBytes,this.totalBytes-t);if(s<=0)return;const i=new FormData;if(this.fileHandle){const e=this.fileHandle.slice(t,t+s);i.append("media",e)}const l=this.segmentIndex;this.segmentIndex+=1;const n=a({media_id:this.mediaId,segment_index:String(l)}),r=this._sendXhr("POST","APPEND",n,(()=>{if(this.state===k.PENDING){const e=this.inflightSegments.get(l);e&&(this.inflightSegments.delete(l),this.uploadedBytes+=e.bytes),this._notifyProgress(this._uploadProgress(),this.mediaId),0===this.inflightSegments.size&&this._startNextAppendSegment()}}),((...e)=>this._uploadError(...e)),5,i,(()=>this._startNextAppendSegment()),s);this.inflightSegments.set(l,{bytes:s,request:r})}_postFinalize(){if(this.uploadOptions.pauseBeforeFinalize)this.state=k.PAUSED,this.uploadOptions.pause&&this.uploadOptions.pause();else{this.hasAttemptedFinalize=!0;const e={media_id:this.mediaId};this.uploadOptions.trimRanges&&(e.trim_ranges=this.uploadOptions.trimRanges),this.mediaType&&/^video\//.test(this.mediaType)&&(e.allow_async=String(!0)),this.retainMediaForever&&(e.ttl="infinite");let t=a(e);t+=this.uploadOptions.extraFinalizeParams||"",this._sendXhr("POST","FINALIZE",t,((...e)=>this._finalizeOrStatusSuccess(...e)),((...e)=>this._uploadError(...e)),p)}}_finalizeOrStatusSuccess(e){this._setSessionTimeout(e.expires_after_secs);const t=e.processing_info;if(!t)return void this._finalizeSuccess(e);let s=0;switch(t.state){case"pending":this.progressMode="waiting";break;case"in_progress":this.progressMode="processing","number"==typeof t.progress_percent&&(s=t.progress_percent),s>=100&&(s=99);break;case"succeeded":return void this._finalizeSuccess(e);case"failed":{const e=t.error;let s;return s=e?.code?f[String(e.code)]:S.INTERNAL_ERROR,void this._uploadError({...e,code:s})}default:return void this._uploadError()}this._notifyProgress(s,this.mediaId,this.mediaKey);const i=t.check_after_secs||10;setTimeout(((...e)=>this._getStatus(...e)),1e3*i)}_getStatus(){if(this.state===k.PENDING){const e=a({media_id:this.mediaId});this._sendXhr("GET","STATUS",e,((...e)=>this._finalizeOrStatusSuccess(...e)),((...e)=>this._uploadError(...e)),p)}}_finalizeSuccess(e){this.state===k.PENDING&&(this.state=k.SUCCEEDED,this._notifyResult())}_uploadError(e){if(this.state!==k.PENDING)return;const t=e.error?.match(/{ "message": "maxFileSizeExceeded", "maxFileSizeBytes": \d+ }/);if(t){const e=JSON.parse(t[0]);this.error={code:S.FILE_TOO_LARGE,message:e.message,maxSizeBytes:e.maxFileSizeBytes}}else e&&e.code?this.error=e:this.error={code:S.INTERNAL_ERROR,message:e?.error};this.state=k.FAILED,this._notifyResult()}_uploadProgress(){if(this.totalBytes){return 100*(this.uploadedBytes/this.totalBytes)}return 0}_notifyProgress(e,t,s){this.state!==k.FAILED&&this.uploadOptions.progress&&this.uploadOptions.progress(e,this.progressMode,t,s)}_notifyResult(){this.state===k.SUCCEEDED&&this.uploadOptions.success&&this.uploadOptions.success(this.mediaId,this.mediaKey),this.state===k.FAILED&&this.uploadOptions.error&&this.uploadOptions.error(this.error)}_stats(e,t,s={}){const i=s.requestStartTime||this.initStartTime,a=(new Date).getTime()-i.getTime();if(this.totalUploadDuration+=a,this.uploadOptions.stats){const i={mediaType:this.mediaType||"",command:e,status:t,duration:a,totalByteSize:this.totalBytes,totalDuration:this.totalUploadDuration};s.segmentBytes&&(i.appendByteSize=s.segmentBytes),this.uploadOptions.stats(i)}}_sendXhr(e,t,s,i,a,n,r,d,u=0){const c=`${this.uploadUrl}?command=${t}${s}`;let p=!1;const h=new Date,g=l=>{if(n){const l=[c,n].join("-");this.timeoutIdMap[l]=setTimeout((()=>{this._sendXhr(e,t,s,i,a,n-1,r,d,u)}),_)}else f(l)},f=e=>{this._stats(t,e||"unknown-error",{requestStartTime:h,segmentBytes:u}),"function"==typeof a&&a(T(k)||{code:S.INVALID_RES_STATUS,mediaId:this.mediaId})},k=new XMLHttpRequest;k.open(e,c,!0),k.withCredentials=!0,k.timeout=this.sruParameterOverrides?.clientsideSruUploadTimeoutMs||m,k.onload=()=>{if(k.status>=200&&k.status<400){const e=T(k);204===k.status||e?(this._stats(t,"success",{requestStartTime:h,segmentBytes:u}),i(e||{}),!p&&d&&d()):g("parsererror")}else k.status&&503!==k.status?f("invalid-response"):g("503")},k.onerror=()=>g("error"),k.ontimeout=()=>{this.nextSegmentBytes=this.minSegmentBytes,g("timeout")};let F=!1;k.upload.onprogress=e=>{F?e.loaded===e.total&&this._bitrateMonitor?.uploadFinish(c,e.total):(F=!0,this._bitrateMonitor?.uploadStart(c,e.loaded));const t=e.loaded,s=(this.uploadedBytes+t)/this.totalBytes*100;if(this._notifyProgress(s,this.mediaId),t/e.total>y&&!p&&(p=!0,r)){const e=Math.max(1,(new Date).getTime()-h.getTime()),s=this.minSegmentBytes,i=this.sruParameterOverrides?.maxSegmentBytes;this.nextSegmentBytes=function(e){const t=e.idealUploadTimeMs||o,s=e.sentBytes/e.uploadTimeMs;return l(Math.round(t*s),e.minSegmentBytes,e.maxSegmentBytes)}({minSegmentBytes:s,sentBytes:t,uploadTimeMs:e,maxSegmentBytes:i,idealUploadTimeMs:this.sruParameterOverrides?.idealUploadTimeMs}),"function"==typeof d&&d()}};for(const e in this.sruHeaders)k.setRequestHeader(e,this.sruHeaders[e]);return r?k.send(r):k.send(),k}}const c=2147483647,p=1,m=45e3,h=(window.location.host.includes("twitter.com")?"https://upload.twitter.com":"https://upload.x.com")+"/i/media/upload.json",g=2,y=.95,_=1e3,S=Object.freeze({FILE_TOO_LARGE:2,INTERNAL_ERROR:131,INVALID_MEDIA:1,RATE_LIMIT:88,TIMEOUT:67,UNSUPPORTED_MEDIA:3,ZERO_FILE_LENGTH:4,CANCELED:999,INVALID_RES_STATUS:-1}),f=Object.freeze({0:S.INTERNAL_ERROR,1:S.INVALID_MEDIA,2:S.FILE_TOO_LARGE,3:S.UNSUPPORTED_MEDIA,4:S.TIMEOUT}),k=Object.freeze({RESET:0,PENDING:1,PAUSED:2,SUCCEEDED:3,FAILED:4}),F={};function T(e){try{return JSON.parse(e.responseText)}catch(e){return null}}}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/shared~loader.SideNav~loader.SideNavRedesign-6107ac1a.651dc8ca.js.map