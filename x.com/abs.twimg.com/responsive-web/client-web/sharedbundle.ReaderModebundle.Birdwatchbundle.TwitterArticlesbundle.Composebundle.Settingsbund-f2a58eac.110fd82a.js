"use strict";(self.webpackChunk_twitter_responsive_web=self.webpackChunk_twitter_responsive_web||[]).push([["shared~bundle.ReaderMode~bundle.Birdwatch~bundle.TwitterArticles~bundle.Compose~bundle.Settings~bund-f2a58eac","bundle.GrokDrawer-2291c9da","bundle.UserAvatar-2291c9da","loader.Grok-2291c9da"],{583790:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(403911),o=s(545521);const a=(e,t)=>(0,o.Z)({contextSuffix:"BOOKMARK_FOLDERS_SLICE",getFetchApiEndpoint:e=>e.withEndpoint(r.Z).fetchBookmarkFoldersSlice,getEndpointParams:e=>({...e,tweet_id:t}),sliceKey:`bookmarkFoldersSlice-${e}`})},482176:(e,t,s)=>{s.d(t,{SS:()=>h,ZP:()=>k,aL:()=>O,zs:()=>T});var r=s(912021),o=s(744531),a=s(403911),n=s(466015),i=s(917799),c=s(56519),d=s(502909),E=s(600823),l=s(390387),u=s(977154),g=s(583790);const _=Object.freeze({REQUEST:"rweb/bookmarkFolders/FETCH_BOOKMARK_FOLDERS_REQUEST",SUCCESS:"rweb/bookmarkFolders/FETCH_BOOKMARK_FOLDERS_SUCCESS",FAILURE:"rweb/bookmarkFolders/FETCH_BOOKMARK_FOLDERS_FAILURE"}),m=Object.freeze({REQUEST:"rweb/bookmarkFolders/CREATE_BOOKMARK_FOLDERS_REQUEST",SUCCESS:"rweb/bookmarkFolders/CREATE_BOOKMARK_FOLDERS_SUCCESS",FAILURE:"rweb/bookmarkFolders/CREATE_BOOKMARK_FOLDERS_FAILURE"}),S=(0,d.ZP)({namespace:"bookmarkFolders"}),R=(0,r.Z)((e=>(0,g.Z)(e))),p={deleteBookmarkFolder:(0,d.Tx)(S,"deleteBookmarkFolder",{context:"DELETE_BOOKMARK_FOLDER",getApiMethod:e=>e.withEndpoint(a.Z).deleteBookmarkFolder,getParams:e=>({bookmarkFolderId:e}),getMeta:(e,t={},s)=>({entityId:e}),reducer:(e,t)=>{const{entityId:s}=t.meta;if(!e.entities[s])return e;const r=(0,o.Z)(e.entities,[s]);return{...e,entities:r}},mapResponseToActions:(e,t,s)=>t=>{const r=(0,l.x0)(s());if(r&&e&&"Done"===t?.bookmark_collection_delete){return[R(r).removeItems([e])]}}}),editBookmarkFolder:(0,d.Tx)(S,"editBookmarkFolder",{context:"EDIT_BOOKMARK_FOLDER",getApiMethod:e=>e.withEndpoint(a.Z).editBookmarkFolder,getParams:(e,{name:t}={})=>({bookmarkFolderId:e,name:t}),getMeta:(e,t={},s)=>({entityId:e,name:t.name}),mapResponseToActions:(e,t,s)=>t=>{if(!t)return;const r=t?.bookmark_collection_update,o=(0,l.x0)(s());if(o&&e&&r){return[R(o).injectItems([r.id])]}},reducer:(e,t)=>{const{entityId:s,name:r}=t.meta,o=e.entities[s];if(!o)return e;const a={name:r};return{...e,entities:{...e.entities,[o.id]:{...o,...a}}}}}),removeTweetFromBookmarkFolder:(0,d.Tx)(S,"removeTweetFromBookmarkFolder",{context:"REMOVE_TWEET_FROM_BOOKMARK_FOLDER",getApiMethod:e=>e.withEndpoint(a.Z).removeTweetFromBookmarkFolder,getParams:(e,{tweetId:t}={})=>({bookmarkFolderId:e,tweetId:t}),mapResponseToActions:(e,t,s)=>r=>{if(r){if("Done"!==r.bookmark_collection_tweet_delete)return;if(!t.tweetId||!e)return[];const o=r?.bookmark_collection_tweet_delete,a=(0,l.x0)(s());if(a&&e&&o){const s=R(a);return[(0,u.m)(e).removeTweets({[t.tweetId]:!0}),s.injectItems([e])]}}},reducer:(e,t)=>e}),addTweetToBookmarkFolder:(0,d.Tx)(S,"addTweetToBookmarkFolder",{context:"BOOKMARK_TWEET_TO_FOLDER",getApiMethod:e=>e.withEndpoint(a.Z).bookmarkTweetToFolder,getParams:(e,{tweetId:t}={})=>({bookmark_collection_id:e,tweet_id:t}),mapResponseToActions:(e,t,s)=>r=>{if(r){if("Done"!==r.bookmark_collection_tweet_put)return;if(!t.tweetId||!e)return[];const o=r?.bookmark_collection_tweet_put,a=(0,l.x0)(s());if(a&&e&&o){const s=R(a);return[(0,u.m)(e).injectEntry(n.Se({id:t.tweetId,sortIndex:t.tweetId})),s.injectItems([e])]}}},reducer:(e,t)=>e})},T=()=>(e,t,{api:s})=>(0,i._O)(e,{request:s.withEndpoint(a.Z).fetchBookmarkFoldersSlice,params:{}})({actionTypes:_,context:"FETCH_BOOKMARK_FOLDERS"},(e=>{if(e){const{entities:t}=e;return t?[(0,c.dP)(t)]:void 0}})),h=e=>(t,s,{api:r})=>(0,i._O)(t,{request:r.withEndpoint(a.Z).createBookmarkFolder,params:{name:e}})({actionTypes:m,context:"CREATE_BOOKMARK_FOLDER"},(e=>{if(e){const t=e?.bookmark_collection_create,r=(0,l.x0)(s());if(t&&r){const e=R(r);return[S.add({[t.id]:t}),e.injectItems([t.id])]}}})),O=(e,t,s)=>r=>{const o=R(s);return Promise.resolve(r([(0,u.m)(e).removeTweets({[t]:!0}),o.injectItems([e])]))},I={...S,...p,customActionTypes:(0,d.X7)(p)},k=E.Z.register(I)},958602:(e,t,s)=>{s.d(t,{I:()=>n});var r=s(323265),o=s(389071),a=s(189953);const n=({analytics:e,conversationKey:t})=>async(e,s,{api:n,featureSwitches:i})=>{const c=(0,o.bD)(t),d=c.selectStatus(s());if(!(d===a.Q_.TYPING||d===a.Q_.WAITING))return Promise.resolve();const E=c.selectConversationId(s())||void 0,l=c.selectMetadataForMessageId(s(),"currentResponse"),u=l?.agentChatItemId||void 0;await e(c.abortMessage());const g={responses:[],systemPromptName:"",grokModelOptionId:"",conversationId:E,responseToChatItemId:u,isCancel:!0},_=!r.ZP.isTwitterApp()&&i.isTrue("responsive_web_grok_api_enable_grok_host");return n.fetchClient.dispatch("/2/grok/add_response.json",{method:"POST",credentials:"include",body:JSON.stringify(g)},_?"https://grok.x.com":void 0).then((async e=>{}))}},250781:(e,t,s)=>{s.d(t,{D:()=>g});s(890103),s(136728),s(875640),s(571372),s(543673),s(240753),s(128399);var r=s(323265),o=s(397159),a=s(774717),n=s(919760),i=s(623494),c=s(836255),d=s(919022),E=s(52570),l=s(155918);const u=e=>{const t=[];let s=!1,r=Date.now();const o=[];let a=20;const n=()=>{const e=(()=>{const e=Date.now();for(;o.length>0&&o[0]<e-50;)o.shift();return o.length/.05})(),s=Math.max(e,t.length);a=s>0?Math.max(0,1e3/s):0,r=Date.now()},i=async()=>{for(s=!0;t.length>0;){const e=t.shift();e&&e();const s=a;await new Promise((e=>setTimeout(e,s)))}s=!1};return{resumingDispatch:e=>{const a=Date.now();o.push(a),t.push(e),a-r>=50&&n(),s||i()},abortQueue:()=>{t.length=0,s=!1,o.length=0}}},g=async({analytics:e,api:t,dispatch:s,eventTag:g,featureSwitches:m,flags:S,grokModule:R,method:p="POST",requestBody:T,requestParams:h})=>{const O=m.isTrue("responsive_web_grok_download_favicons"),I=g?` (${g})`:"",k=function(){const e=`grok-${r.ZP.isTwitterApp()?r.ZP.isAndroid()?"android":"ios":"web"}:api-handler`,t=a.P_();function s(s){a.IM(`${e}:${s}`,t.end())}const o=new Set;function n(e){o.has(e)||(o.add(e),s(e))}return{record:s,recordOnce:n}}(),A=Date.now();let w=!1;const b=new AbortController;s(R.setAbortController(b));let C=!1;const f=u(s),N=[""],U=[""];let F=!0,y=!1;const M=new l.EG;M.setRequestedCount(T.imageGenerationCount||0),function({dispatch:e,grokModule:t,responses:s}){const r=s[s.length-1];if(r&&r.fileAttachments&&r.fileAttachments.length){const s=r.fileAttachments.find((e=>e.url&&e.mimeType.startsWith("image")));s&&(s.dimensions?e(t.setExpectedImageAspectRatio(s.dimensions.width/s.dimensions.height)):s.url&&(o=s.url,new Promise(((e,t)=>{const s=new Image;s.src=o,s.onload=()=>{const t={width:s.width,height:s.height};e(t)},s.onerror=()=>{t(new Error("Failed to load the image"))}}))).then((s=>{e(t.setExpectedImageAspectRatio(s.width/s.height))})))}var o}({responses:T.responses,grokModule:R,dispatch:s});const P=new o.fQ({deepsearchArgs:T.deepsearchArgs,isDeepsearch:T.isDeepsearch});let L=!1,D=!1;return(async({method:r,requestParams:a})=>{const u=function({method:e,requestParams:t}){const s=e=>{const t=new URLSearchParams;for(const[s,r]of Object.entries(e))t.append(s,String(r));return t.toString()};let r="/2/grok/add_response.json";if("GET"===e&&t){const e=s(t);e&&(r+=`?${e}`)}return r}({method:r,requestParams:a});t.fetchClient.dispatch(u,{method:r,credentials:"include",params:"GET"===r?a:null,body:"POST"===r?JSON.stringify(T):null,signal:b?.signal,keepalive:S?.enableKeepalive},S?.enableGrokApiHost?"https://grok.x.com":void 0).then((async t=>{const a=t.headers.get("x-transaction-id");if(a&&s(R.updatePerformanceMetrics({traceId:a})),!t.ok){k.record(`http-${t.status}`);const r=(0,E.bY)(t.status);return s(R.grokResponseError(r)),void(0,i.Uk)(e,`add-response failed with status ${t.status}${I}`)}const u=t.body?.getReader();if(!u)return s(R.grokResponseError(E.NE)),void(0,i.Uk)(e,`reader was not found${I}`);const g=new TextDecoder;let m="",p=[],h=[];const b=setTimeout((()=>{(0,i.eS)(e,!0)}),5e3),G=await u.read();return clearTimeout(b),async function t({done:a,value:b}){if(a){if((!N.length||N.every((e=>""===e)))&&!L){const t=`add-response failed to reach the network${I}`;return P.isDeepsearch&&_({messageStepAccumulator:P,analytics:e,dispatch:s,errorMessage:t,grokModule:R,resumabilityQueue:f,method:r}),s(R.grokResponseError(E.NE)),(0,i.Uk)(e,t),void k.record("network-error")}k.record("time-to-last-chunk"),function({analytics:e,dispatch:t,grokModule:s,isUnifiedReasoningLayout:r,messageStepAccumulator:o,method:a,resumabilityQueue:n}){o.isDeepsearch&&function({analytics:e,dispatch:t,grokModule:s,isUnifiedReasoningLayout:r,messageStepAccumulator:o}){if("PENDING"===o.state)return;o.complete(!r),t(s.grokResponseMessageStepAccumulatorUpdate(o)),(0,i.y6)(e,o.getStreamDuration())}({messageStepAccumulator:o,analytics:e,dispatch:t,grokModule:s,isUnifiedReasoningLayout:r});"GET"===a?(n.resumingDispatch((()=>t(s.updatePerformanceMetrics({endStreamTime:Date.now()})))),n.resumingDispatch((()=>t(s.grokResponseComplete())))):"POST"===a&&(t(s.updatePerformanceMetrics({endStreamTime:Date.now()})),t(s.grokResponseComplete()))}({messageStepAccumulator:P,analytics:e,dispatch:s,grokModule:R,method:r,resumabilityQueue:f,isUnifiedReasoningLayout:D})}if(b){k.recordOnce("time-to-first-chunk"),w||(w=!0,s(R.updatePerformanceMetrics({timeToFirstChunkMs:Date.now()-A})));const a=g.decode(b);if(m+=a,m.includes("\n")){const t=m.split("\n");m=t.pop();for(const a of t)if(C||"GET"!==r){const t=JSON.parse(a);if(t.result?.messageTag&&(t.result.messageTag=t.result.messageTag.toLowerCase()),t.result?.uiLayout){const e=t.result.uiLayout;s(R.setUILayout(e)),D="UNIFIED"===e.reasoningUILayout,D&&s(R.grokResponseMessageStepAccumulatorUpdate(P))}const i=t.result?.sideBySideIndex??0;if(null==t.result?.sideBySideIndex||y||(N.push(""),U.push(""),s(R.setUsingExperiment(!0)),y=!0),t.result?.query&&s(R.queryTyping(t.result.query)),t.result?.bannerMessage&&s(R.addBannerMessage(t.result.bannerMessage)),t.result?.xPostIds){const e=(0,l.Y4)(t.result.xPostIds);s(c.Z.fetchMultiple(e)),D||(p=(0,l.Y4)([...p,...e]),s(R.grokResponsePosts(p,i)))}if(t.result?.postIds)D||s(R.grokResponsePosts(t.result.postIds,i));else if(t.result?.message&&(!t.result?.messageTag||"thinking_trace"===t.result?.messageTag||t.result?.messageTag===o.iS.FINAL)){const e=!N[i];t.result?.isThinking?U[i]+=t.result.message:N[i]+=t.result.message,e&&s(R.updatePerformanceMetrics({timeToFirstTextMs:Date.now()-A}));const a=t.result?.isThinking?U[i]:N[i],n=t.result?.isThinking?"thinkingTrace":"message";"thinkingTrace"===n&&F&&(F=!1),"message"===n&&U[0].length>0&&!F&&(F=!0,"GET"===r?f.resumingDispatch((()=>s(R.updatePerformanceMetrics({thinkingTraceEnd:Date.now()})))):s(R.updatePerformanceMetrics({thinkingTraceEnd:Date.now()}))),"GET"===r?f.resumingDispatch((()=>s(R.grokResponseTyping(a,n,i)))):s(R.grokResponseTyping(a,n,i)),(t.result?.messageTag===o.iS.FINAL||t.result?.message&&"STARTED"===P.state)&&"thinking_trace"!==t.result?.messageTag&&(P.updateFinalAnswer({messageTag:o.iS.FINAL,message:t.result?.message||""}),P.complete(!D),"GET"===r?(f.resumingDispatch((()=>s(R.updatePerformanceMetrics({thinkingTraceEnd:Date.now()})))),f.resumingDispatch((()=>s(R.grokResponseMessageStepAccumulatorUpdate(P))))):(s(R.updatePerformanceMetrics({thinkingTraceEnd:Date.now()})),s(R.grokResponseMessageStepAccumulatorUpdate(P))))}if("error"===t.result?.responseType&&s(R.grokResponseFileAttachments([])),t.result?.imageAttachmentCount){let e=t.result.imageAttachmentCount;T.imageGenerationCount&&(e=Math.min(e,T.imageGenerationCount)),M.setCount(e)}if(t.result?.imageWidth&&t.result?.imageHeight&&s(R.setExpectedImageAspectRatio(t.result?.imageWidth/t.result?.imageHeight)),"image"===t.result?.responseType||t.result?.imageAttachment?.imageUrl){L=!0;const e=t.result.imageAttachment;M.addAttachment({fileName:e?.fileName??"image",mimeType:e?.mimeType??"image/jpeg",mediaId:e?.mediaIdStr,url:e?.imageUrl}),s(R.grokResponseFileAttachments(M.generateAttachmentList()))}if(t.result?.feedbackLabels&&s(R.grokResponseFeedbackLabels(t.result.feedbackLabels)),t.result?.disclaimer&&s(R.grokResponseDisclaimer(t.result.disclaimer)),t.result?.followUpSuggestions&&s(R.grokResponseFollowUpSuggestions(t.result.followUpSuggestions)),t.result?.followUpSuggestedMode&&s(R.grokResponseFollowUpSuggestedMode(t.result?.followUpSuggestedMode)),t.result?.chatResponseAnnotations&&s(R.grokResponseChatResponseAnnotations(t.result.chatResponseAnnotations)),t.result?.upsell&&s(R.grokResponseUpsell(t.result.upsell)),(t.agentChatItemId||t.userChatItemId)&&(s(R.updatePerformanceMetrics({startStreamTime:Date.now()})),s(R.grokResponseMetadata({agentChatItemId:t.agentChatItemId,userChatItemId:t.userChatItemId}))),t.result?.webResults){let e=t.result.webResults||[];O&&(e=e.map(l.nF)),h=(0,l.oN)([...h,...e]),s(R.grokWebResults(h,i))}t.result?.citedWebResults&&s(R.grokCitedWebResults(t.result.citedWebResults,i));const E=t.result?.event;if(E&&(E.imageAttachmentUpdate&&s(R.imageIntermediateResult({...E.imageAttachmentUpdate,progress:E.imageAttachmentUpdate.progress/100,imageUrl:E.imageAttachmentUpdate.imageUrl})),E.imageAttachmentRemoval&&(M.setAttachmentAsModerated(E.imageAttachmentRemoval.imageIdStr),s(R.grokResponseFileAttachments(M.generateAttachmentList())))),S?.enableLocation&&t.result?.doLocationRequest&&!T.geoLocation&&s(R.grokResponseCardAttachment({cardType:"geo_location_request"})),t.result?.cardAttachment){const r=(0,l.dj)(t.result.cardAttachment,e);if(r){if("x_posts_card"===r.cardType){const e=(0,l.Y4)(r.post_ids);r.post_ids=e,s(c.Z.fetchMultiple(e))}if("x_users_card"===r.cardType){const e=(0,l.Y4)(r.user_handles);r.user_handles=e,s(d.ZP.fetchManyByScreenNames(e))}if("citation_card"===r.cardType&&r.url){const e=(0,n.b)(r.url);if(e)s(c.Z.fetchOne(e)),p=(0,l.Y4)([...p,e]),s(R.grokResponsePosts(p,i));else{let e={url:r.url};O&&(e=(0,l.nF)(e)),h=(0,l.oN)([...h,e]),s(R.grokWebResults(h,i))}}s(R.grokResponseCardAttachment(r))}}if(t.result?.memoryReferences&&s(R.grokResponseMemoryReferences(t.result.memoryReferences)),t.result?.messageTag&&(t.result?.message||void 0!==t.result?.messageStepId)){const e=t.result?.messageTag;e!==o.iS.FINAL&&e!==o.iS.FINAL_LONG&&"thinking_trace"!==e&&(P.updateStepsFromRawMessage({message:t.result?.message||"",messageTag:e,messageStepId:t.result?.messageStepId||-1,toolUsageCardId:t.result?.toolUsageCardId||"",webResults:(t.result?.webResults||[]).map((e=>O?(0,l.nF)(e):e)),xPostIds:t.result?.xPostIds||[]}),"GET"===r?f.resumingDispatch((()=>s(R.grokResponseMessageStepAccumulatorUpdate(P)))):s(R.grokResponseMessageStepAccumulatorUpdate(P)))}}else{const e=JSON.parse(a);if(C=!0,e.message&&(N[0]+=e.message,s(R.grokResponseTyping(e.message??"","message"))),e.result?.uiLayout&&e.result?.uiLayout.reasoningUILayout&&(D="UNIFIED"===e.result.uiLayout.reasoningUILayout,s(R.setUILayout(e.result.uiLayout))),e.messageStepsHeaders&&e?.messageStepsHeaders.length>0){P.defaultFinalAnswer=e.message||"";const t=[];for(const r of e.messageStepsHeaders){const e=[];for(const t of r.steps){const r=(0,l.Y4)(t.xPostIds||[]),o=(0,l.oN)(t.webResults||[]);r.length&&(s(c.Z.fetchMultiple(r)),p=(0,l.Y4)([...p,...r]),s(R.grokResponsePosts(p))),o.length&&(h=(0,l.oN)([...h,...o]),s(R.grokWebResults(h))),e.push({header:t.header||"",assistant:t.assistant||"",decision:t.decision||"",finalMessage:t.finalMessage||"",functionCall:t.functionCall||"",rawFunctionResult:t.rawFunctionResult||"",summary:t.summary||"",webResults:o,xPostIds:r})}t.push({header:r.header||"",steps:e})}P.initiateFromHistoryResponses(t,!0),s(R.grokResponseMessageStepAccumulatorUpdate(P))}e.thinkingTrace&&(U[0]+=e.thinkingTrace,s(R.grokResponseTyping(e.thinkingTrace??"","thinkingTrace")))}}if(u){const s=setTimeout((()=>{(0,i.eS)(e,!1)}),5e3),r=await u.read();return clearTimeout(s),t(r)}}}(G)})).catch((async t=>{if(t instanceof window.DOMException&&"AbortError"===t.name)"STARTED"===P.state&&P.isDeepsearch&&(0,i.YI)(e,{durationMs:P.getStreamDuration()}),f.abortQueue(),k.record("abort");else{const o=t instanceof TypeError&&"network error"===t.message,a=U.length>0&&U[0].length>0,n=P&&"PENDING"!==P.state;if(o&&(a||n))return void s(R.grokResponseDisconnect());const c=Date.now()-A,d=500;if(t instanceof TypeError&&"Failed to fetch"===t.message&&c<d)return void s(R.grokResponseError(E.ib,{hideRetry:!0}));P.isDeepsearch&&_({messageStepAccumulator:P,analytics:e,dispatch:s,grokModule:R,resumabilityQueue:f,method:r,errorMessage:t?t.message:void 0}),s(R.grokResponseError(E.NE)),(0,i.kl)(e,t),k.record("error")}s(R.updatePerformanceMetrics({endStreamTime:Date.now()})),U[0].length>0&&s(R.updatePerformanceMetrics({thinkingTraceEnd:Date.now()}))}))})({method:p,requestParams:h})};function _({analytics:e,dispatch:t,errorMessage:s,grokModule:r,messageStepAccumulator:o,method:a,resumabilityQueue:n}){"STARTED"===o.state&&(o.onAbort(),"GET"===a?(n.resumingDispatch((()=>t(r.grokResponseMessageStepAccumulatorUpdate(o)))),n.resumingDispatch((()=>t(r.updatePerformanceMetrics({deepsearchEnd:Date.now()}))))):t(r.grokResponseMessageStepAccumulatorUpdate(o)),(0,i.hq)(e,{durationMs:o.getStreamDuration(),errorMessage:s}))}},100326:(e,t,s)=>{s.d(t,{X:()=>i});s(571372);var r=s(834949),o=s.n(r),a=s(623494),n=s(52570);const i=({analysisEntityId:e,analytics:t,api:s,dispatch:r,fromShareId:i,fromUniversalSearch:c,grokModule:d})=>(r(d.fetchConversationIdStart()),s.apiClient.graphQL(o(),{fromShare:i,fromUniversalSearch:c}).then((s=>{const o=s.create_grok_conversation?.conversation_id,i=s.create_grok_conversation?.error_code;if(o)return r(d.fetchConversationIdSuccess(o,e)),o;if(i)throw r(d.fetchConversationIdFailed(n.NE)),(0,a.Uk)(t,"conversation_id failed"),new Error(i)})).catch((e=>{const t=e.errors?.[0]?.code,s=(0,n.bY)(t);r(d.fetchConversationIdFailed(s))})))},290061:(e,t,s)=>{s.d(t,{d:()=>g});s(136728);var r=s(389071),o=s(6157),a=s(397159),n=s(919760),i=s(917799),c=s(836255),d=s(919022),E=s(189953),l=s(155918),u=s(80471);const g=(e,t)=>(s,g,{api:_,featureSwitches:m})=>{const S=m.isTrue("responsive_web_grok_download_favicons");return i._O(s,{params:{restId:e},request:_.withEndpoint(o.Z).fetchConversation})({actionTypes:E.Lc,context:"FETCH_GROK_CONVERSATION",meta:{conversationId:e}},(o=>{if(!o?.grok_conversation_items_by_rest_id?.items)return;const i=e;s((0,r.Ki)(i));const _=(0,r.YJ)(g(),i);s(_.clearConversation()),s(_.fetchConversationIdSuccess(e));const m=o?.grok_conversation_items_by_rest_id?.items?[...o.grok_conversation_items_by_rest_id.items].reverse():[];m.forEach(((r,o)=>{if(r.is_partial&&o===m.length-1)return s(_.grokResponseReconnect()),s((0,u.Z)({conversationId:e,conversationKey:e,agentChatItemId:r.chat_item_id??"",analytics:t})),void s(_.grokResponseMetadata({agentChatItemId:r.chat_item_id}));let i=r.file_attachments?.map((e=>({fileName:e.file_name??"image.jpeg",mediaId:e.media_id,isPublic:!1,mimeType:e.mime_type??"image/jpeg",url:e.url??(e.media_id?`https://api.x.com/2/grok/attachment.json?mediaId=${e.media_id}`:void 0)})))??[];if(0===i.length&&(i=r.media_urls?.map((e=>({fileName:"image.jpeg",isPublic:!1,mimeType:"image/jpeg",url:e})))??[]),"User"===r.sender_type&&s(_.userSendMessage({message:r.message??"",fileAttachments:i,bannerMessages:r.banner_message?[r.banner_message]:void 0,postIds:[],sender:1})),"Agent"===r.sender_type){if(s(_.grokResponseTyping(r.message??"","message")),r.thinking_trace){const e=r.thinking_trace;s(_.grokResponseTyping(e,"thinkingTrace")),r.is_partial&&o===m.length-1||s(_.setIsPastThinkingTrace(!0))}let e;r.ui_layout&&("Split"===r.ui_layout.reasoning_ui_layout?e="SPLIT":"Unified"===r.ui_layout.reasoning_ui_layout&&(e="UNIFIED"),e&&s(_.setUILayout({reasoningUILayout:e}))),r.banner_message&&s(_.addBannerMessage(r.banner_message)),i.length&&s(_.grokResponseFileAttachments(i)),r.memory_references&&s(_.grokResponseMemoryReferences(r.memory_references.map((e=>({conversation_id:e.conversation_id,summary:e.conversation_summary})))));let t=[],E=[],u=[];const g=[];if(r.card_attachments)for(const e of r.card_attachments){const r=(0,l.dj)(e);if(r){if("x_posts_card"===r.cardType){const e=(0,l.Y4)(r.post_ids);r.post_ids=e,t=(0,l.Y4)([...t,...e])}else if("x_users_card"===r.cardType){const e=(0,l.Y4)(r.user_handles);r.user_handles=e,s(d.ZP.fetchManyByScreenNames(e))}else if("citation_card"===r.cardType){const e=(0,n.b)(r.url);if(e)t=(0,l.Y4)([...t,e]),E=(0,l.Y4)([...E,e]);else{let e={url:r.url};S&&(e=(0,l.nF)(e)),u=(0,l.oN)([...u,e])}}g.push(r)}}if(g.length&&s(_.grokResponseCardAttachments(g)),r.deepsearch_headers&&r.deepsearch_headers.length>0){const e=r.deepsearch_headers;let o={};r.deepsearch_args&&(o=r.deepsearch_args);const n=new a.fQ({deepsearchArgs:o});n.defaultFinalAnswer=r.message||"";const i=[];for(const s of e){const e=[];for(const r of s.steps){const s=(r.x_post_ids||[]).map((e=>e));s.length&&(t=(0,l.Y4)([...t,...s]),E=(0,l.Y4)([...E,...s]));const o=(r.web_results||[]).map((e=>({url:e.url,favicon:e.favicon,favicon_base64:e.favicon_base64,language:e.language,snippet:e.snippet,title:e.title})));o.length&&(u=(0,l.oN)([...u,...o]));const a=[];if(r.tool_usage_card_results)for(const e of r.tool_usage_card_results){const s=(e.x_post_ids||[]).map((e=>e));s.length&&(t=(0,l.Y4)([...t,...s]));const r=(e.web_results||[]).map((e=>S?(0,l.nF)(e):e));r.length&&(u=(0,l.oN)([...u,...r]));const o={toolUsageCardId:e.tool_usage_card_id,webResults:r,xPostIds:s};a.push(o)}e.push({header:r.header||"",assistant:r.assistant||"",decision:r.decision||"",finalMessage:r.final_message||"",functionCall:r.function_call||"",rawFunctionResult:r.raw_function_result||"",summary:r.summary||"",webResults:o,xPostIds:s,toolUsageCardResults:a})}i.push({header:s.header||"",steps:e})}n.initiateFromHistoryResponses(i),s(_.grokResponseMessageStepAccumulatorUpdate(n))}else r.web_results&&(u=(0,l.oN)([...u,...r.web_results])),r.cited_web_results&&s(_.grokCitedWebResults([...r.cited_web_results]));t.length&&s(c.Z.fetchMultiple(t)),E.length&&s(_.grokResponsePosts(E)),u.length&&s(_.grokWebResults(u)),s(_.grokResponseMetadata({agentChatItemId:r.chat_item_id,userChatItemId:m[o-1].chat_item_id,isDeleted:r.is_deleted})),s(_.grokResponseComplete())}s(_.setMode("Fun"===r.grok_mode?E.IK.FUN:E.IK.REGULAR))}))}))}},80471:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(389071),o=s(250781);const a=({agentChatItemId:e,analytics:t,conversationId:s,conversationKey:a})=>async(n,i,{api:c,featureSwitches:d})=>{const E=(0,r.bD)(a),l={responses:[],systemPromptName:"",grokModelOptionId:"",conversationId:s};return(0,o.D)({grokModule:E,requestParams:{conversationId:s,responseToChatItemId:e,streamInitialChunkWhole:!1},requestBody:l,dispatch:n,method:"GET",analytics:t,api:c,featureSwitches:d})}},327597:(e,t,s)=>{s.d(t,{u:()=>l});var r=s(323265),o=s(389071),a=s(623494),n=s(806528),i=s(155918),c=s(958602),d=s(250781),E=s(100326);const l=({analytics:e,conversationKey:t})=>({analysisEntityId:s,attachments:l,mode:u,onStart:g,returnCitations:_,promptMetadata:m={promptSource:"NATURAL",action:"INPUT"},returnSearchResults:S=!0,features:R={eagerTweets:!0,serverHistory:!0},text:p,isGrokDrawer:T=!1,trendPromptIdStr:h,imageGenerationCount:O,source:I,toolOverrides:k,isReasoning:A,isDeepsearch:w,isImageGen:b,deepsearchArgsOverride:C,personalityId:f,isAd:N,metadata:U,modelIdOverride:F,modelNameOverride:y})=>async(h,M,{api:P,featureSwitches:L})=>{const D=!r.ZP.isTwitterApp()&&L.isTrue("responsive_web_grok_api_enable_grok_host"),G=(0,o.bD)(t);let v=G.selectConversationId(M());const K=r.ZP.isAndroid(),H=r.ZP.isIOS();if(null!=G.selectCurrentResponseMessage(M())&&await h((0,c.I)({analytics:e,conversationKey:t})),v??=await(0,E.X)({analytics:e,api:P,dispatch:h,grokModule:G,analysisEntityId:s}),!v)return void(0,a.Uk)(e,"conversation couln't be found or created");let x;const B=L.isTrue("responsive_web_grok_location_enabled"),Q=L.isTrue("responsive_web_grok_show_button_send_is_ads");if(B){const e=(0,n.fw)(M())?.position;e&&(x={latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy})}const Y=u??G.selectMode(M()),j=(0,o.F9)(M()),Z=(0,o.vf)(M()),V=Z.find((e=>e.isAnalyzeEnabled))?.id,q="GROK_ANALYZE"===m.promptSource,W=q?V:F??null,z=q?void 0:j?.mode,$=G.selectConversationForAPI(M()),X=(0,o.en)(M()),J={...k};if(b&&(J.imageGen=!0),X&&X.toolOverrides){const e=X.toolOverrides;Object.keys(e).forEach((t=>{J[t]=e[t]}))}if(!(p||U||l&&0!==l.length))return Promise.resolve();const ee={message:p??"",sender:i.CI.HUMAN,promptSource:I??"",...s?{postIds:[s]}:void 0,metadata:U};l&&(ee.fileAttachments=l),w&&(ee.isDeepsearch=w),A&&(ee.isReasoning=A);const te={responses:$.concat(ee),systemPromptName:Y,grokModelOptionId:W??j?.id,modelMode:z,conversationId:v,returnSearchResults:S,returnCitations:_,promptMetadata:m,imageGenerationCount:O,requestFeatures:R,...s?{analysisEntityId:s}:void 0,geoLocation:x,enableSideBySide:!("GROK_ANALYZE"===m.promptSource||T||H||K||w||A),toolOverrides:J,isDeepsearch:w,isReasoning:A,personalityId:f,isAd:Q?N:void 0,deepsearchArgs:C??(w?X?.deepsearchArgs:void 0),modelName:y};h(G.setPromptSource(I||"")),h(G.setUsingExperiment(!1)),h(G.userSendMessage(ee,m)),(0,a.pv)(e,{conversationLength:$.length,isFileAttached:Boolean(ee.fileAttachments?.length),isDeepsearch:te.isDeepsearch||void 0,isReasoning:te.isReasoning||void 0}),g?.();const se=L.isTrue("responsive_web_grok_enable_add_response_keepalive")&&(w||A);return(0,d.D)({grokModule:G,requestBody:te,dispatch:h,analytics:e,api:P,flags:{enableLocation:B,enableGrokApiHost:D,enableKeepalive:se},featureSwitches:L})}},63538:(e,t,s)=>{s.d(t,{O:()=>n});var r=s(6157),o=s(917799),a=s(189953);const n=(e,t)=>{const s=e===a.IK.FUN?"Fun":"Normal";return(e,n,{api:i})=>o._O(e,{params:{grokMode:s,grokModelOptionId:t},request:i.withEndpoint(r.Z).setPreferences})({actionTypes:a.HF,context:"SET_PREFERENCES",meta:{}})}},458810:(e,t,s)=>{s.d(t,{t:()=>o});s(571372);var r=s(6157);const o=(e,t)=>(s,o,{api:a})=>a.withEndpoint(r.Z).uploadFile({file:e,abortController:t}).then((e=>{const t=e[0];if(!t)throw new Error("Missing file in the response");return t}))},189953:(e,t,s)=>{s.d(t,{$t:()=>ce,A0:()=>Re,BA:()=>oe,BS:()=>M,CH:()=>L,CR:()=>$,Cr:()=>k,DX:()=>W,Dh:()=>p,Dn:()=>P,E4:()=>F,En:()=>E,FF:()=>Q,FV:()=>N,Gy:()=>f,HF:()=>m,Hb:()=>U,IK:()=>o,JO:()=>V,Jt:()=>ae,KH:()=>I,L0:()=>J,Lc:()=>n,Mv:()=>he,OW:()=>y,Oj:()=>C,P9:()=>Z,Q_:()=>a,Qg:()=>K,Qh:()=>te,Sv:()=>c,TY:()=>v,Tv:()=>z,UN:()=>b,VK:()=>d,WK:()=>re,Ws:()=>l,Xg:()=>X,Xi:()=>H,Y8:()=>u,Yb:()=>h,Yf:()=>r,Yx:()=>g,ZN:()=>q,_i:()=>Ee,ar:()=>Y,cA:()=>Se,cw:()=>ie,dK:()=>_,dO:()=>T,dZ:()=>G,dw:()=>_e,f1:()=>ge,ik:()=>i,ip:()=>B,j$:()=>pe,lQ:()=>se,lh:()=>S,lm:()=>R,mq:()=>Te,my:()=>w,o$:()=>D,px:()=>de,qd:()=>j,ru:()=>me,ub:()=>A,vc:()=>x,vi:()=>O,wG:()=>ne,x5:()=>ee,yB:()=>ue,z2:()=>le});const r="grok",o=Object.freeze({FUN:"fun",REGULAR:""}),a=Object.freeze({IDLE:"idle",TYPING:"typing",WAITING:"waiting",FAILED:"failed"}),n=Object.freeze({REQUEST:"rweb/FETCH_GROK_CONVERSATION/REQUEST",SUCCESS:"rweb/FETCH_GROK_CONVERSATION/SUCCESS",FAILURE:"rweb/FETCH_GROK_CONVERSATION/FAILURE"}),i=Object.freeze({REQUEST:"rweb/RECONNECT_GROK_CONVERSATION/REQUEST",SUCCESS:"rweb/RECONNECT_GROK_CONVERSATION/SUCCESS",FAILURE:"rweb/RECONNECT_GROK_CONVERSATION/FAILURE"}),c=Object.freeze({REQUEST:"rweb/FETCH_GROK_HISTORY/REQUEST",SUCCESS:"rweb/FETCH_GROK_HISTORY/SUCCESS",FAILURE:"rweb/FETCH_GROK_HISTORY/FAILURE"}),d=Object.freeze({REQUEST:"rweb/DELETE_GROK_MESSAGE/REQUEST",SUCCESS:"rweb/DELETE_GROK_MESSAGE/SUCCESS",FAILURE:"rweb/DELETE_GROK_MESSAGE/FAILURE"}),E=Object.freeze({REQUEST:"rweb/FETCH_GROK_PINNED_CONVERSATIONS/REQUEST",SUCCESS:"rweb/FETCH_GROK_PINNED_CONVERSATIONS/SUCCESS",FAILURE:"rweb/FETCH_GROK_PINNED_CONVERSATIONS/FAILURE"}),l=Object.freeze({REQUEST:"rweb/FETCH_GROK_MEDIA_HISTORY/REQUEST",SUCCESS:"rweb/FETCH_GROK_MEDIA_HISTORY/SUCCESS",FAILURE:"rweb/FETCH_GROK_MEDIA_HISTORY/FAILURE"}),u=Object.freeze({REQUEST:"rweb/SEARCH_GROK_HISTORY/REQUEST",SUCCESS:"rweb/SEARCH_GROK_HISTORY/SUCCESS",FAILURE:"rweb/SEARCH_GROK_HISTORY/FAILURE"}),g=Object.freeze({REQUEST:"rweb/FETCH_GROK_HOME/REQUEST",SUCCESS:"rweb/FETCH_GROK_HOME/SUCCESS",FAILURE:"rweb/FETCH_GROK_HOME/FAILURE"}),_=Object.freeze({REQUEST:"rweb/FETCH_GROK_SHARE/REQUEST",SUCCESS:"rweb/FETCH_GROK_SHARE/SUCCESS",FAILURE:"rweb/FETCH_GROK_SHARE/FAILURE"}),m=Object.freeze({REQUEST:"rweb/SET_PREFERENCES/REQUEST",SUCCESS:"rweb/SET_PREFERENCES/SUCCESS",FAILURE:"rweb/SET_PREFERENCES/FAILURE"}),S=Object.freeze({REQUEST:"rweb/PIN_GROK_CONVERSATION/REQUEST",SUCCESS:"rweb/PIN_GROK_CONVERSATION/SUCCESS",FAILURE:"rweb/PIN_GROK_CONVERSATION/FAILURE"}),R=Object.freeze({REQUEST:"rweb/UNPIN_GROK_CONVERSATION/REQUEST",SUCCESS:"rweb/UNPIN_GROK_CONVERSATION/SUCCESS",FAILURE:"rweb/UNPIN_GROK_CONVERSATION/FAILURE"}),p=Object.freeze({REQUEST:"rweb/CLEAR_CONVERSATIONS/REQUEST",SUCCESS:"rweb/CLEAR_CONVERSATIONS/SUCCESS",FAILURE:"rweb/CLEAR_CONVERSATIONS/FAILURE"}),T=Object.freeze({REQUEST:"rweb/GROK_USER_EVENTS_LOG/REQUEST",SUCCESS:"rweb/GROK_USER_EVENTS_LOG/SUCCESS",FAILURE:"rweb/GROK_USER_EVENTS_LOG/FAILURE"}),h="rweb/grok/DELETE_CONVERSATION",O="rweb/grok/RENAME_CONVERSATION",I="rweb/grok/SET_ABORT_CONTROLLER",k="rweb/grok/CLEAR_CONVERSATION",A="rweb/grok/USER_SEND_MESSAGE",w="rweb/grok/REGENERATE_RESPONSE",b="rweb/grok/GROK_RESPONSE_TYPING",C="rweb/grok/GROK_RESPONSE_POSTS",f="rweb/grok/GROK_RESPONSE_COMPLETE",N="rweb/grok/GROK_RESPONSE_ERROR",U="rweb/grok/GROK_RESPONSE_DISCONNECT",F="rweb/grok/GROK_RESPONSE_RECONNECT",y="rweb/grok/GROK_RESPONSE_METADATA",M="rweb/grok/GROK_RESPONSE_DISCLAIMER",P="rweb/grok/GROK_RESPONSE_FILE_ATTACHMENTS",L="rweb/grok/GROK_RESPONSE_FEEDBACK_LABELS",D="rweb/grok/GROK_RESPONSE_FOLLOWUP_SUGGESTIONS",G="rweb/grok/GROK_RESPONSE_FOLLOWUP_SUGGESTED_MODE",v="rweb/grok/GROK_RESPONSE_CHAT_RESPONSE_ANNOTATIONS",K="rweb/grok/GROK_RESPONSE_UPSELL",H="rweb/grok/GROK_RESPONSE_CARD_ATTACHMENT",x="rweb/grok/GROK_RESPONSE_CARD_ATTACHMENTS",B="rweb/grok/GROK_RESPONSE_MESSAGE_STEP_ACCUMULATOR_UPDATE",Q="rweb/grok/GROK_RESPONSE_MEMORY_REFERENCES",Y="rweb/grok/GROK_WEB_RESULTS",j="rweb/grok/GROK_CITED_WEB_RESULTS",Z="rweb/grok/ABORT_MESSAGE",V="rweb/grok/SET_EXPECTED_IMAGE_ASPECT_RATIO",q="rweb/grok/FETCH_CONVERSATION_ID_START",W="rweb/grok/FETCH_CONVERSATION_ID_SUCCESS",z="rweb/grok/FETCH_CONVERSATION_ID_FAILED",$="rweb/grok/EDITING_SET_ID",X="rweb/grok/EDITING_CLEAR",J="rweb/grok/EDITING_COMMIT",ee="rweb/gqrok/RETRY_MESSAGE",te="rweb/grok/SET_INPUT_PREFILL",se="rweb/grok/MODE_CHANGE",re="rweb/grok/MODEL_CHANGE",oe="rweb/grok/SET_ACCESS_RESTRICTED_REASONS",ae="rweb/grok/SET_FREE_ACCESS",ne="rweb/grok/SET_PREFERRED_PROMPTS",ie="rweb/grok/SET_PROMPT_SOURCE",ce="rweb/grok/NEW_CONVERSATION",de="rweb/grok/IMAGE_INTERMEDIATE_RESULT",Ee="rweb/grok/SET_GROK_INPUT_FILTER_KEY",le="rweb/grok/SET_GROK_INPUT_FOCUSED",ue="rweb/grok/QUERY_TYPING",ge="rweb/grok/ADD_BANNER_MESSAGE",_e="rweb/grok/DELETE_MEDIA_HISTORY_ITEM",me="rweb/grok/UPDATE_PERFORMANCE_METRICS",Se="r/web/grok/SET_USING_EXPERIMENT",Re="r/web/grok/SET_PREFERRED_RESPONSE",pe="rweb/grok/SET_GROK_INPUT_ADVANCED_SETTINGS",Te="rweb/grok/SET_IS_PAST_THINKING_TRACE",he="rweb/grok/SET_UI_LAYOUT"},52570:(e,t,s)=>{s.d(t,{NE:()=>a,bY:()=>l,ib:()=>E});var r=s(111677),o=s.n(r);const a=o().ead81122,n=o().f808a13a,i=o().e0481e5a,c=o().bc0a5b5a,d=o().ef674976,E=o().c403e696,l=e=>{switch(e){case 429:return n;case 451:return i;case 401:case 403:return d;case 503:return c;default:return a}}}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/shared~bundle.ReaderMode~bundle.Birdwatch~bundle.TwitterArticles~bundle.Compose~bundle.Settings~bund-f2a58eac.110fd82a.js.map