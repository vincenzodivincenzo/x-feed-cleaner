(self.webpackChunk_twitter_responsive_web=self.webpackChunk_twitter_responsive_web||[]).push([["loader.Grok-9f4db315"],{155074:e=>{e.exports={queryId:"83Gg0lfI-47Z3-ZOxyUjiQ",operationName:"ClearGrokConversations",operationType:"mutation",metadata:{featureSwitches:[],fieldToggles:[]}}},834949:e=>{e.exports={queryId:"vvC5uy7pWWHXS2aDi1FZeA",operationName:"CreateGrokConversation",operationType:"mutation",metadata:{featureSwitches:[],fieldToggles:[]}}},491156:e=>{e.exports={queryId:"kaH0vdJmbuocpRAeWpRC7A",operationName:"DeleteGrokMessage",operationType:"mutation",metadata:{featureSwitches:[],fieldToggles:[]}}},645513:e=>{e.exports={queryId:"b5KcXWCNr_I_O-m7_WjKBA",operationName:"GrokConversationItemsByRestId",operationType:"query",metadata:{featureSwitches:["creator_subscriptions_tweet_preview_api_enabled","premium_content_api_read_enabled","communities_web_enable_tweet_community_results_fetch","c9s_tweet_anatomy_moderator_badge_enabled","responsive_web_grok_analyze_button_fetch_trends_enabled","responsive_web_grok_analyze_post_followups_enabled","responsive_web_jetfuel_frame","responsive_web_grok_share_attachment_enabled","articles_preview_enabled","responsive_web_edit_tweet_api_enabled","graphql_is_translatable_rweb_tweet_is_translatable_enabled","view_counts_everywhere_api_enabled","longform_notetweets_consumption_enabled","responsive_web_twitter_article_tweet_consumption_enabled","tweet_awards_web_tipping_enabled","responsive_web_grok_show_grok_translated_post","responsive_web_grok_analysis_button_from_backend","creator_subscriptions_quote_tweet_preview_enabled","freedom_of_speech_not_reach_fetch_enabled","standardized_nudges_misinfo","tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled","longform_notetweets_rich_text_read_enabled","longform_notetweets_inline_media_enabled","payments_enabled","profile_label_improvements_pcf_label_in_post_enabled","rweb_tipjar_consumption_enabled","verified_phone_label_enabled","responsive_web_grok_image_annotation_enabled","responsive_web_grok_community_note_auto_translation_is_enabled","responsive_web_graphql_skip_user_profile_image_extensions_enabled","responsive_web_graphql_timeline_navigation_enabled","responsive_web_enhance_cards_enabled"],fieldToggles:["withArticleRichContentState","withArticlePlainText","withGrokAnalyze","withDisallowedReplyControls","withAuxiliaryUserLabels"]}}},470969:e=>{e.exports={queryId:"9Hyh5D4-WXLnExZkONSkZg",operationName:"GrokHistory",operationType:"query",metadata:{featureSwitches:[],fieldToggles:[]}}},374709:e=>{e.exports={queryId:"ZYQK0wvMfoTAwGTKIu71zQ",operationName:"GrokHome",operationType:"query",metadata:{featureSwitches:[],fieldToggles:[]}}},709401:e=>{e.exports={queryId:"azn3Sg0APPjb2Jtd7gqxsw",operationName:"GrokMediaHistory",operationType:"query",metadata:{featureSwitches:[],fieldToggles:[]}}},965508:e=>{e.exports={queryId:"_6czUDKiWzcvBUKMoDZ19w",operationName:"GrokPinConversation",operationType:"mutation",metadata:{featureSwitches:[],fieldToggles:[]}}},416024:e=>{e.exports={queryId:"BHKxYTkc5SCupV7oqJBr0g",operationName:"GrokPinnedConversations",operationType:"query",metadata:{featureSwitches:[],fieldToggles:[]}}},716442:e=>{e.exports={queryId:"Sr2QEitvnemma5D2NJlA2Q",operationName:"SearchGrokConversations",operationType:"query",metadata:{featureSwitches:[],fieldToggles:[]}}},985289:e=>{e.exports={queryId:"gxbY2KieRwxhs7i8Km5Ixw",operationName:"GrokShare",operationType:"query",metadata:{featureSwitches:["creator_subscriptions_tweet_preview_api_enabled","premium_content_api_read_enabled","communities_web_enable_tweet_community_results_fetch","c9s_tweet_anatomy_moderator_badge_enabled","responsive_web_grok_analyze_button_fetch_trends_enabled","responsive_web_grok_analyze_post_followups_enabled","responsive_web_jetfuel_frame","responsive_web_grok_share_attachment_enabled","articles_preview_enabled","responsive_web_edit_tweet_api_enabled","graphql_is_translatable_rweb_tweet_is_translatable_enabled","view_counts_everywhere_api_enabled","longform_notetweets_consumption_enabled","responsive_web_twitter_article_tweet_consumption_enabled","tweet_awards_web_tipping_enabled","responsive_web_grok_show_grok_translated_post","responsive_web_grok_analysis_button_from_backend","creator_subscriptions_quote_tweet_preview_enabled","freedom_of_speech_not_reach_fetch_enabled","standardized_nudges_misinfo","tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled","longform_notetweets_rich_text_read_enabled","longform_notetweets_inline_media_enabled","payments_enabled","profile_label_improvements_pcf_label_in_post_enabled","rweb_tipjar_consumption_enabled","verified_phone_label_enabled","responsive_web_grok_image_annotation_enabled","responsive_web_grok_community_note_auto_translation_is_enabled","responsive_web_graphql_skip_user_profile_image_extensions_enabled","responsive_web_graphql_timeline_navigation_enabled","responsive_web_enhance_cards_enabled"],fieldToggles:["withArticleRichContentState","withArticlePlainText","withGrokAnalyze","withDisallowedReplyControls","withAuxiliaryUserLabels"]}}},524816:e=>{e.exports={queryId:"-5e798p4EVbuhGGFFuw3Tg",operationName:"GrokUnpinConversation",operationType:"mutation",metadata:{featureSwitches:[],fieldToggles:[]}}},917665:e=>{e.exports={queryId:"AB0damyVo0wBhhebQIwtsg",operationName:"GrokUserEventsLog",operationType:"mutation",metadata:{featureSwitches:[],fieldToggles:[]}}},587068:e=>{e.exports={queryId:"NqLS09LPofalCjVhFolKtA",operationName:"SetGrokPreferences",operationType:"mutation",metadata:{featureSwitches:[],fieldToggles:[]}}},6157:(e,t,s)=>{"use strict";s.d(t,{Z:()=>A});var a=s(468811),o=s.n(a),r=s(163889),n=s(155074),i=s.n(n),l=s(491156),d=s.n(l),c=s(645513),u=s.n(c),_=s(470969),p=s.n(_),m=s(374709),h=s.n(m),g=s(709401),b=s.n(g),w=s(965508),S=s.n(w),f=s(416024),y=s.n(f),I=s(716442),T=s.n(I),C=s(985289),v=s.n(C),x=s(524816),k=s.n(x),P=s(917665),E=s.n(P),R=s(587068),U=s.n(R);function A({apiClient:e}){return{clearConversations:(t,s)=>e.graphQL(i(),{}).then((e=>(e.clear_grok_conversations?.grok_deletion_error?.error_code&&(0,r.ZP)("GraphQL clear grok conversations failed."),e))),setPreferences:({grokMode:t,grokModelOptionId:s})=>e.graphQL(U(),{grokMode:t,grokModelOptionId:s}).then((e=>(e.set_grok_preferences?.preference_update_error?.error_code&&(0,r.ZP)("GraphQL set grok preferences failed."),e))),fetchConversation:({restId:t})=>e.graphQL(u(),{restId:t}).then((e=>e)),fetchGrokShareGraphQL:({grok_share_id:t})=>e.graphQL(v(),{grok_share_id:t}).then((e=>e)),fetchGrokHome:()=>e.graphQL(h(),{}).then((e=>e)),fetchHistory:({cursor:t})=>e.graphQL(p(),{cursor:t}).then((e=>e)),fetchPinnedConversations:({cursor:t})=>e.graphQL(y(),{cursor:t}).then((e=>e)),fetchMediaHistory:({cursor:t})=>e.graphQL(b(),{cursor:t}).then((e=>e)),searchConversations:({keyword:t})=>e.graphQL(T(),{keyword:t}).then((e=>(e.grok_conversation_search_timeline?.items??[]).map((e=>({chatItemId:e.chat_item_id,conversation:{id:e.grokConversation?.rest_id},message:e.chat_item?.message,createdAt:e.chat_item?.created_at_ms,title:e.conversation_title}))).filter((e=>e.chatItemId&&e.conversation.id)))),deleteMessage:({chat_item_id:t,conversation_id:s})=>e.graphQL(d(),{conversation_id:s,chat_item_id:t}).then((e=>e)),logUserEventGrok:({action_type:t,group_id:s,object_id:a})=>e.graphQL(E(),{group_id:s,object_id:a,action_type:t}).then((e=>e)),grokPinConversation:({conversationId:t})=>e.graphQL(S(),{conversationId:t}).then((e=>e)),grokUnpinConversation:({conversationId:t})=>e.graphQL(k(),{conversationId:t}).then((e=>e)),uploadFile:({abortController:t,file:s})=>{const a=new FormData;return a.append("image",s),e.postForm("grok/attachment",a,{},{"x-xai-request-id":o().v4()},void 0,t.signal).then((e=>e.map((e=>({...e,url:e.url??(void 0!==e.mediaId?`https://api.x.com/2/grok/attachment.json?mediaId=${e.mediaId}`:void 0)})))))}}}},223526:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var a=s(202784),o=s(325686),r=s(107267),n=s(782261),i=s(194504),l=s(530732),d=s(731708),c=s(215337),u=s(392237),_=s(457566),p=s(306677),m=s(725405),h=s(979512);const g=u.default.create((e=>({grokIcon:{transition:"color 0.2s",color:e.colors.gray700,width:16,heigth:16,position:"relative"},grokIconHovered:{color:e.colors.text},grokFollowupsContainer:{marginTop:e.spaces.space12,position:"relative",maxWidth:"100%"},label:{transition:"color 0.2s",color:e.colors.gray700},labelHover:{color:e.colors.text},carousel:{maxWidth:"100%"},grokButton:{borderColor:e.colors.borderColor,borderWidth:e.borderWidths.small,borderRadius:e.borderRadii.infinite,color:e.colors.gray900,paddingHorizontal:e.spaces.space12,paddingVertical:e.spaces.space4,gap:e.spaces.space4,transition:"background-color 0.2s",flexDirection:"row",alignItems:"center"},hoveredButton:{backgroundColor:e.colors.gray100},buttonsContainer:{flexDirection:"row",gap:e.spaces.space4},carouselShadow:{height:"100%",position:"absolute",top:0,width:12,zIndex:10,pointerEvents:"none"},carouselStartShadow:{start:0},carouselEndShadow:{end:0}}))),b=({isFocal:e,tweet:t})=>{const s=n.Z.getOriginalTweet(t),b=(0,r.useLocation)(),w=(0,m.Z)(),{openGrok:S}=(0,h.Z)(),[f,y]=a.useState(!0),[I,T]=a.useState(!0),C=a.useRef(!1),v=a.useRef(new Set),x=a.useRef(new Set),k=s.grok_analysis_followups,P=a.useCallback((()=>{if(!C.current)return;const e=new Set([...x.current].filter((e=>!v.current.has(e))));for(const t of e)w.scribe({element:"grok_post_analysis_followup",action:"impression",data:{message:k&&k[t]||""}}),v.current.add(t)}),[w,k,C,x,v]),E=a.useCallback((({index:e,intersectionRatio:t})=>{k&&(0===e&&y(1===t),e===k.length-1&&T(1===t),!x.current.has(e)&&t>.9&&(x.current.add(e),P()))}),[k,x,P]),R=a.useCallback((()=>{C.current=!0,P()}),[P]);return b.pathname.startsWith("/i/trending")||!k||0===k.length?null:a.createElement(o.Z,{style:g.grokFollowupsContainer},a.createElement(p.D,{id:`followups_${s.id_str}`,onFullyVisible:R,position:"bottom",testID:`followups_${s.id_str}`}),a.createElement(i.Z,{buttonsContainerStyle:g.buttonsContainer,onVisibleRangeChange:E,style:g.carousel,withSingleIndexButtons:!0},k.map(((s,r)=>a.createElement(l.Z,{accessibilityRole:"button",key:`post_analysis_${s}_${r}`,onPress:()=>{const a=`https://x.com${t.permalink}`;w.scribe({element:"grok_post_analysis_followup",action:"click",data:{message:s,grok_details:{item_index:r}}}),S({text:`${s}\n${a}`,autoSubmit:!0,source:e?"post_analysis_followup_details_page":"post_analysis_followup_timeline",promptMetadata:{promptSource:"GROK_ANALYZE",action:"INPUT",properties:{element:"FOLLOW_UP"}}})},withoutInteractiveStyles:!0},(({isHovered:e})=>a.createElement(o.Z,{style:[g.grokButton,e?g.hoveredButton:void 0]},0===r?a.createElement(_.x1,{style:[g.grokIcon,e?g.grokIconHovered:void 0]}):null,a.createElement(d.ZP,{style:[g.label,e?g.labelHover:void 0]},s))))))),f?null:a.createElement(c.Z,{angle:90,colors:[u.default.theme.colors.cellBackground,u.default.theme.colors.transparent],style:[g.carouselShadow,g.carouselStartShadow]}),I?null:a.createElement(c.Z,{angle:90,colors:[u.default.theme.colors.transparent,u.default.theme.colors.cellBackground],style:[g.carouselShadow,g.carouselEndShadow]}))}},301758:(e,t,s)=>{"use strict";s.d(t,{Z:()=>b});var a=s(807896),o=s(202784),r=s(235902),n=s(521288),i=s(401388),l=s(988566),d=s(725516),c=s(443781),u=s(71620),_=s(668214),p=s(425182),m=s(836255);const h=(e,t)=>t.tweetId,g=(e,t)=>{const s=t.tweetId,a=s&&m.Z.select(e,s);return a?(0,p.z0)(e,a):void 0},b=(0,_.Z)().propsFromState((()=>({community:g,hydratedTweet:m.Z.createHydratedTweetSelector(h)}))).propsFromActions((()=>({createLocalApiErrorHandler:(0,u.zr)("QUOTE_TWEET_CONTAINER"),fetchCommunityIfNeeded:p.ZP.fetchOneIfNeeded})))((({community:e,createLocalApiErrorHandler:t,fetchCommunityIfNeeded:s,hydratedTweet:u,onAvatarClick:_,onMediaClick:p,onPress:m,onScreenNameClick:h,tweetId:g,withBirdwatchPivot:b=!0,...w})=>{const{featureSwitches:S,viewerUserId:f}=o.useContext(c.rC),y=(0,d.z)(),I=u?.community_id_str;o.useEffect((()=>{I&&(0,i.Z)(e)&&s(I).catch(t())}),[e,I,t,s]);const T=o.useCallback((e=>{y.scribeAction("click"),m&&m(e)}),[m,y]),C=!!b,v=u&&(0,l.D$)(u,f,e),x=v&&(0,l.rl)(v);return o.createElement(r.ZP.Provider,{value:{isEditTweetConsumptionEnabled:()=>S.isTrue("responsive_web_edit_tweet_enabled")||S.isTrue("subscriptions_feature_labs_1004")}},o.createElement(n.Z,(0,a.Z)({},w,{loggedInUserId:f,onAvatarClick:_,onMediaClick:p,onPress:T,onScreenNameClick:h,shouldShowAltLabelAlways:!0,socialContextProps:x,tweet:u,withBirdwatchPivot:C})))}))},306677:(e,t,s)=>{"use strict";s.d(t,{D:()=>i});var a=s(202784),o=s(325686),r=s(392237),n=s(390686);function i(e){const{id:t,onFullyVisible:s,position:r,testID:i}=e,d=a.useMemo((()=>{switch(r){case"top":return l.topPixel;case"bottom":return l.bottomPixel;case"right":return l.rightPixel;case"left":return l.leftPixel;default:return}}),[r]),c=a.useCallback((e=>{e.visibleFraction()>=n.xn&&s()}),[s]);return a.createElement(o.Z,{style:[l.impressionPixelContainer,d],testID:i},a.createElement(n.ZP,{key:t,onPlacementChange:c},a.createElement(o.Z,{style:l.impressionPixel})))}const l=r.default.create((e=>({impressionPixel:{visibility:"hidden",height:"1px",width:"1px"},impressionPixelContainer:{position:"absolute"},topPixel:{top:"0",end:"50%"},bottomPixel:{bottom:"0",end:"50%"},rightPixel:{end:"0",top:"50%"},leftPixel:{start:"0",top:"50%"}})))},397159:(e,t,s)=>{"use strict";s.d(t,{B2:()=>p,Fi:()=>u,fQ:()=>m,iS:()=>c,uk:()=>_});s(136728),s(574858),s(543673),s(240753),s(128399);var a=s(468811),o=s.n(a),r=s(111677),n=s.n(r),i=s(187268);const l=n().c3f04d9c,d=n().cbdddb0a,c={HEADER:"header",ASSISTANT:"assistant",DECISION:"decision",RAW_FUNCTION_RESULT:"raw_function_result",FUNCTION:"function",SUMMARY:"summary",FINAL:"final",SOFT_STOP:"softstop",FINAL_LONG:"final_long"},u={IN_PROGRESS:"IN_PROGRESS",COMPLETED:"COMPLETED",FAILED:"FAILED"},_={GenericSearchQueryFormatter:n().ie2bbeed,GenericSearchQueryMarkdownFormatter:n().b0d1e205,WebSearchQueryFormatter:n().ie2bbeed,XSearchQueryFormatter:n().bf970edd,XUserSearchFormatter:n().ad342369,BrowsePageFormatter:n().g008d475,GenericURLQueryFormatter:n().c91e3971,GenericURLQueryMarkdownFormatter:n().acb9b845,XUsernameSearchFormatter:n().j9006405,XUsernameQuerySearchFormatter:n().a2dd07e5,XUsernameQuerySearchMarkdownFormatter:n().e99fb7a3,CodeExecutionFormatter:n().a02d1657},p={WebSearchQueryFormatter:n().aa9d42c0,XSearchQueryFormatter:n().c731d702,XUserSearchFormatter:n().d0e02476,BrowsePageFormatter:n().c43ef93e,XUsernameSearchFormatter:n().dab166ec,XUsernameQuerySearchFormatter:n().dab166ec,CodeExecutionFormatter:n().jb097f6e};class m{constructor(e){this.initiateFromHistoryResponses=(e,t=!1)=>{this.lastStreamedDataTimestamp=Date.now();const s={};for(const t of e)for(let e=0;e<t.steps.length;e++){const a=t.steps[e];for(const e of a.toolUsageCardResults||[])s[e.toolUsageCardId]=e}for(const t of e){const e={id:o().v4(),state:u.COMPLETED,header:t.header||l,subSteps:[]};for(let a=0;a<t.steps.length;a++){const o=t.steps[a];this.addWebResults(o.webResults||[]),this.addXPostIds(o.xPostIds||[]);let r=0;if(o.assistant&&(this.accumulatedTrace+=o.assistant,this.traceEnabled=!0),o.summary){const t=(0,i.Ez)(o.summary);this.accumulatedSummary+=t;const n=[];o.toolUsageCardResults?.forEach((e=>{s[e.toolUsageCardId]&&(n.push(s[e.toolUsageCardId]),delete s[e.toolUsageCardId])})),e.subSteps.push({messageStepId:a+r,messageTag:c.SUMMARY,summary:t,webResults:o.webResults,xPostIds:o.xPostIds,toolUsageCardResults:n}),r++}if(o.decision){const t=this.parseMessageJSON(o.decision),{markdown:s,text:n}=this.getContentForDecisionAction(t);e.subSteps.push({messageStepId:a+r,messageTag:c.DECISION,actionIcon:this.getIconForDecisionAction(t),actionType:t?.action,actionMarkdownSummary:s,actionSummary:n,actionWebResult:this.webResults.find((e=>e.url===t?.action_input?.url)),actionState:"COMPLETED",webResults:o.webResults,xPostIds:o.xPostIds}),r++}}this.steps.push(e)}t||(this.isPastSummary=!0,this.state="COMPLETED")},this.addDebugMessageTagCount=e=>{e&&(this.debugMessageTagCount[e]||(this.debugMessageTagCount[e]=0),this.debugMessageTagCount[e]++,this.debugMessageTagCount={...this.debugMessageTagCount})},this.updateStepsFromRawMessage=e=>{e.messageTag&&(e.messageTag=e.messageTag.toLowerCase());const t=this.steps.length-1,s=e.messageTag===c.HEADER,a=s||this.steps.length<=0;if(this.addDebugMessageTagCount(e.messageTag),this.lastStreamedDataTimestamp=Date.now(),"PENDING"===this.state&&(this.streamStartTimestamp=Date.now(),this.state="STARTED"),a){const a={id:o().v4(),state:"COMPLETED"===this.state?u.COMPLETED:u.IN_PROGRESS,header:s?e.message:l,subSteps:[],isThinkingStep:0===this.steps.length&&!s};if(s){if(1===this.steps.length&&this.steps[0].header===l)return void(this.steps=[{...this.steps[0],header:a.header,isThinkingStep:!1}]);this.steps=[...this.steps,a]}else e.messageTag===c.ASSISTANT&&(this.accumulatedTrace+=e.message,this.traceEnabled=!0,this.steps=[...this.steps,a]);return void(t>=0&&this.completeStep(t))}const r=this.steps[t],n=r.subSteps.findLastIndex((t=>{const s=t.messageStepId===e.messageStepId,a=t.messageTag===e.messageTag;if(e.messageTag===c.RAW_FUNCTION_RESULT){const e=t.messageTag===c.DECISION;return s&&(a||e)}if(e.toolUsageCardId){const s=t.orderedContentToPreview?.some((t=>t.toolUsageCard?.id===e.toolUsageCardId));return s}return s&&a})),d=n>-1?r.subSteps[n]:void 0;let _=!1;if(d){switch(e.messageTag){case c.ASSISTANT:this.accumulatedTrace+=e.message,this.traceEnabled=!0;break;case c.SUMMARY:{const t=(0,i.Ez)(e.message);this.accumulatedSummary+=t,d.summary=(d.summary||"")+t;const s=(0,i.QK)(e.message);if(s){const t=(0,i.jU)(s);t&&(d.orderedContentToPreview=[...d.orderedContentToPreview||[],{header:t,type:"TOOL_USAGE",toolUsageCard:s}]),d.toolUsageCardResults=[...d.toolUsageCardResults||[],{toolUsageCardId:s.id,webResults:e.webResults,xPostIds:e.xPostIds}]}else{const t=h(e.message);if(t.trim()&&(d.orderedContentToPreview=[...d.orderedContentToPreview||[],{header:r.header,summary:t,type:"SUMMARY"}]),e.webResults&&e.webResults.length||e.xPostIds&&e.xPostIds.length){if(this.addWebResults(e.webResults||[]),this.addXPostIds(e.xPostIds||[]),e.toolUsageCardId){const t=d.toolUsageCardResults?.map((t=>t.toolUsageCardId===e.toolUsageCardId?{...t,webResults:e.webResults,xPostIds:e.xPostIds}:t));d.toolUsageCardResults=t}const t=d.orderedContentToPreview?.find((t=>t.toolUsageCard?.id===e.toolUsageCardId));t&&(d.orderedContentToPreview=[...d.orderedContentToPreview||[],{header:t.header,type:"TOOL_USAGE_RESULT",toolUsageCard:t.toolUsageCard,toolUsageCardResult:{toolUsageCardId:t.toolUsageCard?.id||"",webResults:e.webResults,xPostIds:e.xPostIds}}])}}_=!0;break}case c.DECISION:{const t=this.parseMessageJSON(e.message),{markdown:s,text:a}=this.getContentForDecisionAction(t);d.actionIcon=this.getIconForDecisionAction(t),d.actionType=t?.action,d.actionSummary=a,d.actionMarkdownSummary=s,_=!0;break}case c.RAW_FUNCTION_RESULT:if(!(e.webResults&&e.webResults.length||e.xPostIds&&e.xPostIds.length))break;e.webResults&&(d.webResults=e.webResults,this.addWebResults(e.webResults||[])),e.xPostIds&&(d.xPostIds=e.xPostIds,this.addXPostIds(e.xPostIds||[])),d.actionState,_=!0}_&&(r.subSteps[n]={...d},r.subSteps=[...r.subSteps])}else{let t=null;switch(e.messageTag){case c.ASSISTANT:this.accumulatedTrace+=e.message,this.traceEnabled=!0;break;case c.SUMMARY:{const s=(0,i.QK)(e.message)??void 0,a=(0,i.Ez)(e.message);this.accumulatedSummary+=a;let o=[];if(s){const e=(0,i.jU)(s);e&&(o=[{header:e,toolUsageCard:s,type:"TOOL_USAGE"}])}else{const t=h(e.message);t.trim()&&(o=[{header:r.header,summary:t,type:"SUMMARY"}])}t={messageStepId:e.messageStepId,messageTag:e.messageTag,summary:a,toolUsageCardResults:s?[{toolUsageCardId:s.id,webResults:e.webResults,xPostIds:e.xPostIds}]:[],orderedContentToPreview:o};break}case c.DECISION:{const s=this.parseMessageJSON(e.message),{markdown:a,text:o}=this.getContentForDecisionAction(s);t={messageStepId:e.messageStepId,messageTag:e.messageTag,actionIcon:this.getIconForDecisionAction(s),actionType:s?.action,actionSummary:o,actionMarkdownSummary:a,actionWebResult:this.webResults.find((e=>e.url===s?.action_input?.url)),actionState:"STARTED"};break}case c.RAW_FUNCTION_RESULT:{const s=e.webResults||[];this.addWebResults(s);const a=e.xPostIds||[];this.addXPostIds(a),(s.length>0||a.length>0)&&(t={messageStepId:e.messageStepId,messageTag:e.messageTag,webResults:e.webResults,xPostIds:e.xPostIds});break}}if(t){const e=[...r.subSteps];for(const t of e)t.actionState="COMPLETED";r.subSteps=[...e,t],r.subSteps=this.sortSubstepsByStepIdMessageTag(r.subSteps),this.steps=[...this.steps]}}this.steps[t]={...this.steps[t]}},this.sortSubstepsByStepIdMessageTag=e=>{const t=[c.SUMMARY,c.DECISION,c.RAW_FUNCTION_RESULT];return e.sort(((e,s)=>e.messageStepId!==s.messageStepId?e.messageStepId-s.messageStepId:t.indexOf(e.messageTag)-t.indexOf(s.messageTag)))},this.completeStep=e=>{this.steps[e].state=u.COMPLETED},this.parseMessageJSON=e=>{try{return JSON.parse(e)}catch(e){return null}},this.getContentForDecisionAction=e=>{if(!e)return{text:"",markdown:""};if(e.action_input?.username){if(e.action_input?.query)return{text:_.XUsernameQuerySearchFormatter({username:e.action_input?.username,query:e.action_input?.query}),markdown:_.XUsernameQuerySearchMarkdownFormatter({username:e.action_input?.username,query:e.action_input?.query})};const t=_.XUsernameSearchFormatter({username:e.action_input?.username});return{text:t,markdown:t}}if(e.action_input?.query){if(e.action_input?.url){let t=e.action_input?.url;"x.com"===t&&(t="https://x.com");let s="",a="";try{s=new URL(t).hostname,s.startsWith("www.")&&(s=s.replace("www.","")),a=`[${s}](${t})`}catch(e){a=t}return{text:_.GenericURLQueryFormatter({url:s,query:e.action_input?.query}),markdown:_.GenericURLQueryMarkdownFormatter({url:a,query:e.action_input?.query})}}return{text:_.GenericSearchQueryFormatter({query:e.action_input?.query}),markdown:_.GenericSearchQueryMarkdownFormatter({query:e.action_input?.query})}}return{text:"",markdown:""}},this.getIconForDecisionAction=e=>{if(!e)return"IconSearchStroke";switch(e.action){case"web_search":default:return"IconSearchStroke";case"x_search":case"x_user_timeline":case"fetch_x_post_context":return"IconTwitter";case"browse_page":return"IconGlobeStroke"}},this.complete=(e=!0)=>{"COMPLETED"!==this.state&&(this.streamCompletedTimestamp=Date.now(),this.state="COMPLETED",this.steps.forEach((e=>{e.state=u.COMPLETED,e.subSteps.forEach((e=>{e.actionState="COMPLETED"}))})),e&&this.steps.push({id:o().v4(),state:u.COMPLETED,header:d,subSteps:[],isCompleteHeader:!0}),this.steps=[...this.steps])},this.onAbort=()=>{for(let e=0;e<this.steps.length;e++)this.steps[e].state===u.IN_PROGRESS&&(this.steps[e].state=u.FAILED),this.steps[e].subSteps.forEach((e=>{e.actionState="COMPLETED"}));this.steps=[...this.steps],this.state="ABORTED"},this.getNumSources=()=>this.webResults.length+this.xPostIds.length,this.addWebResults=e=>{this.webResults=[...this.webResults,...e].filter(((e,t,s)=>t===s.findIndex((t=>t.url===e.url))))},this.addXPostIds=e=>{this.xPostIds=[...this.xPostIds,...e].filter(((e,t,s)=>t===s.findIndex((t=>t===e))))},this.getStreamDuration=()=>this.streamStartTimestamp?this.streamCompletedTimestamp?this.streamCompletedTimestamp-this.streamStartTimestamp:Date.now()-Number(this.streamStartTimestamp):-1,this.updateFinalAnswer=({message:e,messageTag:t})=>{this.defaultFinalAnswer+=e,this.addDebugMessageTagCount(t)},this.steps=[],this.state="PENDING",this.streamStartTimestamp=null,this.streamCompletedTimestamp=null,this.accumulatedTrace="",this.accumulatedSummary="",this.traceEnabled=!1,this.webResults=[],this.xPostIds=[],this.showLongFinalAnswer=!1,this.defaultFinalAnswer="",this.debugMessageTagCount={},this.lastStreamedDataTimestamp=null,this.deepsearchArgs=e?.deepsearchArgs||null,this.isDeepsearch=e?.isDeepsearch??!1}}function h(e){let t=e;return t=t.replace(/^(?:[-*]\s+)/,""),t=t.split("\n")[0],t}},988566:(e,t,s)=>{"use strict";s.d(t,{D$:()=>i,Du:()=>c,GK:()=>d,Iv:()=>_,pz:()=>p,rl:()=>u});var a=s(202784),o=s(688715),r=s(946409),n=s(788993);const i=(e,t,s)=>e.retweeted_status?l(e,t):e.community_id_str&&s?d(e,s):void 0,l=(e,t)=>{if(e.retweeted_status)return{contextType:n.Z.Retweet,isSelfRetweet:e.user.id_str===t,name:e.user.name,screenName:e.user.screen_name}},d=(e,t)=>({contextType:n.Z.Community,landingUrl:{url:(0,o.ju)(`https://x.com/i/communities/${t.id_str}`),urlType:"ExternalUrl"},text:t.name}),c=({isCellWithProminentSocialContext:e,socialContext:t,topic:s})=>{if(t?.topicContext){const a=t.topicContext;return{contextType:e?n.Z.TextOnly:n.Z.Topic,landingUrl:{url:`twitter://topics_timeline?id=${a.topicId}`,urlType:"DeepLink"},text:s?.name,topicContext:a}}if(t?.generalContext)return{...t.generalContext}},u=e=>{const{contextType:t,landingUrl:s,text:a}=e;return{link:s?(0,r.s9)(s):void 0,text:a,contextType:t}},_={contextType:n.Z.Pin,text:""},p=a.createContext(void 0)}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.Grok-9f4db315.a05c40ba.js.map