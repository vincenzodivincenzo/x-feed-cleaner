(self.webpackChunk_twitter_responsive_web=self.webpackChunk_twitter_responsive_web||[]).push([["loader.DMDrawer","icons/IconDoubleChevronUp-js"],{761693:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>st});var n=r(202784),a=r(107267),i=r(528840),o=r(401388),s=r(71620),l=r(125363),c=r(296196),d=r(550293),u=r(807896),h=r(325686),p=r(292627),g=r(365023),m=r(235902),v=r(461756),f=r(609927),E=r(521514),w=r(511582),b=r(456228),D=r(551864),y=r(390387),C=r(441790),x=r(715913),Z=r(601413),H=r(392237),S=r(323265),T=r(443781),I=r(740633);const P=(0,r(523561).Z)({loader:()=>r.e("ondemand.RichText").then(r.bind(r,687184))});var M=r(111311),R=r(198506),_=r(768572),U=r(275365),A=r(255534),k=r(164383),O=r(587521),L=r(304579),N=r(786998),B=r(516951),W=r(933794),F=r(163390),X=r(725516);const z={header:"DMDrawerHeader",headerHighlighted:"DMDrawerHeaderHighlighted",root:"DMDrawer"};var q=r(154003),G=r(310088),V=r(111677),j=r.n(V),K=r(894966);const Y=j().b08821f4;function Q({buttonType:e,hasNewMessages:t,inboxUnreadCount:r}){const a=(0,l.I0)(),i=t||void 0!==r&&r>0;return n.createElement(h.Z,null,n.createElement(q.ZP,{"aria-label":Y,icon:n.createElement(K.default,null),onPress:()=>{a(d.DO(null))},type:e}),i?n.createElement(G.Z,{pip:!0,style:$.newMessagePip,truncatedCountFormatter:()=>"",unreadCountLabel:()=>""}):null)}const $=H.default.create((e=>({newMessagePip:{end:e.spaces.space4,top:e.spaces.space4}})));r(136728);var J=r(324922),ee=r(867492),te=r(377782);const re=j().d227d19e,ne=j().c64c1884,ae=j().j7d0e836,ie=j().cdcebd22;function oe({analytics:e,buttonType:t,conversationTitle:r,handleToggleVisibility:i,isExpanded:o}){const s=(0,a.useHistory)();return n.createElement(h.Z,{style:se.rightControls},r?null:n.createElement(q.ZP,{"aria-label":ne,hoverLabel:{label:ie},icon:n.createElement(J.default,null),onPress:()=>{e.scribe({section:"compose_drawer",component:"dm",action:"show"}),s.push({pathname:"/messages/compose",state:{source:"drawer"}})},type:t}),r&&o&&n.createElement(k.fK,null),o?n.createElement(q.ZP,{"aria-label":re,hoverLabel:{label:re},icon:n.createElement(ee.default,null),onPress:i,type:t}):n.createElement(q.ZP,{"aria-label":ae,hoverLabel:{label:ae},icon:n.createElement(te.default,null),onPress:i,type:t}))}const se=H.default.create((e=>({rightControls:{flexDirection:"row"}})));var le=r(731708),ce=r(136483);const de=j().a2f81050,ue=j().e736990a;function he({conversationTitle:e,hasNewMessages:t,isConversationUnread:r,isHighlighted:a}){const i=e||n.createElement(le.ZP,null,de),o=r||!e&&t;return n.createElement(h.Z,{style:pe.titleContainer},n.createElement(h.Z,{style:[pe.titleTextRoot,a&&o?pe.titleTextHighlighted:null]},i),o?n.createElement(h.Z,{style:pe.newMessageDotContainer},n.createElement(ce.default,{"aria-label":ue,style:[pe.newMessageDotRoot,a?pe.newMessageDotHighlighted:pe.newMessageDotRegular]})):null)}const pe=H.default.create((e=>({newMessageDotContainer:{flexGrow:1},newMessageDotRoot:{width:e.spaces.space12,height:e.spaces.space12,marginStart:e.spaces.space4},newMessageDotRegular:{color:e.colors.primary},newMessageDotHighlighted:{color:e.colors.white},titleContainer:{alignItems:"center",display:"flex",flexDirection:"row",flexGrow:1},titleTextRoot:{flexGrow:1,flexShrink:1},titleTextHighlighted:{color:e.colors.white}})));function ge({conversationSubtitle:e,conversationTitle:t,inboxUnreadCount:r=0,isConversationUnread:a=!1,isHighlighted:i,onDrawerOpen:o,triggerHighlight:s}){const c=n.createRef(),u=(0,X.z)(),p=(0,l.I0)(),g=(0,l.v9)(d.kX),m=me(r>0,i),v=g===w.S.EXPANDED,f=n.useRef(0);n.useEffect((()=>{const e=f.current;!i&&s&&(null===e||r>e)&&s(),f.current=r}),[r,s,i]);const E=()=>{const e=v?w.S.COLLAPSED:w.S.EXPANDED;e===w.S.COLLAPSED?u.scribe({action:"collapse"}):e===w.S.EXPANDED&&(u.scribe({action:"expand"}),o&&o()),p(d.bi(e))},b=0===r?[]:i?[ve.headerHighlighted]:[ve.headerActive];return n.createElement(W.Z,{enabled:!0,handlers:{[F.uq.goLists]:B.Z,[F.uq.toggleDMDrawer]:()=>{E(),c&&c.current&&c.current.focus()}}},n.createElement(h.Z,{ref:c,style:[ve.headerRoot,!v&&ve.headerBorderClosed,...b,ve.cursor],testID:i?z.headerHighlighted:z.header},n.createElement(N.Z,{leftControl:t&&v?n.createElement(Q,{buttonType:m,hasNewMessages:r>0,inboxUnreadCount:r}):null,onMiddleControlClick:E,rightControl:n.createElement(oe,{analytics:u,buttonType:m,conversationTitle:t,handleToggleVisibility:E,isExpanded:v}),style:ve.roundedAppBarCorners,subtitle:e,title:n.createElement(he,{conversationTitle:t,hasNewMessages:r>0,isConversationUnread:a,isHighlighted:i}),withBackground:!i})))}const me=(e,t)=>e&&t?"onMediaText":"primaryText",ve=H.default.create((e=>({cursor:{cursor:"pointer"},headerRoot:{borderTopStartRadius:e.borderRadii.xLarge,borderTopEndRadius:e.borderRadii.xLarge,transition:"all 0.3s ease"},headerBorderClosed:{borderColor:e.colors.navigationBackground},headerActive:{backgroundColor:e.colors.unreadCellBackground},headerHighlighted:{borderColor:e.colors.primary,backgroundColor:e.colors.primary},roundedAppBarCorners:{borderTopStartRadius:e.borderRadii.xLarge,borderTopEndRadius:e.borderRadii.xLarge}})));function fe({conversationSubtitle:e,conversationTitle:t,inboxUnreadCount:r,isConversationUnread:a=!1,isHighlighted:i,onDrawerOpen:o,triggerHighlight:s}){const c=(0,l.v9)(L.QA),u=(0,l.v9)(d.gw);return n.createElement(ge,{conversationSubtitle:e,conversationTitle:t,inboxUnreadCount:c,isConversationUnread:!!u&&a,isHighlighted:i,onDrawerOpen:o,triggerHighlight:s})}var Ee=r(24949),we=r(297436),be=r(668214),De=r(289405),ye=r(798538),Ce=r(38562),xe=r(131290),Ze=r(601576),He=r(919022),Se=r(593953);const Te=(e,t)=>t.conversationId,Ie=(0,Ee.P1)(((e,t)=>c.selectEntriesForConversation(e,Te(0,t))),y._h,((e,t)=>t?(0,Se.y9)(e,t):void 0)),Pe=e=>t=>ye.De(e,t),Me=e=>(t,r)=>ye.rA(e,t,r),Re={conversation:(e,t)=>c.selectConversation(e,Te(0,t)),entries:c.selectEntries,perspective:y._h,users:He.ZP.selectAll,dataSaverMode:Ce.IX,dtabBarInfo:De.U6,quickReplyOptions:Ie,visibility:d.kX,inboxUnreadCount:L.QA,isUnread:(e,t)=>!c.selectConversationIsRead(e,Te(0,t)),isDmReceiptSettingEnabled:xe.cn},_e={draftText:(e,t)=>ye.vb(e,Te(0,t)),gifMetadata:(e,t)=>ye.Tu(e,Te(0,t)),isUploading:(e,t)=>ye.q9(e,Te(0,t)),media:(e,t)=>ye.W8(e,Te(0,t)),mediaUploadProgress:(e,t)=>ye.Ah(e,Te(0,t))},Ue=(0,be.Z)().propsFromState((()=>({...Re,..._e}))).adjustStateProps((({conversation:e,dataSaverMode:t,draftText:r,dtabBarInfo:n,entries:a,gifMetadata:i,inboxUnreadCount:o,isDmReceiptSettingEnabled:s,isUnread:l,isUploading:c,media:d,mediaUploadProgress:u,perspective:h,quickReplyOptions:p,users:g,visibility:m})=>{const v=e?.data;return{conversation:v&&(0,we.lk)(v,a,g),perspective:h,dataSaverMode:t,draftText:r,dtabBarInfo:n,gifMetadata:i,inboxUnreadCount:o,isDmReceiptSettingEnabled:s,isUploading:c,isUnread:l,media:d,mediaUploadProgress:u,quickReplyOptions:p,visibility:m}})).propsFromActions((({conversationId:e})=>({addMedia:Me(e),addToast:Ze.fz,createLocalApiErrorHandler:(0,s.zr)("DIRECT_MESSAGES_CONVERSATION"),fetchConversationHistory:c.fetchConversationHistory,removeMedia:Pe(e),saveText:ye.E4,sendMessage:ye.bG,updateConversationReadState:c.updateConversationReadState,fetchUpdatesIfNeeded:c.fetchUpdatesIfNeeded}))).withAnalytics({page:"messages",section:"thread_drawer"});class Ae extends n.Component{constructor(e,t){super(e,t),this._composer=n.createRef(),this._renderConversation=(e,t)=>{const{conversationId:r,history:a,location:i,typingNotifier:o}=this.props;return n.createElement(O.Z,{conversationId:r,drawerHeader:this._renderHeader(),history:a,isWide:!1,location:i,richTextInputContext:e,typeaheadWrapper:t,typingNotifier:o})},this._isExpanded=()=>{const{visibility:e}=this.props;return e===w.S.EXPANDED},this._fetchUpdatesIfNeeded=()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchUpdatesIfNeeded:r,isDmReceiptSettingEnabled:n}=this.props;r(n?{active_conversation_id:e,dm_users:!0}:{}).catch(t())},(0,I.Z)()}componentDidMount(){this._updatePolling()}componentDidUpdate(e){e.visibility!==this.props.visibility&&this._updatePolling()}render(){const e=this._isExpanded();return n.createElement(_.y3.Provider,{value:void 0},!e&&this._renderHeader(),e?S.ZP.isDesktopOS()?n.createElement(P,null,(({richTextInputContext:e,typeaheadWrapper:t})=>this._renderConversation(e,t))):this._renderConversation():null)}_renderHeader(){const{conversation:e,conversationId:t,inboxUnreadCount:r,isHeaderHighlighted:a,isUnread:i,onDrawerOpen:o,perspective:s,triggerHeaderHighlight:l}=this.props,c=a?"white":"text",d=a?"white":"gray700",u=e&&(e.type===U.eD.ONE_TO_ONE||e.type===U.eD.SECRET_ONE_TO_ONE)&&s&&(0,R.Z)(e,s).map((({user:e})=>e.screen_name)),p=u?n.createElement(Z.Z,{color:d,screenName:u[0]}):void 0;return n.createElement(h.Z,{style:ke.headerRoot},n.createElement(k._g.Provider,{value:t},n.createElement(fe,{conversationSubtitle:p,conversationTitle:n.createElement(A.Z,{conversation:e,perspective:s,textColor:c,withScreenName:!1}),inboxUnreadCount:r,isConversationUnread:i,isHighlighted:a,onDrawerOpen:o,triggerHighlight:l})))}_updatePolling(){this._pollingTimer&&this._pollingTimer.stop(),this.props.visibility===w.S.COLLAPSED&&(this._pollingTimer=new M.Z(this._fetchUpdatesIfNeeded,{interval:3e3}),this._pollingTimer.start())}}Ae.contextType=T.rC;const ke=H.default.create((e=>({headerRoot:{position:"sticky",top:0,zIndex:e.componentZIndices.appBarZIndex}}))),Oe=Ue(Ae);var Le=r(293115),Ne=r(715601),Be=r(602920),We=r(161821),Fe=r(973572),Xe=r(234296),ze=r(288331),qe=r(826760),Ge=r(149290),Ve=r(763526);const je=j().a2f81050;function Ke({dmDrawerOnClick:e,drawerCacheKey:t}){const r=(0,X.z)(),a=(0,l.I0)(),i=(0,l.v9)(c.selectConversations),o=[];for(const e of(0,We.Z)(i))!e.isDeleted&&e.data?.trusted&&o.push(e.data);o.sort(Xe.Z);const s=o.map((e=>e.conversation_id)),d=(0,l.v9)(Ce.Kp),u=(0,l.v9)(c.selectUntrustedLowQualityConversationCount),h=(0,l.v9)((0,Fe.Z)((e=>c.selectUntrustedCounts(e)),(e=>e))),p=h.newUntrustedWithSocialProof+h.oldUntrustedWithSocialProof+h.newUntrustedWithoutSocialProof+h.oldUntrustedWithoutSocialProof,g=d&&(p>0||u>0),m=()=>n.createElement(n.Fragment,null,n.createElement(Ve.J,null),n.createElement(Ge.Z,{allowUntrustedInbox:g,secondaryInboxCounts:h}));return n.createElement(ze.Z,{accessibilityTitle:je,analytics:r,conversationIds:s,customCellClick:e,fetchInboxHistory:()=>a(c.fetchTrustedInboxHistory()),isDrawer:!0,renderEmptyDMInbox:()=>n.createElement(qe.Z,{messageRequestPivot:m()}),renderStickyContent:m,updateLastSeenEventId:()=>a(c.updateTrustedLastSeenEventId()),virtualScrollerCacheKey:t,withPinnedInbox:!0})}const Ye="dmDrawerInbox";function Qe({renderHeader:e}){const t=(0,l.I0)();return n.createElement(h.Z,{style:$e.fill},n.createElement(h.Z,{style:[$e.viewportView,Be.Z.drawerHeaderRadius]},n.createElement(Ne.Z,{style:[$e.viewportView,Be.Z.drawerHeaderRadius]},e(),n.createElement(Ke,{dmDrawerOnClick:(e,r)=>{t(d.DO(r)),e.preventDefault()},drawerCacheKey:Ye}))))}const $e=H.default.create((e=>({fill:{flex:1,alignSelf:"stretch"},viewportView:{...H.default.absoluteFillObject,overflowY:"auto"}}))),Je={page:"messages",section:"inbox_drawer"};function et({isHeaderHighlighted:e,onDrawerOpen:t,triggerHeaderHighlight:r}){const a=(0,l.v9)(d.kX)===w.S.EXPANDED;n.useEffect((()=>{a&&(0,I.Z)()}),[a]);const i=()=>n.createElement(h.Z,{style:tt.headerRoot},n.createElement(fe,{isHighlighted:e,onDrawerOpen:t,triggerHighlight:r}));return n.createElement(Le.nO,{namespace:Je},n.createElement(n.Fragment,null,!a&&i(),a&&n.createElement(Qe,{renderHeader:i})))}const tt=H.default.create((e=>({headerRoot:{position:"sticky",top:0,zIndex:e.componentZIndices.appBarZIndex}}))),rt=3e3,nt={isGlobal:!0,isSticky:!0},at={isGlobal:!0,isSticky:!1};function it({hasConversations:e,isHideDMDrawerPath:t,width:r=E.Z.dmDrawerWidth.max}){const i=n.useRef(null),o=(0,l.I0)(),s=(0,a.useHistory)(),c=(0,a.useLocation)(),Z=(0,l.v9)(y._h),H=(0,l.v9)(d.gw),S=(0,l.v9)((e=>d.kX(e))),T=(0,C.N)(),[I,P]=n.useState(!1),[M,R]=n.useState(void 0),_=S===w.S.EXPANDED,U=(0,l.v9)(b.kX)===D.j.EXPANDED;n.useEffect((()=>{_&&U&&o(b.bi(D.j.COLLAPSED))}),[_,U,o]);const A=()=>{I&&(P(!1),clearTimeout(i.current))},k=e=>{const{nativeEvent:{layout:{height:t}}}=e;_||void 0!==M||R(t)},O=n.useCallback((()=>{_||I||i.current||(P(!0),i.current=setTimeout((()=>{P(!1),i.current=null}),rt))}),[_,I]);n.useEffect((()=>()=>{clearTimeout(i.current)}),[i]);const L=function(e){const[t,r]=n.useState(e);if(n.useEffect((()=>{if(!e&&t){let t;const n=window.requestAnimationFrame((()=>{t=window.requestAnimationFrame((()=>{r(e)}))}));return()=>{cancelAnimationFrame(n),cancelAnimationFrame(t)}}}),[t,e]),!e&&t)return!0;e&&!t&&r(e);return!1}(_),N=n.useRef(),B=_?{transform:[{translateY:0}]}:L?{transition:"none",transform:[{translateY:`calc(100% - ${N.current?.getBoundingClientRect().height??0}px`}]}:{transform:[{translateY:`calc(100% - ${M??0}px`}]},W=function(e){const[t,r]=n.useState(!1);return n.useEffect((()=>{if(e){let e;const t=window.requestAnimationFrame((()=>{e=window.requestAnimationFrame((()=>{r(!0)}))}));return()=>{cancelAnimationFrame(t),cancelAnimationFrame(e)}}}),[e]),t}(!!M);return(()=>{const r=S===w.S.CLOSED;return!t()&&e&&!r})()?n.createElement(p.Z.Drawer,null,n.createElement(g.Z,{id:"DMDrawer"},((e,t)=>n.createElement(x.Z.Provider,{value:{isDrawer:!0}},n.createElement(m.ZP.Provider,{value:{isDMDrawer:()=>!0}},n.createElement(h.Z,(0,u.Z)({ref:e()},t({style:[Be.Z.root,W&&Be.Z.expandable,!_&&M&&{height:M,maxHeight:M},{width:r},B,v.Z.reducedMotionEnabled&&Be.Z.reducedMotion],testID:z.root})),n.createElement(h.Z,{onLayout:M?void 0:k,ref:N,style:[_?Be.Z.expanded:null,Be.Z.main]},H?n.createElement(f.Z.Provider,{value:at},n.createElement(Oe,{conversationId:H,history:s,isHeaderHighlighted:I,location:c,onDrawerOpen:A,perspective:Z,triggerHeaderHighlight:O,typingNotifier:T})):n.createElement(f.Z.Provider,{value:nt},n.createElement(et,{isHeaderHighlighted:I,onDrawerOpen:A,triggerHeaderHighlight:O}))))))))):null}function ot({isHideDMDrawerPath:e,width:t}){const r=(0,s.n7)("DIRECT_MESSAGES_DRAWER"),a=(0,l.I0)(),[i,u]=n.useState(!1),h=(0,l.v9)(c.selectConversations),p=!(0,o.Z)(h),g=n.useCallback((()=>{e()||i||(a(d.VP()),a(c.fetchInboxIfNeeded()).catch(r({})),u(!0))}),[r,a,i,e]);return n.useEffect((()=>{g()}),[g]),n.createElement(it,{hasConversations:p,isHideDMDrawerPath:e,width:t})}function st({width:e}){const t=(0,a.useHistory)(),r=t.getLastNonModalLocationPathname()??t.location.pathname,o=n.useCallback((()=>(0,i.z)(r)||r.startsWith("/i/chat")||r.startsWith("/i/communitynotes")||r.startsWith("/i/money")||r.startsWith("/i/verified")||r.startsWith("/i/conferences-room")||r.startsWith("/i/grok")),[r]);return n.createElement(ot,{isHideDMDrawerPath:o,width:e})}},586035:(e,t,r)=>{"use strict";function n(e){return Boolean(e.voiceInfo?.clipIndex)}r.d(t,{B:()=>n})},377782:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(202784),a=r(890601),i=r(783427),o=r(347101);const s=(e={})=>{const{direction:t}=(0,i.Z)();return(0,a.Z)("svg",{...e,role:e["aria-label"]?e.role||"img":void 0,"aria-hidden":void 0===e["aria-label"],style:[o.Z.root,e.style],viewBox:"0 0 24 24",children:n.createElement("g",null,n.createElement("path",{d:"M12 2.59l9.46 9.45-1.42 1.42L12 5.41l-8.04 8.05-1.42-1.42L12 2.59zm0 7l9.46 9.45-1.42 1.42L12 12.41l-8.04 8.05-1.42-1.42L12 9.59z"}))},{writingDirection:t})};s.metadata={width:24,height:24};const l=s},452693:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(202784),a=r(890601),i=r(783427),o=r(347101);const s=(e={})=>{const{direction:t}=(0,i.Z)();return(0,a.Z)("svg",{...e,role:e["aria-label"]?e.role||"img":void 0,"aria-hidden":void 0===e["aria-label"],style:[o.Z.root,e.style],viewBox:"0 0 24 24",children:n.createElement("g",null,n.createElement("path",{d:"M12 1.75c-5.11 0-9.25 4.14-9.25 9.25 0 4.77 3.61 8.7 8.25 9.2v2.96l1.15-.17c1.88-.29 4.11-1.56 5.87-3.5 1.79-1.96 3.17-4.69 3.23-7.97.09-5.54-4.14-9.77-9.25-9.77zM13 14H9v-2h4v2zm2-4H9V8h6v2z"}))},{writingDirection:t})};s.metadata={width:24,height:24};const l=s},666536:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var n=r(936386),a=r.n(n);const i=(e,t,r)=>a()(e,t,r)},662678:(e,t,r)=>{"use strict";r.d(t,{G:()=>a,Z:()=>n});r(136728);const n=function(e,t){return a(e,t)};function a(e,t){return e.reduce(((r,n,a)=>{const i=t?t(n,a,e):!!n;return i&&r[0].push(n),!i&&r[1].push(n),r}),[[],[]])}},936386:e=>{function t(e,t,r){var n,a,i,o,s;function l(){var c=Date.now()-o;c<t&&c>=0?n=setTimeout(l,t-c):(n=null,r||(s=e.apply(i,a),i=a=null))}null==t&&(t=100);var c=function(){i=this,a=arguments,o=Date.now();var c=r&&!n;return n||(n=setTimeout(l,t)),c&&(s=e.apply(i,a),i=a=null),s};return c.clear=function(){n&&(clearTimeout(n),n=null)},c.flush=function(){n&&(s=e.apply(i,a),i=a=null,clearTimeout(n),n=null)},c}t.debounce=t,e.exports=t}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.DMDrawer.d6d28dca.js.map